Metadata-Version: 2.4
Name: aioeway
Version: 1.0.3
Summary: ä¸€ä¸ªåŸºäºå¼‚æ­¥ç¼–ç¨‹çš„MQTTè®¾å¤‡é€šä¿¡åº“
Home-page: https://github.com/PuuuTao/aioeway
Author: PuuuTao
Author-email: PuuuTao <kevinwang960105@gmail.com>
Project-URL: Homepage, https://github.com/PuuuTao/aioeway
Project-URL: Documentation, https://github.com/PuuuTao/aioeway/blob/main/README.md
Project-URL: Repository, https://github.com/PuuuTao/aioeway.git
Project-URL: Bug Reports, https://github.com/PuuuTao/aioeway/issues
Project-URL: Source Code, https://github.com/PuuuTao/aioeway
Keywords: mqtt,iot,device,communication,monitoring,async,asyncio
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: Topic :: Software Development :: Libraries :: Python Modules
Classifier: Topic :: System :: Hardware
Classifier: Topic :: Communications
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.7
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Operating System :: OS Independent
Requires-Python: >=3.7
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: aiomqtt>=2.0.0
Provides-Extra: dev
Requires-Dist: pytest>=6.0; extra == "dev"
Requires-Dist: pytest-cov>=2.0; extra == "dev"
Requires-Dist: pytest-asyncio>=0.18.0; extra == "dev"
Requires-Dist: black>=21.0; extra == "dev"
Requires-Dist: flake8>=3.8; extra == "dev"
Requires-Dist: mypy>=0.910; extra == "dev"
Requires-Dist: isort>=5.0; extra == "dev"
Provides-Extra: test
Requires-Dist: pytest>=6.0; extra == "test"
Requires-Dist: pytest-cov>=2.0; extra == "test"
Requires-Dist: pytest-asyncio>=0.18.0; extra == "test"
Dynamic: author
Dynamic: home-page
Dynamic: license-file
Dynamic: requires-python

# AIOEway - å¼‚æ­¥MQTTè®¾å¤‡äº¤äº’åº“

ä¸€ä¸ªåŸºäºPythonå¼‚æ­¥ç¼–ç¨‹çš„MQTTè®¾å¤‡é€šä¿¡åº“ï¼Œç”¨äºä¸IoTè®¾å¤‡è¿›è¡Œé«˜æ•ˆçš„åŒå‘é€šä¿¡ã€‚

## ç‰¹æ€§

- ğŸš€ **å¼‚æ­¥ç¼–ç¨‹**: åŸºäºasyncioï¼Œæ”¯æŒé«˜å¹¶å‘è®¾å¤‡è¿æ¥
- ğŸ”’ **å®‰å…¨è¿æ¥**: æ”¯æŒTLS/SSLåŠ å¯†è¿æ¥
- ğŸ“Š **æ•°æ®ç»“æ„åŒ–**: å†…ç½®è®¾å¤‡ä¿¡æ¯å’Œè¿è¡Œæ•°æ®çš„ç»“æ„åŒ–å¤„ç†
- ğŸ”„ **åŒå‘é€šä¿¡**: æ”¯æŒè®¾å¤‡ä¿¡æ¯æŸ¥è¯¢å’Œå®æ—¶æ•°æ®ç›‘æ§
- ğŸ“ **å®Œæ•´æ—¥å¿—**: è¯¦ç»†çš„è¿æ¥å’Œé€šä¿¡æ—¥å¿—è®°å½•
- ğŸ› ï¸ **æ˜“äºä½¿ç”¨**: ç®€æ´çš„APIè®¾è®¡ï¼Œå¿«é€Ÿä¸Šæ‰‹

## å®‰è£…

```bash
pip install aioeway
```

## å¿«é€Ÿå¼€å§‹

### åŸºæœ¬ä½¿ç”¨

```python
import asyncio
from device_mqtt_client import DeviceMQTTClient

async def on_device_info(device_info):
    print(f"è®¾å¤‡ä¿¡æ¯: {device_info}")

async def on_device_data(device_data_list):
    for data in device_data_list:
        print(f"è®¾å¤‡æ•°æ®: åŠŸç‡={data.gen_power}W, æ¸©åº¦={data.temperature}Â°C")

async def main():
    # åˆ›å»ºå®¢æˆ·ç«¯
    client = DeviceMQTTClient(
        device_model="MODEL001",
        device_sn="SN123456",
        username="your_username",
        password="your_password",
        broker_host="mqtt.example.com",
        broker_port=1883,
        use_tls=True
    )
    
    try:
        # è¿æ¥åˆ°MQTTä»£ç†
        if await client.connect():
            print("è¿æ¥æˆåŠŸï¼")
            
            # å¼€å§‹ç›‘æ§è®¾å¤‡
            await client.start_monitoring(
                device_id="productCode",
                device_sn="deviceNum",
                info_callback=on_device_info,
                data_callback=on_device_data
            )
            
            # ä¿æŒè¿æ¥
            await asyncio.sleep(60)
            
    finally:
        await client.disconnect()

if __name__ == "__main__":
    asyncio.run(main())
```

### åŒæ­¥è¯·æ±‚è®¾å¤‡ä¿¡æ¯

```python
async def get_device_info():
    client = DeviceMQTTClient(...)
    
    if await client.connect():
        # åŒæ­¥è·å–è®¾å¤‡ä¿¡æ¯
        device_info = await client.request_device_info_and_wait(
            device_id="productCode",
            device_sn="deviceNum",
            timeout=10.0
        )
        
        if device_info:
            print(f"è®¾å¤‡IP: {device_info.ip}")
            print(f"WiFi: {device_info.wifi_ssid}")
            print(f"å›ºä»¶ç‰ˆæœ¬: {device_info.app_firm_ver}")
        
        await client.disconnect()
```

## æ•°æ®ç»“æ„

### è®¾å¤‡ä¿¡æ¯ (DeviceInfo)

```python
@dataclass
class DeviceInfo:
    net_firm_ver: float      # ç½‘ç»œæ¨¡å—å›ºä»¶ç‰ˆæœ¬
    app_firm_ver: float      # ä¸»æ§æ¨¡å—å›ºä»¶ç‰ˆæœ¬
    wifi_ssid: str           # WiFiåç§°
    ip: str                  # IPåœ°å€
    wifi_is_normal: int      # WiFiæ˜¯å¦å¯ç”¨ï¼ˆ0ï¼šæ˜¯ 1ï¼šå¦ï¼‰
    is_lock: int             # æ˜¯å¦é”å®šï¼ˆ0ï¼šæ˜¯ 1ï¼šå¦ï¼‰
    board: List[Dict]        # æ¿å¡ä¿¡æ¯
```

### è®¾å¤‡è¿è¡Œæ•°æ® (DeviceData)

```python
@dataclass
class DeviceData:
    sort: int                # åºå·
    input_voltage: float     # è¾“å…¥ç”µå‹(V)
    input_current: float     # è¾“å…¥ç”µæµ(A)
    grid_voltage: float      # ç”µç½‘ç”µå‹(V)
    grid_freq: float         # ç”µç½‘é¢‘ç‡(Hz)
    gen_power: float         # å‘ç”µåŠŸç‡(W)
    gen_power_today: int     # ä»Šæ—¥å‘ç”µé‡(Wh)
    gen_power_total: int     # æ€»å‘ç”µé‡(kWh)
    temperature: float       # æ¸©åº¦(â„ƒ)
    err_code: int            # é”™è¯¯ç 
    duration: int            # å·¥ä½œæ—¶é•¿ï¼ˆsï¼‰
```

## MQTTä¸»é¢˜æ ¼å¼

- **è®¾å¤‡ä¿¡æ¯æ¨é€**: `{device_id}/{device_sn}/info/post`
- **è®¾å¤‡æ•°æ®æ¨é€**: `{device_id}/{device_sn}/data/post`
- **è®¾å¤‡ä¿¡æ¯è·å–**: `{device_id}/{device_sn}/info/get`
- **è®¾å¤‡æ•°æ®è·å–**: `{device_id}/{device_sn}/data/get`
- **ä¿¡æ¯è¯·æ±‚**: `{device_id}/{device_sn}/info/request`
- **æ•°æ®è¯·æ±‚**: `{device_id}/{device_sn}/data/request`

## API å‚è€ƒ

### DeviceMQTTClient

#### åˆå§‹åŒ–å‚æ•°

- `device_model`: è®¾å¤‡æœºå‹ç 
- `device_sn`: è®¾å¤‡åºåˆ—å·
- `username`: MQTTç”¨æˆ·å
- `password`: MQTTå¯†ç 
- `broker_host`: MQTTä»£ç†æœåŠ¡å™¨åœ°å€
- `broker_port`: MQTTä»£ç†æœåŠ¡å™¨ç«¯å£ï¼ˆé»˜è®¤1883ï¼‰
- `keepalive`: å¿ƒè·³é—´éš”ç§’æ•°ï¼ˆé»˜è®¤60ï¼‰
- `use_tls`: æ˜¯å¦ä½¿ç”¨TLSåŠ å¯†ï¼ˆé»˜è®¤Trueï¼‰

#### ä¸»è¦æ–¹æ³•

- `connect()`: è¿æ¥åˆ°MQTTä»£ç†
- `disconnect()`: æ–­å¼€è¿æ¥
- `subscribe_device_info()`: è®¢é˜…è®¾å¤‡ä¿¡æ¯
- `subscribe_device_data()`: è®¢é˜…è®¾å¤‡æ•°æ®
- `request_device_info_and_wait()`: åŒæ­¥è¯·æ±‚è®¾å¤‡ä¿¡æ¯
- `request_device_data_and_wait()`: åŒæ­¥è¯·æ±‚è®¾å¤‡æ•°æ®
- `start_monitoring()`: å¼€å§‹ç›‘æ§è®¾å¤‡
- `stop_monitoring()`: åœæ­¢ç›‘æ§è®¾å¤‡

## è¦æ±‚

- Python 3.7+
- aiomqtt >= 2.0.0

## è®¸å¯è¯

MIT License

## è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

## æ›´æ–°æ—¥å¿—

### v1.0.0
- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- æ”¯æŒå¼‚æ­¥MQTTé€šä¿¡
- æ”¯æŒTLSåŠ å¯†è¿æ¥
- å®Œæ•´çš„è®¾å¤‡ä¿¡æ¯å’Œæ•°æ®ç»“æ„
- åŒæ­¥å’Œå¼‚æ­¥APIæ”¯æŒ

### v1.0.1
- ä¿®æ”¹åŒ…æ ¼å¼é”™è¯¯

### v1.0.2
- æ–­çº¿é‡è¿
- é˜²æ­¢å¤šä¸ªç›‘å¬ä»»åŠ¡å†²çª

### v1.0.3
- ä¿®å¤aiomqtt 2.0+ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜
