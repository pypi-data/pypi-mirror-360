import{r as S,g as l,R as u,k as y,M as _,V as k,l as C,d as I,H as T,n as V}from"./index-BtWCYUFs.js";import{Z as x}from"./ZoomButtons-CAmuQtaf.js";import{D as A,S as E}from"./set-rtl-text-plugin-DhYtuI8C.js";import{S as L}from"./solid-polygon-layer-B5l3q15Q.js";import{c as R}from"./color-DZRtpOAM.js";import"./cut-by-mercator-bounds-xKrj6Cje.js";const D=t=>{try{const e=R(t);return e?[e.r,e.g,e.b]:[0,0,0]}catch{return[0,0,0]}},j=(t,e)=>{const r=[],s=e/50;for(const d of t){const{center:o,radius:a,slices:m}=d,g=a*s;let h=Math.PI/2,c=h;const f=24,P=Math.cos(o[1]*Math.PI/180),M=m.reduce((n,i)=>n+i.value,0);m.forEach(n=>{n.percent=n.value/M});const v=m.map(n=>{const i=[o];for(let p=0;p<=f;p++){const b=n.percent||0;c=h+p/f*b*Math.PI*2,i.push([o[0]+g*Math.cos(c)/P,o[1]+g*Math.sin(c)])}i.push(o),h=c;const w=Array.isArray(n.color)?n.color:D(n.color);return{path:i,color:w}});r.push(v)}return r.flat()};function $(t){const[e,r]=S.useState(l.state.viewState),s=S.useMemo(()=>j(t.pies,t.scale),[t.pies,t.scale]);u[t.viewId]=()=>{r(l.state.viewState)};function d(a){r(a),a.center=[a.longitude,a.latitude],l.commit("setMapCamera",a)}const o=[];return s.length&&o.push(new L({id:`pie-layer-${t.viewId}`,data:s,getPolygon:a=>a.path,getFillColor:a=>a.color,extruded:!1,wireframe:!0,getLineWidth:3,lineWidthUnits:"pixels",getLineColor:[255,40,255],pickable:!0,stroked:!1,filled:!0,parameters:{depthTest:!1},updateTriggers:{getPolygon:[s]}})),y.createElement(A,{layers:o,pickingRadius:3,controller:!0,viewState:e,onViewStateChange:a=>d(a.viewState)},y.createElement(E,{mapboxApiAccessToken:_,mapStyle:l.getters.mapStyle}))}const B={messages:{en:{carriers:"Carriers"},de:{carriers:"Unternehmen"}}};k.use(C);const F=I({name:"Pie",i18n:B,components:{ZoomButtons:x,PieThing:$},props:{root:{type:String,required:!0},subfolder:{type:String,required:!0},yamlConfig:String,config:Object,thumbnail:Boolean},data:()=>({linkLayerId:Math.floor(1e12*Math.random()),sliderValue:50,scale:50,allPies:[]}),computed:{fileApi(){return new T(this.fileSystem,l)},fileSystem(){const t=this.$store.state.svnProjects.filter(e=>e.slug===this.root);if(t.length===0)throw console.log("no such project"),Error;return t[0]},urlThumbnail(){return""}},watch:{"$store.state.viewState"(){u[this.linkLayerId]&&u[this.linkLayerId]()},"globalState.isDarkMode"(){}},methods:{async updateSlider(){if(this.scale=this.sliderValue,this.allPies.length==0)return;const t=[...this.allPies];this.allPies=[],await new Promise(e=>{setTimeout(()=>{e(!0)},1)}),this.allPies=t,await this.$nextTick()},randomSlice(){const t=Math.ceil(Math.random()*8),e=[];for(let r=0;r<t;r++)e.push({value:Math.random(),color:[255*Math.random(),255*Math.random(),255*Math.random()]});return e},generateRandomPies(t){const e=[];for(let r=0;r<t;r++){const s={center:[13.45+(.5-Math.random()),52.5+(.5-Math.random())],radius:Math.random()/20,slices:this.randomSlice()};e.push(s)}return e}},mounted(){this.allPies=this.generateRandomPies(75)},beforeDestroy(){delete u[this.linkLayerId]}});var z=function(){var e=this,r=e._self._c;return e._self._setupProxy,r("div",{staticClass:"my-component",attrs:{oncontextmenu:"return false"}},[r("pie-thing",{staticClass:"pie-thing",attrs:{viewId:`${e.linkLayerId}`,pies:e.allPies,scale:e.scale}}),e.thumbnail?e._e():r("zoom-buttons"),r("b-slider",{staticClass:"my-slider",attrs:{type:"is-danger"},on:{input:e.updateSlider},model:{value:e.sliderValue,callback:function(s){e.sliderValue=s},expression:"sliderValue"}})],1)},H=[],O=V(F,z,H,!1,null,"655da762");const K=O.exports;export{K as default};
