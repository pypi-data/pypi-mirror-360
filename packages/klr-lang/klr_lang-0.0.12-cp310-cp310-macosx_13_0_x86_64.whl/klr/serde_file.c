/*
Copyright (c) 2025 Amazon.com, Inc. or its affiliates. All Rights Reserved.
Released under Apache 2.0 license as described in the file LICENSE.
Authors: Paul Govereau, Sean McLaughlin
*/

// This file is automatically generated from KLR.
// Manual edits to this file will be overwritten.

#include "stdc.h"
#include "region.h"
#include "serde_file.h"
#include "serde_python_core.h"
#include "serde_nki.h"

bool Serde_KLRFile_ser(FILE *out, struct Serde_KLRFile *x) {
  if (!cbor_encode_tag(out, 217, 247, 3))
    return false;
  if (!cbor_encode_uint(out, x->major))
    return false;
  if (!cbor_encode_uint(out, x->minor))
    return false;
  if (!cbor_encode_uint(out, x->patch))
    return false;
  return true;
}

bool Serde_KLRMetaData_ser(FILE *out, struct Serde_KLRMetaData *x) {
  if (!cbor_encode_tag(out, 235, 0, 1))
    return false;
  if (!String_ser(out, x->format))
    return false;
  return true;
}

bool File_Contents_ser(FILE *out, struct File_Contents *x) {
  switch (x->tag) {
  case File_Contents_python:
    if (!cbor_encode_tag(out, 236, 0, 1))
      return false;
    if (!Python_Kernel_ser(out, x->python.kernel))
      return false;
    break;
  case File_Contents_nki:
    if (!cbor_encode_tag(out, 236, 1, 1))
      return false;
    if (!NKI_Kernel_ser(out, x->nki.kernel))
      return false;
    break;
  case File_Contents_hlo:
    if (!cbor_encode_tag(out, 236, 2, 1))
      return false;
    if (!String_ser(out, x->hlo.name))
      return false;
    break;
  default:
    return false;
  }
  return true;
}

bool Serde_KLRFile_des(FILE *in, struct region *region,
                       struct Serde_KLRFile **x) {
  u8 t, c, l;
  if (!cbor_decode_tag(in, &t, &c, &l))
    return false;
  if (t != 217 || c != 247 || l != 3)
    return false;
  *x = region_alloc(region, sizeof(**x));
  if (!Nat_des(in, region, &(*x)->major))
    return false;
  if (!Nat_des(in, region, &(*x)->minor))
    return false;
  if (!Nat_des(in, region, &(*x)->patch))
    return false;
  return true;
}

bool Serde_KLRMetaData_des(FILE *in, struct region *region,
                           struct Serde_KLRMetaData **x) {
  u8 t, c, l;
  if (!cbor_decode_tag(in, &t, &c, &l))
    return false;
  if (t != 235 || c != 0 || l != 1)
    return false;
  *x = region_alloc(region, sizeof(**x));
  if (!String_des(in, region, &(*x)->format))
    return false;
  return true;
}

bool File_Contents_des(FILE *in, struct region *region,
                       struct File_Contents **x) {
  u8 t, c, l;
  if (!cbor_decode_tag(in, &t, &c, &l))
    return false;
  if (t != 236)
    return false;
  *x = region_alloc(region, sizeof(**x));
  switch (c) {
  case 0:
    if (l != 1)
      return false;
    if (!Python_Kernel_des(in, region, &(*x)->python.kernel))
      return false;
    (*x)->tag = File_Contents_python;
    break;
  case 1:
    if (l != 1)
      return false;
    if (!NKI_Kernel_des(in, region, &(*x)->nki.kernel))
      return false;
    (*x)->tag = File_Contents_nki;
    break;
  case 2:
    if (l != 1)
      return false;
    if (!String_des(in, region, &(*x)->hlo.name))
      return false;
    (*x)->tag = File_Contents_hlo;
    break;
  default:
    return false;
  }
  return true;
}
