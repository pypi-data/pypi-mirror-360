# Gemini CLI MCP Server 开发指南 (gemini.md)

本文档是指导 Gemini CLI 在此项目中进行所有开发、分析和代码生成工作的核心纲领。在执行任何任务之前，必须首先完整阅读并理解本文档。

## 1. 项目核心目标

利用 Gemini CLI，基于此 GitHub 仓库中的现有代码，开发和完善一个高性能、可扩展的 MCP (Model Context Protocol) 服务器。

我们将特别依赖 **MCPlanManager** 框架，因为它提供了以下关键优势，这些优势必须在开发过程中得到充分利用和体现：
*   **便捷的代码集成**: 框架设计应简化新功能模块和现有逻辑的接入。
*   **MCP标准支持**: 兼容各种支持MCP的AI客户端
*   **跨平台适应性**: 核心逻辑的实现应与平台特定代码解耦，以支持未来在不同 MCP 平台上的应用。

## 2. 核心开发原则

1.  **代码理解优先**: 在修改或添加任何代码之前，必须首先分析相关的现有模块，确保完全理解其功能、依赖和设计模式。
2.  **遵循 MCPlanManager 框架**: 严格遵守 MCPlanManager 的设计哲学和 API 规范。优先使用框架提供的功能，而不是重新发明轮子。
3.  **模块化与可扩展性**: 新增功能必须以模块化的方式实现，降低耦合度，方便未来维护和扩展。
4.  **性能导向**: 时刻关注代码的性能影响。在涉及数据交换和密集计算的场景，优先考虑利用框架的性能优势。
5.  **安全第一**: 对所有外部输入进行严格的校验和清理，防止潜在的安全漏洞。

## 3. 技术栈与关键组件

这是本项目的技术栈。你的首要任务之一就是分析项目并填充以下空白信息。

*   **编程语言**: `Python`
*   **核心框架**: `MCPlanManager`
*   **构建工具**: `setuptools`
*   **主要依赖库**: `typing_extensions`, `FastMCP`, `uvicorn`, `pydantic`

## 4. 开发工作流

你必须遵循以下步骤来处理开发请求：

1.  **第一步：项目分析 (Analysis)**: 首次运行时，完整扫描整个代码仓库。
2.  **第二步：完善本文档 (Update this Document)**: 基于步骤一的分析结果，填充本文档中所有 `[待...填写]` 的部分。这是你开始具体开发任务前的强制步骤。
3.  **第三步：任务拆解 (Task Decomposition)**: 当接收到一个新的开发需求时（例如“添加一个新指令”），首先将其拆解为具体、可执行的小步骤。
4.  **第四步：代码实现 (Implementation)**: 根据拆解的步骤，在遵循核心原则的前提下，生成或修改代码。
5.  **第五步：测试与验证 (Testing & Verification)**: 解释如何对你生成的代码进行单元测试或集成测试，并提供必要的测试代码或指令。
6.  **第六步：提交与报告 (Commit & Report)**: 准备好 Git 提交信息，并清晰地报告你所做的更改及其原因。

## 5. 项目结构分析 (待 Gemini 完善)

此部分需要你在完成代码库分析后进行填充。

*   **主要模块及其职责**:
    *   `mcplanmanager`: `核心Python包`
    *   `mcplanmanager/plan_manager.py`: `核心PlanManager类`
    *   `mcplanmanager/dependency_tools.py`: `可视化和Prompt工具`
    *   `mcplanmanager/app.py`: `MCP服务器实现`
    *   `server/api_server.py`: `HTTP服务器`
*   **关键配置文件**:
    *   `pyproject.toml`: `项目构建和依赖管理`
    *   `examples/mcp_configs/*.json`: `MCP客户端配置`
*   **核心数据结构/类**:
    *   `PlanManager`: `管理任务计划的生命周期`
*   **API 入口点**:
    *   `mcplanmanager.app:main`: `MCP服务器入口`

## 6. 当前开发任务 (待指定)

此列表将由用户提供，作为你当前工作周期的主要目标。

*   `[ ] 示例任务：实现一个新的 `/fly` 指令。`
*   `[ ] ...`

## 7. 代码风格与质量要求

*   **遵循项目现有风格**: 你的代码风格（包括命名、缩进、注释风格）必须与项目中已有的代码保持一致。
*   **添加必要的注释**: 对复杂的逻辑、公开的 API 以及关键的配置项添加清晰、简洁的 Javadoc 或行内注释。
*   **全面的错误处理**: 确保所有可能出现异常的地方都有恰当的 try-catch-finally 块或错误处理逻辑。