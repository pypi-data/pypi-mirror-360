var Bt=Object.defineProperty;var Kt=(l,t,s)=>t in l?Bt(l,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[t]=s;var C=(l,t,s)=>Kt(l,typeof t!="symbol"?t+"":t,s);import{j as Tt,k as Yt,m as At,n as Jt,o as Qt,C as lt,p as _t,q as wt,s as Xt}from"../chunks/BbcV3-AD.mjs";import{aB as Zt,aC as Pt,aD as Gt,U as ot,I as at,aE as te,aF as ee,aG as se,aH as ae,aI as le,aJ as oe,aK as re,aL as ne,aM as ie,aN as ue,aO as de,aP as ce,aQ as pe,aR as me,aS as ge,aT as $e,aU as fe,aV as ve,aW as St,aX as he,aY as be,aZ as ye,a_ as _e,a$ as ke,b0 as Ce,b1 as Ne,b2 as Ie,b3 as Pe,b4 as Oe,K as xt}from"../chunks/6fBxLty2.mjs";import{d as ft,r as Mt,s as L}from"../chunks/BmEJtw2x.mjs";import{c as it}from"../chunks/CdvNA3Mj.mjs";import{i as $t,S as Te}from"../chunks/DiM0wdUe.mjs";import"../chunks/BbkoyQuY.mjs";import{i as Z}from"../chunks/BlVs9ZMX.mjs";import{p as tt,l as Ct,s as Q,m as X,k as $,a as Lt,h as z,f as F,n as B,t as K,b as V,c as g,r as M,_ as D,g as p,d as et,u as a,j as H,e as Nt,i as ut}from"../chunks/3W_oWfQO.mjs";import{p as E,i as It}from"../chunks/D_GJ3sV_.mjs";import{R as pt,e as vt,i as ht}from"../chunks/2Hmh4aao.mjs";import{I as we}from"../chunks/DWOesojy.mjs";import{a as Se}from"../chunks/CNjkM9Bh.mjs";import{d as Y,a as U,s as mt,b as Vt,m as Ut}from"../chunks/D-RwVtBd.mjs";import{T as Ot}from"../chunks/4aNVjcN1.mjs";import{C as bt}from"../chunks/2Z13KoIg.mjs";import{H as j,a as Wt}from"../chunks/9vZc7UWW.mjs";import{E as ct,a as J,S as xe,C as Me,R as De}from"../chunks/Bgmg1D9F.mjs";import{W as He}from"../chunks/joBonB4r.mjs";import{T as Ee}from"../chunks/8l5DqIia.mjs";function Dt(){}function st(l){return l.notetype.case==="globalNotetype"?l.notetype.value:null}function kt(l){return l.deck.case==="deckId"?l.deck.value:null}class Re{constructor(t,s,i,e){C(this,"path");C(this,"deckNameIds");C(this,"notetypeNameIds");C(this,"defaultDelimiter");C(this,"defaultIsHtml");C(this,"defaultNotetypeId");C(this,"defaultDeckId");C(this,"metadata");C(this,"globalNotetype");C(this,"deckId");C(this,"fieldNames");C(this,"columnOptions");C(this,"lastMetadata");C(this,"lastGlobalNotetype");C(this,"lastDeckId");C(this,"fieldNamesSetter",Dt);C(this,"columnOptionsSetter",Dt);var r;this.path=t,this.deckNameIds=i.entries,this.notetypeNameIds=s.entries,this.lastMetadata=it(e),this.metadata=ft(e),this.metadata.subscribe(this.onMetadataChanged.bind(this));const n=st(e);this.lastGlobalNotetype=it(st(e)),this.globalNotetype=ft(it(n)),this.globalNotetype.subscribe(this.onGlobalNotetypeChanged.bind(this)),this.lastDeckId=kt(e),this.deckId=ft(kt(e)),this.deckId.subscribe(this.onDeckIdChanged.bind(this)),this.fieldNames=Mt(n===null?Promise.resolve([]):Tt({ntid:n.id}).then(o=>o.vals),o=>{this.fieldNamesSetter=o}),this.columnOptions=Mt(Ht(e),o=>{this.columnOptionsSetter=o}),this.defaultDelimiter=e.delimiter,this.defaultIsHtml=e.isHtml,this.defaultNotetypeId=((r=this.lastGlobalNotetype)==null?void 0:r.id)||null,this.defaultDeckId=this.lastDeckId}doImport(){return Yt({path:this.path,metadata:{...this.lastMetadata,preview:[]}},{alertOnError:!1})}async onMetadataChanged(t){var e,n,r;if($t(t,this.lastMetadata))return;const s=this.shouldRefetchMetadata(t);if(s){const{globalTags:o,updatedTags:u}=t;t=await At({path:this.path,delimiter:t.delimiter,notetypeId:(e=st(t))==null?void 0:e.id,deckId:(n=kt(t))!=null?n:void 0,isHtml:t.isHtml}),t.globalTags=o,t.updatedTags=u}const i=st(t);this.globalNotetype.set(i),i!==null&&i.id!==((r=st(this.lastMetadata))==null?void 0:r.id)&&this.fieldNamesSetter(Tt({ntid:i.id}).then(o=>o.vals)),this.shouldRebuildColumnOptions(t)&&this.columnOptionsSetter(Ht(t)),this.lastMetadata=it(t),s&&this.metadata.set(t)}shouldRefetchMetadata(t){var s,i;return t.delimiter!==this.lastMetadata.delimiter||t.isHtml!==this.lastMetadata.isHtml||((s=st(t))==null?void 0:s.id)!==((i=st(this.lastMetadata))==null?void 0:i.id)}shouldRebuildColumnOptions(t){return!$t(t.columnLabels,this.lastMetadata.columnLabels)||!$t(t.preview[0],this.lastMetadata.preview[0])}onGlobalNotetypeChanged(t){$t(t,this.lastGlobalNotetype)||(this.lastGlobalNotetype=it(t),t!==null&&this.metadata.update(s=>(s.notetype.value=t,s)))}onDeckIdChanged(t){t!==this.lastDeckId&&(this.lastDeckId=t,t!==null&&this.metadata.update(s=>(s.deck.value=t,s)))}}function Ht(l){const t=Fe(l),s=je(l);return[{label:Zt(),value:0,disabled:!1}].concat(l.columnLabels.map((i,e)=>(e+=1,e===t?dt(Pt(),!0,e):e===s?dt(Gt(),!0,e):e===l.guidColumn?dt("GUID",!0,e):i===""?dt(l.preview[0].vals[e-1],!1,e,!0):dt(i,!1,e))))}function dt(l,t,s,i){return{label:l?`${s}: ${l}`:s.toString(),shortLabel:i?s.toString():void 0,value:s,disabled:t}}function je(l){return l.deck.case==="deckColumn"?l.deck.value:null}function Fe(l){return l.notetype.case==="notetypeColumn"?l.notetype.value:null}const ze=async({params:l})=>{const[t,s,i]=await Promise.all([Jt({}),Qt({skipEmptyDefault:!1,includeFiltered:!1}),At({path:l.path},{alertOnError:!1})]);return{state:new Re(l.path,t,s,i)}},Cs=Object.freeze(Object.defineProperty({__proto__:null,load:ze},Symbol.toStringTag,{value:"Module"}));var Ae=z('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1),Ge=z('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1);function Et(l,t){tt(t,!1);const s=X();let i=E(t,"label",8),e=E(t,"columnOptions",8),n=E(t,"value",12);Ct(()=>($(e()),$(n())),()=>{var u;Q(s,(u=e().find(f=>f.value===n()))==null?void 0:u.label)}),Lt(),Z();var r=Ge(),o=F(r);ot(o,()=>({"--cols":2})),pt(o.lastChild,{children:(u,f)=>{var b=Ae(),d=F(b);ot(d,()=>({"--col-size":1})),bt(d.lastChild,{children:(y,P)=>{B();var c=K();V(()=>L(c,i())),g(y,c)},$$slots:{default:!0}}),M(d);var w=D(d,2);ot(w,()=>({"--col-size":1})),bt(w.lastChild,{children:(y,P)=>{Te(y,{get label(){return p(s)},get list(){return e()},parser:c=>({content:c.label,value:c.value,disabled:c.disabled}),get value(){return n()},set value(c){n(c)},$$legacy:!0})},$$slots:{default:!0}}),M(w),g(u,b)},$$slots:{default:!0}}),M(o),g(l,r),et()}var Le=z("<!> <!>",1);function Ve(l,t){tt(t,!1);const[s,i]=mt(),e=()=>U(b,"$globalNotetype",s),n=()=>U(d,"$fieldNamesPromise",s),r=()=>U(w,"$columnOptions",s),o=()=>U(f,"$metadata",s);let u=E(t,"state",8);const f=u().metadata,b=u().globalNotetype,d=u().fieldNames,w=u().columnOptions;Z();const y=H(()=>($(at),a(()=>te())));Ot(l,{get title(){return p(y)},children:(P,c)=>{var N=Le(),O=F(N);{var T=_=>{var I=Nt(),R=F(I);Se(R,n,null,(k,A)=>{var G=Nt(),rt=F(G);vt(rt,1,()=>p(A),ht,(gt,yt,m)=>{const W=H(()=>(r(),a(()=>m===0?r().slice(1):r())));Et(gt,{get label(){return p(yt)},get columnOptions(){return p(W)},get value(){return e().fieldColumns[m]},set value(h){Y(b,a(e).fieldColumns[m]=h,a(e))},$$legacy:!0})}),g(k,G)}),g(_,I)};It(O,_=>{e()!==null&&_(T)})}var S=D(O,2);const v=H(()=>($(at),a(()=>ee())));Et(S,{get label(){return p(v)},get columnOptions(){return r()},get value(){return o().tagsColumn},set value(_){Y(f,a(o).tagsColumn=_,a(o))},$$legacy:!0}),g(P,N)},$$slots:{default:!0}}),et(),i()}function Rt(){return[{label:se(),value:lt.TAB},{label:ae(),value:lt.PIPE},{label:le(),value:lt.SEMICOLON},{label:oe(),value:lt.COLON},{label:re(),value:lt.COMMA},{label:ne(),value:lt.SPACE}]}function jt(){return[{label:ie(),value:_t.UPDATE},{label:ue(),value:_t.PRESERVE},{label:de(),value:_t.DUPLICATE}]}function Ft(){return[{label:Pt(),value:wt.NOTETYPE},{label:ce(),value:wt.NOTETYPE_AND_DECK}]}var Ue=z('<th class="svelte-ezvffl"> </th>'),We=z('<td class="svelte-ezvffl"> </td>'),qe=z('<tr class="svelte-ezvffl"></tr>'),Be=z('<div class="outer svelte-ezvffl"><table class="preview svelte-ezvffl"><thead><tr class="svelte-ezvffl"></tr></thead><tbody></tbody></table></div> <!>',1);function Ke(l,t){tt(t,!1);const[s,i]=mt(),e=()=>U(f,"$metadata",s),n=()=>U(b,"$columnOptions",s),r=X();let o=E(t,"state",8),u=E(t,"maxColumns",8,1e3);const f=o().metadata,b=o().columnOptions;let d=X(),w=X(!1);function y(_){let I=!1;return{rows:_.map(k=>k.vals.length>u()?(I=!0,k.vals.slice(0,u())):k.vals),truncated:I}}Ct(()=>(p(d),p(w),e()),()=>{(_=>{Q(d,_.rows),Q(w,_.truncated)})(y(e().preview))}),Ct(()=>(p(w),$(u())),()=>{Q(r,p(w)?pe({count:u()}):"")}),Lt(),Z();var P=Be(),c=F(P),N=ut(c),O=ut(N),T=ut(O);vt(T,5,()=>(n(),a(()=>n().slice(1))),ht,(_,I)=>{let R=()=>p(I).label,k=()=>p(I).shortLabel;var A=Ue(),G=ut(A,!0);M(A),V(()=>L(G,k()||R())),g(_,A)}),M(T),M(O);var S=D(O);vt(S,5,()=>p(d),ht,(_,I)=>{var R=qe();vt(R,5,()=>p(I),ht,(k,A)=>{var G=We(),rt=ut(G,!0);M(G),V(()=>L(rt,p(A))),g(k,G)}),M(R),g(_,R)}),M(S),M(N),M(c);var v=D(c,2);He(v,{get warning(){return p(r)}}),g(l,P),et(),i()}var Ye=z("<!> <!> <!>",1);function Je(l,t){tt(t,!1);const[s,i]=mt(),e=()=>U(r,"$metadata",s);let n=E(t,"state",8);const r=n().metadata,o={delimiter:{title:fe(),help:$e(),url:j.TextImporting.root},isHtml:{title:ge(),help:me(),url:j.TextImporting.html}},u=Object.values(o);let f=X(),b=X();function d(y){p(f).show(),p(b).to(y)}Z();const w=H(()=>($(at),a(()=>St())));Ot(l,{get title(){return p(w)},children:(y,P)=>{var c=Ye(),N=F(c);const O=H(()=>($(Rt),a(Rt)));ct(N,{get defaultValue(){return $(n()),a(()=>n().defaultDelimiter)},get choices(){return p(O)},get disabled(){return e(),a(()=>e().forceDelimiter)},get value(){return e().delimiter},set value(v){Y(r,a(e).delimiter=v,a(e))},children:(v,_)=>{J(v,{$$events:{click:()=>d(Object.keys(o).indexOf("delimiter"))},children:(I,R)=>{B();var k=K();V(A=>L(k,A),[()=>(e(),$(at),a(()=>e().forceDelimiter?o.delimiter.title:ve()))],H),g(I,k)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0});var T=D(N,2);xe(T,{get defaultValue(){return $(n()),a(()=>n().defaultIsHtml)},get disabled(){return e(),a(()=>e().forceIsHtml)},get value(){return e().isHtml},set value(v){Y(r,a(e).isHtml=v,a(e))},children:(v,_)=>{J(v,{$$events:{click:()=>d(Object.keys(o).indexOf("isHtml"))},children:(I,R)=>{B();var k=K();V(()=>L(k,a(()=>o.isHtml.title))),g(I,k)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0});var S=D(T,2);Ke(S,{get state(){return n()}}),g(y,c)},$$slots:{default:!0,tooltip:(y,P)=>{const c=H(()=>($(at),a(()=>St())));Wt(y,{get title(){return p(c)},get url(){return $(j),a(()=>j.TextImporting.root)},slot:"tooltip",get helpSections(){return u},$$events:{mount:N=>{Q(f,N.detail.modal),Q(b,N.detail.carousel)}}})}}}),et(),i()}var Qe=z('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1),Xe=z('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1);function zt(l,t){tt(t,!1);const[s,i]=mt(),e=()=>U(u,"$tagsWritable",s);let n=E(t,"tags",12),r=E(t,"keyCombination",8,void 0),o=E(t,"breakpoint",8,"md");const u=ft(n());Z();var f=Xe(),b=F(f);ot(b,()=>({"--cols":13})),pt(b.lastChild,{children:(d,w)=>{var y=Qe(),P=F(y);ot(P,()=>({"--col-size":7})),bt(P.lastChild,{get breakpoint(){return o()},children:(N,O)=>{var T=Nt(),S=F(T);Xt(S,t,"default",{}),g(N,T)},$$slots:{default:!0}}),M(P);var c=D(P,2);ot(c,()=>({"--col-size":6})),bt(c.lastChild,{get breakpoint(){return o()},children:(N,O)=>{Me(N,{children:(T,S)=>{Ee(T,{get tags(){return u},get keyCombination(){return r()},$$events:{tagsupdate:({detail:v})=>n(v.tags)}})},$$slots:{default:!0,revert:(T,S)=>{De(T,{slot:"revert",defaultValue:[],get value(){return Ut(),e()},set value(v){Vt(u,v)},$$legacy:!0})}}})},$$slots:{default:!0}}),M(c),g(d,y)},$$slots:{default:!0}}),M(b),g(l,f),et(),i()}var Ze=z("<!> <!> <!> <!> <!> <!>",1);function ts(l,t){tt(t,!1);const[s,i]=mt(),e=()=>U(f,"$globalNotetype",s),n=()=>U(b,"$deckId",s),r=()=>U(u,"$metadata",s);let o=E(t,"state",8);const u=o().metadata,f=o().globalNotetype,b=o().deckId,d={notetype:{title:Pt(),help:Oe(),url:j.TextImporting.root},deck:{title:Gt(),help:Pe(),url:j.TextImporting.root},dupeResolution:{title:Ie(),help:Ne(),url:j.TextImporting.updating},matchScope:{title:Ce(),help:ke(),url:j.TextImporting.updating},globalTags:{title:_e(),help:ye(),url:j.TextImporting.root},updatedTags:{title:be(),help:he(),url:j.TextImporting.root}},w=Object.values(d);let y=X(),P=X();function c(O){p(y).show(),p(P).to(O)}Z();const N=H(()=>($(at),a(()=>xt())));Ot(l,{get title(){return p(N)},children:(O,T)=>{var S=Ze(),v=F(S);{var _=m=>{const W=H(()=>($(o()),a(()=>o().notetypeNameIds.map(({id:h,name:q})=>({label:q,value:h})))));ct(m,{get defaultValue(){return $(o()),a(()=>o().defaultNotetypeId)},get choices(){return p(W)},get value(){return e().id},set value(h){Y(f,a(e).id=h,a(e))},children:(h,q)=>{J(h,{$$events:{click:()=>c(Object.keys(d).indexOf("notetype"))},children:(x,qt)=>{B();var nt=K();V(()=>L(nt,a(()=>d.notetype.title))),g(x,nt)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0})};It(v,m=>{e()!==null&&m(_)})}var I=D(v,2);{var R=m=>{const W=H(()=>($(o()),a(()=>o().deckNameIds.map(({id:h,name:q})=>({label:q,value:h})))));ct(m,{get defaultValue(){return $(o()),a(()=>o().defaultDeckId)},get choices(){return p(W)},get value(){return Ut(),n()},set value(h){Vt(b,h)},children:(h,q)=>{J(h,{$$events:{click:()=>c(Object.keys(d).indexOf("deck"))},children:(x,qt)=>{B();var nt=K();V(()=>L(nt,a(()=>d.deck.title))),g(x,nt)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0})};It(I,m=>{n()!==null&&m(R)})}var k=D(I,2);const A=H(()=>($(jt),a(jt)));ct(k,{defaultValue:0,get choices(){return p(A)},get value(){return r().dupeResolution},set value(m){Y(u,a(r).dupeResolution=m,a(r))},children:(m,W)=>{J(m,{$$events:{click:()=>c(Object.keys(d).indexOf("dupeResolution"))},children:(h,q)=>{B();var x=K();V(()=>L(x,a(()=>d.dupeResolution.title))),g(h,x)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0});var G=D(k,2);const rt=H(()=>($(Ft),a(Ft)));ct(G,{defaultValue:0,get choices(){return p(rt)},get value(){return r().matchScope},set value(m){Y(u,a(r).matchScope=m,a(r))},children:(m,W)=>{J(m,{$$events:{click:()=>c(Object.keys(d).indexOf("matchScope"))},children:(h,q)=>{B();var x=K();V(()=>L(x,a(()=>d.matchScope.title))),g(h,x)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0});var gt=D(G,2);zt(gt,{keyCombination:"Control+T",get tags(){return r().globalTags},set tags(m){Y(u,a(r).globalTags=m,a(r))},children:(m,W)=>{J(m,{$$events:{click:()=>c(Object.keys(d).indexOf("globalTags"))},children:(h,q)=>{B();var x=K();V(()=>L(x,a(()=>d.globalTags.title))),g(h,x)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0});var yt=D(gt,2);zt(yt,{keyCombination:"Control+Shift+T",get tags(){return r().updatedTags},set tags(m){Y(u,a(r).updatedTags=m,a(r))},children:(m,W)=>{J(m,{$$events:{click:()=>c(Object.keys(d).indexOf("updatedTags"))},children:(h,q)=>{B();var x=K();V(()=>L(x,a(()=>d.updatedTags.title))),g(h,x)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0}),g(O,S)},$$slots:{default:!0,tooltip:(O,T)=>{const S=H(()=>($(at),a(()=>xt())));Wt(O,{get title(){return p(S)},get url(){return $(j),a(()=>j.TextImporting.root)},slot:"tooltip",get helpSections(){return w},$$events:{mount:v=>{Q(y,v.detail.modal),Q(P,v.detail.carousel)}}})}}}),et(),i()}var es=z("<!> <!> <!>",1);function ss(l,t){tt(t,!1);let s=E(t,"state",8);Z(),we(l,{get path(){return $(s()),a(()=>s().path)},get importer(){return s()},children:(i,e)=>{var n=es(),r=F(n);pt(r,{children:(f,b)=>{Je(f,{get state(){return s()}})},$$slots:{default:!0}});var o=D(r,2);pt(o,{children:(f,b)=>{ts(f,{get state(){return s()}})},$$slots:{default:!0}});var u=D(o,2);pt(u,{children:(f,b)=>{Ve(f,{get state(){return s()}})},$$slots:{default:!0}}),g(i,n)},$$slots:{default:!0}}),et()}function Ns(l,t){tt(t,!1);let s=E(t,"data",8);Z(),ss(l,{get state(){return $(s()),a(()=>s().state)}}),et()}export{Ns as component,Cs as universal};
