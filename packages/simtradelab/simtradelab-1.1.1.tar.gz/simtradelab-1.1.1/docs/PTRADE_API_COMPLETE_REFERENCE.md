# æ–‡æ¡£å·²è¿ç§» ğŸ“š

> **é‡è¦æç¤º**: æ­¤æ–‡æ¡£å·²æ•´åˆåˆ°æ–°çš„ç»Ÿä¸€APIå‚è€ƒæ–‡æ¡£ä¸­ã€‚

è¯·å‚è€ƒæœ€æ–°çš„å®Œæ•´æ–‡æ¡£ï¼š**[SimTradeLab API å®Œæ•´å‚è€ƒæ–‡æ¡£](SIMTRADELAB_API_COMPLETE_REFERENCE.md)**

æ–°æ–‡æ¡£åŒ…å«äº†ï¼š
- âœ… å®Œæ•´çš„APIæ¥å£è¯´æ˜
- âœ… PTradeå…¼å®¹æ€§æŒ‡å—
- âœ… ä½¿ç”¨ç¤ºä¾‹å’Œæœ€ä½³å®è·µ
- âœ… é…ç½®å’Œéƒ¨ç½²è¯´æ˜
- âœ… æ•…éšœæ’é™¤å’Œå¸¸è§é—®é¢˜

---

## å†å²æ–‡æ¡£å†…å®¹

ä»¥ä¸‹ä¸ºåŸå§‹PTrade APIå‚è€ƒå†…å®¹ï¼Œå·²æ•´åˆåˆ°æ–°æ–‡æ¡£ä¸­ï¼š

## APIæ–‡æ¡£

### ä½¿ç”¨è¯´æ˜

#### æ–°å»ºç­–ç•¥

å¼€å§‹å›æµ‹å’Œäº¤æ˜“å‰éœ€è¦å…ˆæ–°å»ºç­–ç•¥ï¼Œç‚¹å‡»ä¸‹å›¾ä¸­å·¦ä¸Šè§’æ ‡è¯†è¿›è¡Œç­–ç•¥æ·»åŠ ã€‚å¯ä»¥é€‰æ‹©ä¸åŒçš„ä¸šåŠ¡ç±»å‹ï¼ˆæ¯”å¦‚è‚¡ç¥¨ï¼‰ï¼Œç„¶åç»™ç­–ç•¥è®¾å®šä¸€ä¸ªåç§°ï¼Œæ·»åŠ æˆåŠŸåå¯ä»¥åœ¨é»˜è®¤ç­–ç•¥æ¨¡æ¿åŸºç¡€ä¸Šè¿›è¡Œç­–ç•¥ç¼–å†™ã€‚

#### æ–°å»ºå›æµ‹

ç­–ç•¥æ·»åŠ å®Œæˆåå°±å¯ä»¥å¼€å§‹è¿›è¡Œå›æµ‹æ“ä½œäº†ã€‚å›æµ‹ä¹‹å‰éœ€è¦å¯¹å¼€å§‹æ—¶é—´ã€ç»“æŸæ—¶é—´ã€å›æµ‹èµ„é‡‘ã€å›æµ‹åŸºå‡†ã€å›æµ‹é¢‘ç‡å‡ ä¸ªè¦ç´ è¿›è¡Œè®¾å®šï¼Œè®¾å®šå®Œæ¯•åç‚¹å‡»ä¿å­˜ã€‚ç„¶åå†ç‚¹å‡»å›æµ‹æŒ‰é”®ï¼Œç³»ç»Ÿå°±ä¼šå¼€å§‹è¿è¡Œå›æµ‹ï¼Œå›æµ‹çš„è¯„ä»·æŒ‡æ ‡ã€æ”¶ç›Šæ›²çº¿ã€æ—¥å¿—éƒ½ä¼šåœ¨ç•Œé¢ä¸­å±•ç°ã€‚

#### æ–°å»ºäº¤æ˜“

äº¤æ˜“ç•Œé¢ç‚¹å‡»æ–°å¢æŒ‰é”®è¿›è¡Œæ–°å¢äº¤æ˜“æ“ä½œï¼Œç­–ç•¥æ–¹æ¡ˆä¸­çš„å¯¹è±¡ä¸ºæ‰€æœ‰ç­–ç•¥åˆ—è¡¨ä¸­çš„ç­–ç•¥ï¼Œç»™æœ¬æ¬¡äº¤æ˜“è®¾å®šåç§°å¹¶ç‚¹å‡»ç¡®å®šåç³»ç»Ÿå°±å¼€å§‹è¿è¡Œäº¤æ˜“äº†ã€‚

äº¤æ˜“å¼€å§‹è¿è¡Œåï¼Œå¯ä»¥å®æ—¶çœ‹åˆ°æ€»èµ„äº§å’Œå¯ç”¨èµ„é‡‘æƒ…å†µï¼ŒåŒæ—¶å¯ä»¥åœ¨äº¤æ˜“åˆ—è¡¨æŸ¥è¯¢äº¤æ˜“çŠ¶æ€ã€‚

äº¤æ˜“å¼€å§‹è¿è¡Œåï¼Œå¯ä»¥ç‚¹å‡»äº¤æ˜“è¯¦æƒ…ï¼ŒæŸ¥çœ‹ç­–ç•¥è¯„ä»·æŒ‡æ ‡ã€äº¤æ˜“æ˜ç»†ã€æŒä»“æ˜ç»†ã€äº¤æ˜“æ—¥å¿—ã€‚

#### ç­–ç•¥è¿è¡Œå‘¨æœŸ

å›æµ‹æ”¯æŒæ—¥çº¿çº§åˆ«ã€åˆ†é’Ÿçº§åˆ«è¿è¡Œï¼Œè¯¦è§handle_dataæ–¹æ³•ã€‚

äº¤æ˜“æ”¯æŒæ—¥çº¿çº§åˆ«ã€åˆ†é’Ÿçº§åˆ«ã€tickçº§åˆ«è¿è¡Œï¼Œæ—¥çº¿çº§åˆ«å’Œåˆ†é’Ÿçº§åˆ«è¯¦è§handle_dataæ–¹æ³•ï¼Œtickçº§åˆ«è¿è¡Œè¯¦è§run_intervalå’Œtick_dataæ–¹æ³•ã€‚

é¢‘ç‡ï¼šæ—¥çº¿çº§åˆ«

å½“é€‰æ‹©æ—¥çº¿é¢‘ç‡æ—¶ï¼Œå›æµ‹å’Œäº¤æ˜“éƒ½æ˜¯æ¯å¤©è¿è¡Œä¸€æ¬¡ï¼Œè¿è¡Œæ—¶é—´ä¸ºæ¯å¤©ç›˜åã€‚

é¢‘ç‡ï¼šåˆ†é’Ÿçº§åˆ«

å½“é€‰æ‹©åˆ†é’Ÿé¢‘ç‡æ—¶ï¼Œå›æµ‹å’Œäº¤æ˜“éƒ½æ˜¯æ¯åˆ†é’Ÿè¿è¡Œä¸€æ¬¡ï¼Œè¿è¡Œæ—¶é—´ä¸ºæ¯æ ¹åˆ†é’ŸKçº¿ç»“æŸã€‚

é¢‘ç‡ï¼štickçº§åˆ«

å½“é€‰æ‹©tické¢‘ç‡æ—¶ï¼Œäº¤æ˜“æœ€å°é¢‘ç‡å¯ä»¥è¾¾åˆ°3ç§’è¿è¡Œä¸€æ¬¡ã€‚

#### ç­–ç•¥è¿è¡Œæ—¶é—´

ç›˜å‰è¿è¡Œ:

9:30åˆ†é’Ÿä¹‹å‰ä¸ºç›˜å‰è¿è¡Œæ—¶é—´ï¼Œäº¤æ˜“ç¯å¢ƒæ”¯æŒè¿è¡Œåœ¨run_dailyä¸­æŒ‡å®šäº¤æ˜“æ—¶é—´(å¦‚time='09:15')è¿è¡Œçš„å‡½æ•°ï¼›å›æµ‹ç¯å¢ƒå’Œäº¤æ˜“ç¯å¢ƒæ”¯æŒè¿è¡Œbefore_trading_startå‡½æ•°

ç›˜ä¸­è¿è¡Œ:

9:31(å›æµ‹)/9:30(äº¤æ˜“)~15:00åˆ†é’Ÿä¸ºç›˜ä¸­è¿è¡Œæ—¶é—´ï¼Œåˆ†é’Ÿçº§åˆ«å›æµ‹ç¯å¢ƒå’Œäº¤æ˜“ç¯å¢ƒæ”¯æŒè¿è¡Œåœ¨run_dailyä¸­æŒ‡å®šäº¤æ˜“æ—¶é—´(å¦‚time='14:30')è¿è¡Œçš„å‡½æ•°ï¼›å›æµ‹ç¯å¢ƒå’Œäº¤æ˜“ç¯å¢ƒæ”¯æŒè¿è¡Œhandle_dataå‡½æ•°ï¼›äº¤æ˜“ç¯å¢ƒæ”¯æŒè¿è¡Œrun_intervalå‡½æ•°

ç›˜åè¿è¡Œ:

15:30åˆ†é’Ÿä¸ºç›˜åè¿è¡Œæ—¶é—´ï¼Œå›æµ‹ç¯å¢ƒå’Œäº¤æ˜“ç¯å¢ƒæ”¯æŒè¿è¡Œafter_trading_endå‡½æ•°(è¯¥å‡½æ•°ä¸ºå®šæ—¶è¿è¡Œ)ï¼›15:00ä¹‹åäº¤æ˜“ç¯å¢ƒæ”¯æŒè¿è¡Œåœ¨run_dailyä¸­æŒ‡å®šäº¤æ˜“æ—¶é—´(å¦‚time='15:10')è¿è¡Œçš„å‡½æ•°ï¼Œ

#### äº¤æ˜“ç­–ç•¥å§”æ‰˜ä¸‹å•æ—¶é—´

ä½¿ç”¨orderç³»åˆ—æ¥å£è¿›è¡Œè‚¡ç¥¨å§”æ‰˜ä¸‹å•ï¼Œå°†ç›´æ¥æŠ¥å•åˆ°æŸœå°ã€‚

#### å›æµ‹æ”¯æŒä¸šåŠ¡ç±»å‹

ç›®å‰æ‰€æ”¯æŒçš„ä¸šåŠ¡ç±»å‹:

1.æ™®é€šè‚¡ç¥¨ä¹°å–(å•ä½ï¼šè‚¡)ã€‚

2.å¯è½¬å€ºä¹°å–(å•ä½ï¼šå¼ ï¼ŒT+0)ã€‚

3.èèµ„èåˆ¸æ‹…ä¿å“ä¹°å–(å•ä½ï¼šè‚¡)ã€‚

4.æœŸè´§æŠ•æœºç±»å‹äº¤æ˜“(å•ä½ï¼šæ‰‹ï¼ŒT+0)ã€‚

5.LOFåŸºé‡‘ä¹°å–(å•ä½ï¼šè‚¡)ã€‚

6.ETFåŸºé‡‘ä¹°å–(å•ä½ï¼šè‚¡)ã€‚

#### äº¤æ˜“æ”¯æŒä¸šåŠ¡ç±»å‹

ç›®å‰æ‰€æ”¯æŒçš„ä¸šåŠ¡ç±»å‹:

1.æ™®é€šè‚¡ç¥¨ä¹°å–(å•ä½ï¼šè‚¡)ã€‚

2.å¯è½¬å€ºä¹°å–(å…·ä½“å•ä½è¯·å’¨è¯¢åˆ¸å•†ï¼ŒT+0)ã€‚

3.èèµ„èåˆ¸äº¤æ˜“(å•ä½ï¼šè‚¡)ã€‚

4.ETFç”³èµã€å¥—åˆ©(å•ä½ï¼šä»½)ã€‚

5.å›½å€ºé€†å›è´­(å•ä½ï¼šä»½)ã€‚

6.æœŸè´§æŠ•æœºç±»å‹äº¤æ˜“(å•ä½ï¼šæ‰‹ï¼ŒT+0)ã€‚

7.LOFåŸºé‡‘ä¹°å–(å•ä½ï¼šè‚¡)ã€‚

8.ETFåŸºé‡‘ä¹°å–(å•ä½ï¼šè‚¡)ã€‚

9.æœŸæƒäº¤æ˜“(å•ä½ï¼šæ‰‹)ã€‚

### å¼€å§‹å†™ç­–ç•¥

#### ç®€å•ä½†æ˜¯å®Œæ•´çš„ç­–ç•¥

å…ˆæ¥çœ‹ä¸€ä¸ªç®€å•ä½†æ˜¯å®Œæ•´çš„ç­–ç•¥:

```python
def initialize(context):
    set_universe('600570.SS')

def handle_data(context, data):
    pass
```

ä¸€ä¸ªå®Œæ•´ç­–ç•¥åªéœ€è¦ä¸¤æ­¥:

1. set_universe: è®¾ç½®æˆ‘ä»¬è¦æ“ä½œçš„è‚¡ç¥¨æ± ï¼Œä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œåªæ“ä½œä¸€æ”¯è‚¡ç¥¨: '600570.SS'ï¼Œæ’ç”Ÿç”µå­ã€‚æ‰€æœ‰çš„æ“ä½œåªèƒ½å¯¹è‚¡ç¥¨æ± çš„æ ‡çš„è¿›è¡Œã€‚
2. å®ç°ä¸€ä¸ªå‡½æ•°: handle_dataã€‚

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç­–ç•¥ï¼Œä½†æ˜¯æˆ‘ä»¬æ²¡æœ‰ä»»ä½•äº¤æ˜“ï¼Œä¸‹é¢æˆ‘ä»¬æ¥æ·»åŠ ä¸€äº›äº¤æ˜“

#### æ·»åŠ ä¸€äº›äº¤æ˜“

```python
def initialize(context):
    g.security = '600570.SS'
    # æ˜¯å¦åˆ›å»ºè®¢å•æ ‡è¯†
    g.flag = False
    set_universe(g.security)

def handle_data(context, data):
    if not g.flag:
        order(g.security, 1000)
        g.flag = True
```

è¿™ä¸ªç­–ç•¥é‡Œï¼Œå½“æˆ‘ä»¬æ²¡æœ‰åˆ›å»ºè®¢å•æ—¶å°±ä¹°å…¥1000è‚¡'600570.SS'ï¼Œå…·ä½“çš„ä¸‹å•APIè¯·çœ‹orderå‡½æ•°ã€‚è¿™é‡Œæˆ‘ä»¬æœ‰äº†äº¤æ˜“ï¼Œä½†æ˜¯åªæ˜¯æ— æ„ä¹‰çš„äº¤æ˜“ï¼Œæ²¡æœ‰ä¾æ®å½“å‰çš„æ•°æ®åšå‡ºåˆç†çš„åˆ†æã€‚

#### å®ç”¨çš„ç­–ç•¥

ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªçœŸæ­£å®ç”¨çš„ç­–ç•¥

åœ¨è¿™ä¸ªç­–ç•¥é‡Œï¼Œæˆ‘ä»¬ä¼šæ ¹æ®å†å²ä»·æ ¼åšå‡ºåˆ¤æ–­:

- å¦‚æœä¸Šä¸€æ—¶é—´ç‚¹ä»·æ ¼é«˜å‡ºäº”å¤©å¹³å‡ä»·1%ï¼Œåˆ™å…¨ä»“ä¹°å…¥
- å¦‚æœä¸Šä¸€æ—¶é—´ç‚¹ä»·æ ¼ä½äºäº”å¤©å¹³å‡ä»·ï¼Œåˆ™ç©ºä»“å–å‡º

```python
def initialize(context):
    g.security = '600570.SS'
    set_universe(g.security)
    
def handle_data(context, data):
    security = g.security
    sid = g.security
    
    # å–å¾—è¿‡å»äº”å¤©çš„å†å²ä»·æ ¼
    df = get_history(5, '1d', 'close', security, fq=None, include=False)
    
    # å–å¾—è¿‡å»äº”å¤©çš„å¹³å‡ä»·æ ¼
    average_price = round(df['close'][-5:].mean(), 3)

    # å–å¾—ä¸Šä¸€æ—¶é—´ç‚¹ä»·æ ¼
    current_price = data[sid]['close']
    
    # å–å¾—å½“å‰çš„ç°é‡‘
    cash = context.portfolio.cash
    
    # å¦‚æœä¸Šä¸€æ—¶é—´ç‚¹ä»·æ ¼é«˜å‡ºäº”å¤©å¹³å‡ä»·1%, åˆ™å…¨ä»“ä¹°å…¥
    if current_price > 1.01*average_price:
        # ç”¨æ‰€æœ‰ cash ä¹°å…¥è‚¡ç¥¨
        order_value(g.security, cash)
        log.info('buy %s' % g.security)
    # å¦‚æœä¸Šä¸€æ—¶é—´ç‚¹ä»·æ ¼ä½äºäº”å¤©å¹³å‡ä»·, åˆ™ç©ºä»“å–å‡º
    elif current_price < average_price and get_position(security).amount > 0:
        # å–å‡ºæ‰€æœ‰è‚¡ç¥¨,ä½¿è¿™åªè‚¡ç¥¨çš„æœ€ç»ˆæŒæœ‰é‡ä¸º0
        order_target(g.security, 0)
        log.info('sell %s' % g.security)
```

#### æ¨¡æ‹Ÿç›˜å’Œå®ç›˜æ³¨æ„äº‹é¡¹

##### å…³äºæŒä¹…åŒ–

###### ä¸ºä»€ä¹ˆè¦åšæŒä¹…åŒ–å¤„ç†

æœåŠ¡å™¨å¼‚å¸¸ã€ç­–ç•¥ä¼˜åŒ–ç­‰è¯¸å¤šåœºæ™¯ï¼Œéƒ½ä¼šä½¿å¾—æ­£åœ¨è¿›è¡Œçš„æ¨¡æ‹Ÿç›˜å’Œå®ç›˜ç­–ç•¥å­˜åœ¨ä¸­æ–­åå†é‡å¯çš„éœ€æ±‚ï¼Œä½†æ˜¯ä¸€æ—¦äº¤æ˜“ä¸­æ­¢åï¼Œç­–ç•¥ä¸­å­˜å‚¨åœ¨å†…å­˜ä¸­çš„å…¨å±€å˜é‡å°±æ¸…ç©ºäº†ï¼Œå› æ­¤é€šè¿‡æŒä¹…åŒ–å¤„ç†ä¸ºé‡åŒ–äº¤æ˜“ä¿é©¾æŠ¤èˆªå¿…ä¸å¯å°‘ã€‚

###### é‡åŒ–æ¡†æ¶æŒä¹…åŒ–å¤„ç†

ä½¿ç”¨pickleæ¨¡å—ä¿å­˜è‚¡ç¥¨æ± ã€è´¦æˆ·ä¿¡æ¯ã€è®¢å•ä¿¡æ¯ã€å…¨å±€å˜é‡gå®šä¹‰çš„å˜é‡ç­‰å†…å®¹ã€‚

æ³¨æ„äº‹é¡¹ï¼š

1. æ¡†æ¶ä¼šåœ¨before_trading_startï¼ˆéš”æ—¥å¼€å§‹ï¼‰ã€handle_dataã€after_trading_endäº‹ä»¶åè§¦å‘æŒä¹…åŒ–ä¿¡æ¯æ›´æ–°åŠä¿å­˜æ“ä½œï¼›
2. åˆ¸å•†å‡çº§/ç¯å¢ƒé‡å¯åæ¢å¤äº¤æ˜“æ—¶ï¼Œæ¡†æ¶ä¼šå…ˆæ‰§è¡Œç­–ç•¥initializeå‡½æ•°å†æ‰§è¡ŒæŒä¹…åŒ–ä¿¡æ¯æ¢å¤æ“ä½œã€‚å¦‚æœæŒä¹…åŒ–ä¿¡æ¯ä¿å­˜æœ‰ç­–ç•¥å®šä¹‰çš„å…¨å±€å¯¹è±¡gä¸­çš„å˜é‡ï¼Œå°†ä¼šä»¥æŒä¹…åŒ–ä¿¡æ¯ä¸­çš„å˜é‡è¦†ç›–æ‰initializeå‡½æ•°ä¸­åˆå§‹åŒ–çš„è¯¥å˜é‡ã€‚
3. å…¨å±€å˜é‡gä¸­ä¸èƒ½è¢«åºåˆ—åŒ–çš„å˜é‡å°†ä¸ä¼šè¢«ä¿å­˜ã€‚æ‚¨å¯åœ¨initializeä¸­åˆå§‹åŒ–è¯¥å˜é‡æ—¶åå­—ä»¥'__'å¼€å¤´ï¼›
4. æ¶‰åŠåˆ°IO(æ‰“å¼€çš„æ–‡ä»¶ï¼Œå®ä¾‹åŒ–çš„ç±»å¯¹è±¡ç­‰)çš„å¯¹è±¡æ˜¯ä¸èƒ½è¢«åºåˆ—åŒ–çš„ï¼›
5. å…¨å±€å˜é‡gä¸­ä»¥'__'å¼€å¤´çš„å˜é‡ä¸ºç§æœ‰å˜é‡ï¼ŒæŒä¹…åŒ–æ—¶å°†ä¸ä¼šè¢«ä¿å­˜ï¼›

###### ç¤ºä¾‹

```python
class Test(object):
    count = 5

    def print_info(self):
        self.count += 1
        log.info("a" * self.count)


def initialize(context):
    g.security = "600570.SS"
    set_universe(g.security)
    # åˆå§‹åŒ–æ— æ³•è¢«åºåˆ—åŒ–ç±»å¯¹è±¡ï¼Œå¹¶èµ‹å€¼ä¸ºç§æœ‰å˜é‡ï¼Œè½åœ°æŒä¹…åŒ–ä¿¡æ¯æ—¶è·³è¿‡ä¿å­˜è¯¥å˜é‡
    g.__test_class = Test()

def handle_data(context, data):
    # è°ƒç”¨ç§æœ‰å˜é‡ä¸­å®šä¹‰çš„æ–¹æ³•
    g.__test_class.print_info()
```

###### ç­–ç•¥ä¸­æŒä¹…åŒ–å¤„ç†æ–¹æ³•

ä½¿ç”¨pickleæ¨¡å—ä¿å­˜ g å¯¹è±¡(å…¨å±€å˜é‡)ã€‚

###### ç¤ºä¾‹

```python
import pickle
from collections import defaultdict
NOTEBOOK_PATH = '/home/fly/notebook/'
'''
æŒä»“Næ—¥åå–å‡ºï¼Œä»“é¾„å˜é‡æ¯æ—¥pickleè¿›è¡Œä¿å­˜ï¼Œé‡å¯ç­–ç•¥åå¯ä»¥ä¿è¯é€»è¾‘è¿è´¯
'''
def initialize(context):
    #å°è¯•å¯åŠ¨pickleæ–‡ä»¶
    try:
        with open(NOTEBOOK_PATH+'hold_days.pkl','rb') as f:
            g.hold_days = pickle.load(f)
    #å®šä¹‰ç©ºçš„å…¨å±€å­—å…¸å˜é‡
    except:
        g.hold_days = defaultdict(list)
    g.security = '600570.SS'
    set_universe(g.security)

# ä»“é¾„å¢åŠ ä¸€å¤©
def before_trading_start(context, data):
    if g.hold_days:
        g.hold_days[g.security] += 1
        
# æ¯å¤©å°†å­˜å‚¨ä»“é¾„çš„å­—å…¸å¯¹è±¡è¿›è¡Œpickleä¿å­˜
def handle_data(context, data):
    if g.security not in list(context.portfolio.positions.keys()) and g.security not in g.hold_days:
        order(g.security, 100)
        g.hold_days[g.security] = 1
    if g.hold_days:
        if g.hold_days[g.security] > 5:
            order(g.security, -100)
            del g.hold_days[g.security]
    with open(NOTEBOOK_PATH+'hold_days.pkl','wb') as f:
        pickle.dump(g.hold_days,f,-1)
```

## ç­–ç•¥å¼•æ“ç®€ä»‹

### ä¸šåŠ¡æµç¨‹æ¡†æ¶

ptradeé‡åŒ–å¼•æ“ä»¥äº‹ä»¶è§¦å‘ä¸ºåŸºç¡€ï¼Œé€šè¿‡åˆå§‹åŒ–äº‹ä»¶ï¼ˆinitializeï¼‰ã€ç›˜å‰äº‹ä»¶ï¼ˆbefore_trading_startï¼‰ã€ç›˜ä¸­äº‹ä»¶ï¼ˆhandle_dataï¼‰ã€ç›˜åäº‹ä»¶ï¼ˆafter_trading_endï¼‰æ¥å®Œæˆæ¯ä¸ªäº¤æ˜“æ—¥çš„ç­–ç•¥ä»»åŠ¡ã€‚

initializeå’Œhandle_dataæ˜¯ä¸€ä¸ªå…è®¸è¿è¡Œç­–ç•¥çš„æœ€åŸºç¡€ç»“æ„ï¼Œä¹Ÿå°±æ˜¯å¿…é€‰é¡¹ï¼Œbefore_trading_startå’Œafter_trading_endæ˜¯å¯ä»¥æŒ‰éœ€è¿è¡Œçš„ã€‚

handle_dataä»…æ»¡è¶³æ—¥çº¿å’Œåˆ†é’Ÿçº§åˆ«çš„ç›˜ä¸­å¤„ç†ï¼Œtickçº§åˆ«çš„ç›˜ä¸­å¤„ç†åˆ™éœ€è¦é€šè¿‡tick_dataæˆ–è€…run_intervalæ¥å®ç°ã€‚

ptradeè¿˜æ”¯æŒå§”æ‰˜ä¸»æ¨äº‹ä»¶ï¼ˆon_order_responseï¼‰ã€äº¤æ˜“ä¸»æ¨äº‹ä»¶ï¼ˆon_trade_responseï¼‰ï¼Œå¯ä»¥é€šè¿‡å§”æ‰˜å’Œæˆäº¤çš„ä¿¡æ¯æ¥å¤„ç†ç­–ç•¥é€»è¾‘ï¼Œæ˜¯tickçº§çš„ä¸€ä¸ªè¡¥å……ã€‚

é™¤äº†ä»¥ä¸Šçš„ä¸€äº›äº‹ä»¶ä»¥å¤–ï¼Œptradeä¹Ÿæ”¯æŒé€šè¿‡å®šæ—¶ä»»åŠ¡æ¥è¿è¡Œç­–ç•¥é€»è¾‘ï¼Œå¯ä»¥é€šè¿‡run_dailyæ¥å£å®ç°ã€‚

### initializeï¼ˆå¿…é€‰ï¼‰

```python
initialize(context)
```

#### ä½¿ç”¨åœºæ™¯

è¯¥å‡½æ•°ä»…åœ¨å›æµ‹ã€äº¤æ˜“æ¨¡å—å¯ç”¨

#### æ¥å£è¯´æ˜

è¯¥å‡½æ•°ç”¨äºåˆå§‹åŒ–ä¸€äº›å…¨å±€å˜é‡ï¼Œæ˜¯ç­–ç•¥è¿è¡Œçš„å”¯äºŒå¿…é¡»å®šä¹‰å‡½æ•°ä¹‹ä¸€ã€‚

æ³¨æ„äº‹é¡¹ï¼š

è¯¥å‡½æ•°åªä¼šåœ¨å›æµ‹å’Œäº¤æ˜“å¯åŠ¨çš„æ—¶å€™è¿è¡Œä¸€æ¬¡

#### å¯è°ƒç”¨æ¥å£

set_universe(å›æµ‹/äº¤æ˜“)

set_benchmark(å›æµ‹/äº¤æ˜“)

set_commission(å›æµ‹)

set_fixed_slippage(å›æµ‹)

set_slippage(å›æµ‹)

set_volume_ratio(å›æµ‹)

set_limit_mode(å›æµ‹)

set_yesterday_position(å›æµ‹)

run_daily(å›æµ‹/äº¤æ˜“)

run_interval(äº¤æ˜“)

get_trading_day(ç ”ç©¶/å›æµ‹/äº¤æ˜“)

get_all_trades_days(ç ”ç©¶/å›æµ‹/äº¤æ˜“)

get_trade_days(äº¤æ˜“)

convert_position_from_csv(å›æµ‹)

get_user_name(å›æµ‹/äº¤æ˜“)

is_trade(å›æµ‹/äº¤æ˜“)

get_research_path(å›æµ‹/äº¤æ˜“)

permission_test(äº¤æ˜“)

set_future_commission(å›æµ‹(æœŸè´§))

set_margin_rate(å›æµ‹(æœŸè´§))

get_margin_rate(å›æµ‹(æœŸè´§))

create_dir(å›æµ‹/äº¤æ˜“)

set_parameters(å›æµ‹/äº¤æ˜“)

#### å‚æ•°

context: Contextå¯¹è±¡ï¼Œå­˜æ”¾æœ‰å½“å‰çš„è´¦æˆ·åŠæŒä»“ä¿¡æ¯ï¼›

#### è¿”å›

None

#### ç¤ºä¾‹

```python
def initialize(context):
    #gä¸ºå…¨å±€å¯¹è±¡
    g.security = '600570.SS'
    set_universe(g.security)

def handle_data(context, data):
    order('600570.SS',100)
```

### before_trading_startï¼ˆå¯é€‰ï¼‰

```python
before_trading_start(context, data)
```

#### ä½¿ç”¨åœºæ™¯

è¯¥å‡½æ•°ä»…åœ¨å›æµ‹ã€äº¤æ˜“æ¨¡å—å¯ç”¨

#### æ¥å£è¯´æ˜

è¯¥å‡½æ•°åœ¨æ¯å¤©å¼€å§‹äº¤æ˜“å‰è¢«è°ƒç”¨ä¸€æ¬¡ï¼Œç”¨äºæ·»åŠ æ¯å¤©éƒ½è¦åˆå§‹åŒ–çš„ä¿¡æ¯ï¼Œå¦‚æ— ç›˜å‰åˆå§‹åŒ–éœ€æ±‚ï¼Œè¯¥å‡½æ•°å¯ä»¥åœ¨ç­–ç•¥ä¸­ä¸åšå®šä¹‰ã€‚

æ³¨æ„äº‹é¡¹ï¼š

1. åœ¨å›æµ‹ä¸­ï¼Œè¯¥å‡½æ•°åœ¨æ¯ä¸ªå›æµ‹äº¤æ˜“æ—¥8:30åˆ†æ‰§è¡Œã€‚
2. åœ¨äº¤æ˜“ä¸­ï¼Œè¯¥å‡½æ•°åœ¨å¼€å¯äº¤æ˜“æ—¶ç«‹å³æ‰§è¡Œï¼Œä»éš”æ—¥å¼€å§‹æ¯å¤©9:10åˆ†(é»˜è®¤)æ‰§è¡Œã€‚
3. å½“åœ¨9:10å‰å¼€å¯äº¤æ˜“æ—¶ï¼Œå—è¡Œæƒ…æœªæ›´æ–°åŸå› åœ¨è¯¥å‡½æ•°å†…è°ƒç”¨å®æ—¶è¡Œæƒ…æ¥å£ä¼šå¯¼è‡´æ•°æ®æœ‰è¯¯ã€‚å¯é€šè¿‡åœ¨è¯¥å‡½æ•°å†…sleepè‡³9:10åˆ†æˆ–è°ƒç”¨å®æ—¶è¡Œæƒ…æ¥å£æ”¹ä¸ºrun_dailyæ‰§è¡Œç­‰æ–¹å¼è¿›è¡Œé¿å…ã€‚

#### å¯è°ƒç”¨æ¥å£

set_universe(å›æµ‹/äº¤æ˜“)

get_Ashares(ç ”ç©¶/å›æµ‹/äº¤æ˜“)

set_yesterday_position(å›æµ‹)

get_stock_info(ç ”ç©¶/å›æµ‹/äº¤æ˜“)

get_index_stocks(ç ”ç©¶/å›æµ‹/äº¤æ˜“)

get_fundamentals(ç ”ç©¶/å›æµ‹/äº¤æ˜“)

get_trading_day(å›æµ‹/äº¤æ˜“)

get_all_trades_days(ç ”ç©¶/å›æµ‹/äº¤æ˜“)

get_trade_days(ç ”ç©¶/å›æµ‹/äº¤æ˜“)

get_history(å›æµ‹/äº¤æ˜“)

get_price(ç ”ç©¶/å›æµ‹/äº¤æ˜“)

get_individual_entrust(äº¤æ˜“)

get_individual_transaction(äº¤æ˜“)

convert_position_from_csv(å›æµ‹)

get_stock_name(ç ”ç©¶/å›æµ‹/äº¤æ˜“)

get_stock_status(ç ”ç©¶/å›æµ‹/äº¤æ˜“)

get_stock_exrights(ç ”ç©¶/å›æµ‹/äº¤æ˜“)

get_stock_blocks(ç ”ç©¶/å›æµ‹/äº¤æ˜“)

get_etf_list(äº¤æ˜“)

get_industry_stocks(ç ”ç©¶/å›æµ‹/äº¤æ˜“)

get_user_name(å›æµ‹/äº¤æ˜“)

get_cb_list(äº¤æ˜“)

get_deliver(äº¤æ˜“)

get_fundjour(äº¤æ˜“)

get_research_path(å›æµ‹/äº¤æ˜“)

get_market_list(ç ”ç©¶/å›æµ‹/äº¤æ˜“)

get_market_detail(ç ”ç©¶/å›æµ‹/äº¤æ˜“)

permission_test(äº¤æ˜“)

get_trade_name(äº¤æ˜“)

set_future_commission(å›æµ‹(æœŸè´§))

set_margin_rate(å›æµ‹(æœŸè´§))

get_margin_rate(å›æµ‹(æœŸè´§))

get_instruments(å›æµ‹/äº¤æ˜“(æœŸè´§))

get_MACD(å›æµ‹/äº¤æ˜“)

get_KDJ(å›æµ‹/äº¤æ˜“)

get_RSI(å›æµ‹/äº¤æ˜“)

get_CCI(å›æµ‹/äº¤æ˜“)

create_dir(å›æµ‹/äº¤æ˜“)

get_opt_objects(ç ”ç©¶/å›æµ‹/äº¤æ˜“(æœŸæƒ))

get_opt_last_dates(ç ”ç©¶/å›æµ‹/äº¤æ˜“(æœŸæƒ))

get_opt_contracts(ç ”ç©¶/å›æµ‹/äº¤æ˜“(æœŸæƒ))

get_contract_info(ç ”ç©¶/å›æµ‹/äº¤æ˜“(æœŸæƒ))

set_parameters(å›æµ‹/äº¤æ˜“)

get_cb_info(ç ”ç©¶/äº¤æ˜“)

get_enslo_security_info(äº¤æ˜“)

get_ipo_stocks(äº¤æ˜“)

#### å‚æ•°

context: Contextå¯¹è±¡ï¼Œå­˜æ”¾æœ‰å½“å‰çš„è´¦æˆ·åŠæŒä»“ä¿¡æ¯ï¼›

dataï¼šä¿ç•™å­—æ®µæš‚æ— æ•°æ®ï¼›

#### è¿”å›

None

#### ç¤ºä¾‹

```python
def initialize(context):
    #gä¸ºå…¨å±€å˜é‡
    g.security = '600570.SS'
    set_universe(g.security)

def before_trading_start(context, data):
    log.info(g.security)

def handle_data(context, data):
    order('600570.SS',100)
```

### handle_dataï¼ˆå¿…é€‰ï¼‰

```python
handle_data(context, data)
```

#### ä½¿ç”¨åœºæ™¯

è¯¥å‡½æ•°ä»…åœ¨å›æµ‹ã€äº¤æ˜“æ¨¡å—å¯ç”¨

#### æ¥å£è¯´æ˜

è¯¥å‡½æ•°åœ¨äº¤æ˜“æ—¶é—´å†…æŒ‰æŒ‡å®šçš„å‘¨æœŸé¢‘ç‡è¿è¡Œï¼Œæ˜¯ç”¨äºå¤„ç†ç­–ç•¥äº¤æ˜“çš„ä¸»è¦æ¨¡å—ï¼Œæ ¹æ®ç­–ç•¥ä¿å­˜æ—¶çš„å‘¨æœŸå‚æ•°åˆ†ä¸ºæ¯åˆ†é’Ÿè¿è¡Œå’Œæ¯å¤©è¿è¡Œï¼Œæ˜¯ç­–ç•¥è¿è¡Œçš„å”¯äºŒå¿…é¡»å®šä¹‰å‡½æ•°ä¹‹ä¸€ã€‚

æ³¨æ„äº‹é¡¹ï¼š

1. è¯¥å‡½æ•°æ¯ä¸ªå•ä½å‘¨æœŸæ‰§è¡Œä¸€æ¬¡
2. å¦‚æœæ˜¯æ—¥çº¿çº§åˆ«ç­–ç•¥ï¼Œæ¯å¤©æ‰§è¡Œä¸€æ¬¡ã€‚è‚¡ç¥¨å›æµ‹åœºæ™¯ä¸‹ï¼Œåœ¨15:00æ‰§è¡Œï¼›è‚¡ç¥¨äº¤æ˜“åœºæ™¯ä¸‹ï¼Œæ‰§è¡Œæ—¶é—´ä¸ºåˆ¸å•†å®é™…é…ç½®æ—¶é—´ã€‚
3. å¦‚æœæ˜¯åˆ†é’Ÿçº§åˆ«ç­–ç•¥ï¼Œæ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼Œè‚¡ç¥¨å›æµ‹åœºæ™¯ä¸‹ï¼Œæ‰§è¡Œæ—¶é—´ä¸º9:31 -- 15:00ï¼Œè‚¡ç¥¨äº¤æ˜“åœºæ™¯ä¸‹ï¼Œæ‰§è¡Œæ—¶é—´ä¸º9:30 -- 14:59ã€‚
4. å›æµ‹ä¸äº¤æ˜“ä¸­ï¼Œhandle_dataå‡½æ•°ä¸ä¼šåœ¨éäº¤æ˜“æ—¥è§¦å‘ï¼ˆå¦‚å›æµ‹æˆ–äº¤æ˜“èµ·å§‹æ—¥æœŸä¸º2015å¹´12æœˆ21æ—¥ï¼Œåˆ™ç­–ç•¥åœ¨2016å¹´1æœˆ1æ—¥-3æ—¥æ—¶ï¼Œhandle_dataä¸ä¼šè¿è¡Œï¼Œ4æ—¥ç»§ç»­è¿è¡Œï¼‰ã€‚

#### å¯è°ƒç”¨æ¥å£

get_trading_day(å›æµ‹/äº¤æ˜“)

get_all_trades_days(ç ”ç©¶/å›æµ‹/äº¤æ˜“)

get_trade_days(ç ”ç©¶/å›æµ‹/äº¤æ˜“)

get_history(å›æµ‹/äº¤æ˜“)

get_price(ç ”ç©¶/å›æµ‹/äº¤æ˜“)

get_individual_entrust(äº¤æ˜“)

get_individual_transaction(äº¤æ˜“)

get_gear_price(äº¤æ˜“)

get_stock_name(ç ”ç©¶/å›æµ‹/äº¤æ˜“)

get_stock_status(ç ”ç©¶/å›æµ‹/äº¤æ˜“)

get_stock_exrights(ç ”ç©¶/å›æµ‹/äº¤æ˜“)

get_stock_blocks(ç ”ç©¶/å›æµ‹/äº¤æ˜“)

get_index_stocks(ç ”ç©¶/å›æµ‹/äº¤æ˜“)

get_industry_stocks(ç ”ç©¶/å›æµ‹/äº¤æ˜“)

get_fundamentals(ç ”ç©¶/å›æµ‹/äº¤æ˜“)

get_Ashares(ç ”ç©¶/å›æµ‹/äº¤æ˜“)

get_snapshot(äº¤æ˜“)

convert_position_from_csv(å›æµ‹)

order(å›æµ‹/äº¤æ˜“)

order_target(å›æµ‹/äº¤æ˜“)

order_value(å›æµ‹/äº¤æ˜“)

order_target_value(å›æµ‹/äº¤æ˜“)

order_market(äº¤æ˜“)

ipo_stocks_order(äº¤æ˜“)

after_trading_order(äº¤æ˜“)

after_trading_cancel_order(äº¤æ˜“)

etf_basket_order(äº¤æ˜“)

etf_purchase_redemption(äº¤æ˜“)

cancel_order(å›æµ‹/äº¤æ˜“)

get_stock_info(ç ”ç©¶/å›æµ‹/äº¤æ˜“)

get_order(å›æµ‹/äº¤æ˜“)

get_orders(å›æµ‹/äº¤æ˜“)

get_open_orders(å›æµ‹/äº¤æ˜“)

get_trades(å›æµ‹/äº¤æ˜“)

get_position(å›æµ‹/äº¤æ˜“)

get_positions(å›æµ‹/äº¤æ˜“)

get_etf_info(äº¤æ˜“)

get_etf_stock_info(äº¤æ˜“)

get_etf_stock_list(äº¤æ˜“)

get_etf_list(äº¤æ˜“)

get_all_orders(äº¤æ˜“)

cancel_order_ex(äº¤æ˜“)

debt_to_stock_order(äº¤æ˜“)

get_user_name(å›æµ‹/äº¤æ˜“)

get_research_path(å›æµ‹/äº¤æ˜“)

get_marginsec_stocks(äº¤æ˜“)

get_margincash_stocks(äº¤æ˜“)

debt_to_stock_order(äº¤æ˜“)

get_margin_contractreal(äº¤æ˜“)

get_margin_contract(äº¤æ˜“)

marginsec_direct_refund(äº¤æ˜“)

get_margin_entrans_amount(äº¤æ˜“)

get_margin_contract(äº¤æ˜“)

margincash_direct_refund(äº¤æ˜“)

marginsec_open(äº¤æ˜“)

marginsec_close(äº¤æ˜“)

margincash_open(äº¤æ˜“)

margincash_close(äº¤æ˜“)

margin_trade(äº¤æ˜“)

get_marginsec_close_amount(äº¤æ˜“)

get_marginsec_open_amount(äº¤æ˜“)

get_margincash_close_amount(äº¤æ˜“)

get_margincash_open_amount(äº¤æ˜“)

get_cb_list(äº¤æ˜“)

get_tick_direction(äº¤æ˜“)

get_sort_msg(äº¤æ˜“)

get_trade_name(äº¤æ˜“)

get_margin_rate(å›æµ‹(æœŸè´§))

get_instruments(å›æµ‹/äº¤æ˜“(æœŸè´§)

buy_open(å›æµ‹/äº¤æ˜“(æœŸè´§)

sell_close(å›æµ‹/äº¤æ˜“(æœŸè´§)

sell_close(å›æµ‹/äº¤æ˜“(æœŸè´§)

buy_close(å›æµ‹/äº¤æ˜“(æœŸè´§)

get_MACD(å›æµ‹/äº¤æ˜“)

get_KDJ(å›æµ‹/äº¤æ˜“)

get_RSI(å›æµ‹/äº¤æ˜“)

get_CCI(å›æµ‹/äº¤æ˜“)

create_dir(å›æµ‹/äº¤æ˜“)

get_opt_objects(ç ”ç©¶/å›æµ‹/äº¤æ˜“(æœŸæƒ))

get_opt_last_dates(ç ”ç©¶/å›æµ‹/äº¤æ˜“(æœŸæƒ))

get_opt_contracts(ç ”ç©¶/å›æµ‹/äº¤æ˜“(æœŸæƒ))

get_contract_info(ç ”ç©¶/å›æµ‹/äº¤æ˜“(æœŸæƒ))

set_parameters(å›æµ‹/äº¤æ˜“)

get_covered_lock_amount(äº¤æ˜“(æœŸæƒ))

get_covered_unlock_amount(äº¤æ˜“(æœŸæƒ))

buy_open(äº¤æ˜“(æœŸæƒ))

sell_close(äº¤æ˜“(æœŸæƒ))

sell_open(äº¤æ˜“(æœŸæƒ))

buy_close(äº¤æ˜“(æœŸæƒ))

open_prepared(äº¤æ˜“(æœŸæƒ))

close_prepared(äº¤æ˜“(æœŸæƒ))

option_exercise(äº¤æ˜“(æœŸæƒ))

option_covered_lock(äº¤æ˜“(æœŸæƒ))

option_covered_unlock(äº¤æ˜“(æœŸæƒ))

get_cb_info(ç ”ç©¶/äº¤æ˜“)

get_enslo_security_info(äº¤æ˜“)

get_ipo_stocks(äº¤æ˜“)

check_limit(å›æµ‹/ç ”ç©¶/äº¤æ˜“)

#### å‚æ•°

context: Contextå¯¹è±¡ï¼Œå­˜æ”¾æœ‰å½“å‰çš„è´¦æˆ·åŠæŒä»“ä¿¡æ¯ï¼›

dataï¼šä¸€ä¸ªå­—å…¸(dict)ï¼Œkeyæ˜¯æ ‡çš„ä»£ç ï¼Œvalueæ˜¯å½“æ—¶çš„SecurityUnitDataå¯¹è±¡ï¼Œå­˜æ”¾å½“å‰å‘¨æœŸï¼ˆæ—¥çº¿ç­–ç•¥ï¼Œåˆ™æ˜¯å½“å¤©ï¼›åˆ†é’Ÿç­–ç•¥ï¼Œåˆ™æ˜¯è¿™ä¸€åˆ†é’Ÿï¼‰çš„æ•°æ®ï¼›

æ³¨æ„ï¼šä¸ºäº†åŠ é€Ÿï¼Œdataä¸­çš„æ•°æ®åªåŒ…å«è‚¡ç¥¨æ± ä¸­æ‰€è®¢é˜…æ ‡çš„çš„ä¿¡æ¯ï¼Œå¯ä½¿ç”¨data[security]çš„æ–¹å¼æ¥è·å–å½“å‰å‘¨æœŸå¯¹åº”çš„æ ‡çš„ä¿¡æ¯ï¼›

#### è¿”å›

None

#### ç¤ºä¾‹

```python
def initialize(context):
    #gä¸ºå…¨å±€å˜é‡
    g.security = '600570.SS'
    set_universe(g.security)

def handle_data(context, data):
    order('600570.SS',100)
```

## ç­–ç•¥APIä»‹ç»

### è®¾ç½®å‡½æ•°

#### set_universe - è®¾ç½®è‚¡ç¥¨æ± 

```python
set_universe(security_list)
```

##### ä½¿ç”¨åœºæ™¯

è¯¥å‡½æ•°ä»…åœ¨å›æµ‹ã€äº¤æ˜“æ¨¡å—å¯ç”¨

##### æ¥å£è¯´æ˜

è®¾ç½®è‚¡ç¥¨æ± ï¼Œè‚¡ç¥¨æ± æ˜¯ä¸€ä¸ªè‚¡ç¥¨ä»£ç çš„åˆ—è¡¨ã€‚

æ³¨æ„äº‹é¡¹ï¼š

1. è‚¡ç¥¨æ± å†…è‚¡ç¥¨ä»£ç æ•°é‡ä¸èƒ½è¶…è¿‡100åª
2. è‚¡ç¥¨æ± å†…è‚¡ç¥¨ä»£ç å¿…é¡»æ˜¯æœ‰æ•ˆçš„è‚¡ç¥¨ä»£ç 

##### å‚æ•°

security_listï¼šè‚¡ç¥¨ä»£ç åˆ—è¡¨ï¼Œlistç±»å‹æˆ–strç±»å‹

##### è¿”å›

None

##### ç¤ºä¾‹

```python
def initialize(context):
    set_universe(['600570.SS', '000001.SZ'])
```

#### set_benchmark - è®¾ç½®åŸºå‡†

```python
set_benchmark(security)
```

##### ä½¿ç”¨åœºæ™¯

è¯¥å‡½æ•°ä»…åœ¨å›æµ‹ã€äº¤æ˜“æ¨¡å—å¯ç”¨

##### æ¥å£è¯´æ˜

è®¾ç½®ç­–ç•¥åŸºå‡†ï¼Œç”¨äºæ¯”è¾ƒç­–ç•¥æ”¶ç›Šä¸åŸºå‡†æ”¶ç›Šã€‚

æ³¨æ„äº‹é¡¹ï¼š

æ— 

##### å‚æ•°

securityï¼šåŸºå‡†ä»£ç ï¼Œstrç±»å‹

##### è¿”å›

None

##### ç¤ºä¾‹

```python
def initialize(context):
    set_benchmark('000300.SS')
```

#### set_commission - è®¾ç½®ä½£é‡‘è´¹ç‡

```python
set_commission(type, cost, min_trade_cost, tax)
```

##### ä½¿ç”¨åœºæ™¯

è¯¥å‡½æ•°ä»…åœ¨å›æµ‹æ¨¡å—å¯ç”¨

##### æ¥å£è¯´æ˜

è®¾ç½®äº¤æ˜“ä½£é‡‘è´¹ç‡ã€‚

æ³¨æ„äº‹é¡¹ï¼š

æ— 

##### å‚æ•°

typeï¼šäº¤æ˜“ç±»å‹ï¼Œstrç±»å‹ï¼Œæ”¯æŒ'stock'ã€'fund'ã€'bond'ã€'LOF'

costï¼šä½£é‡‘è´¹ç‡ï¼Œfloatç±»å‹

min_trade_costï¼šæœ€å°ä½£é‡‘ï¼Œfloatç±»å‹

taxï¼šå°èŠ±ç¨è´¹ç‡ï¼Œfloatç±»å‹

##### è¿”å›

None

##### ç¤ºä¾‹

```python
def initialize(context):
    set_commission(type='stock', cost=0.0003, min_trade_cost=5, tax=0.001)
```

#### set_fixed_slippage - è®¾ç½®å›ºå®šæ»‘ç‚¹

```python
set_fixed_slippage(slippage)
```

##### ä½¿ç”¨åœºæ™¯

è¯¥å‡½æ•°ä»…åœ¨å›æµ‹æ¨¡å—å¯ç”¨

##### æ¥å£è¯´æ˜

è®¾ç½®å›ºå®šæ»‘ç‚¹ã€‚

æ³¨æ„äº‹é¡¹ï¼š

æ— 

##### å‚æ•°

slippageï¼šæ»‘ç‚¹å€¼ï¼Œfloatç±»å‹

##### è¿”å›

None

##### ç¤ºä¾‹

```python
def initialize(context):
    set_fixed_slippage(0.01)
```

#### set_slippage - è®¾ç½®æ»‘ç‚¹

```python
set_slippage(slippage)
```

##### ä½¿ç”¨åœºæ™¯

è¯¥å‡½æ•°ä»…åœ¨å›æµ‹æ¨¡å—å¯ç”¨

##### æ¥å£è¯´æ˜

è®¾ç½®æ»‘ç‚¹ã€‚

æ³¨æ„äº‹é¡¹ï¼š

æ— 

##### å‚æ•°

slippageï¼šæ»‘ç‚¹æ¯”ä¾‹ï¼Œfloatç±»å‹

##### è¿”å›

None

##### ç¤ºä¾‹

```python
def initialize(context):
    set_slippage(0.001)
```

#### set_volume_ratio â€“ è®¾ç½®æˆäº¤æ¯”ä¾‹

```python
set_volume_ratio(ratio)
```

##### ä½¿ç”¨åœºæ™¯

è¯¥å‡½æ•°ä»…åœ¨å›æµ‹æ¨¡å—å¯ç”¨

##### æ¥å£è¯´æ˜

è®¾ç½®æˆäº¤æ¯”ä¾‹ã€‚

æ³¨æ„äº‹é¡¹ï¼š

æ— 

##### å‚æ•°

ratioï¼šæˆäº¤æ¯”ä¾‹ï¼Œfloatç±»å‹

##### è¿”å›

None

##### ç¤ºä¾‹

```python
def initialize(context):
    set_volume_ratio(0.25)
```

#### set_limit_mode â€“ è®¾ç½®å›æµ‹æˆäº¤æ•°é‡é™åˆ¶æ¨¡å¼

```python
set_limit_mode(mode)
```

##### ä½¿ç”¨åœºæ™¯

è¯¥å‡½æ•°ä»…åœ¨å›æµ‹æ¨¡å—å¯ç”¨

##### æ¥å£è¯´æ˜

è®¾ç½®å›æµ‹æˆäº¤æ•°é‡é™åˆ¶æ¨¡å¼ã€‚

æ³¨æ„äº‹é¡¹ï¼š

æ— 

##### å‚æ•°

modeï¼šé™åˆ¶æ¨¡å¼ï¼Œstrç±»å‹

##### è¿”å›

None

##### ç¤ºä¾‹

```python
def initialize(context):
    set_limit_mode('strict')
```

### è·å–ä¿¡æ¯å‡½æ•°

#### è·å–è¡Œæƒ…ä¿¡æ¯

##### get_history - è·å–å†å²è¡Œæƒ…

```python
get_history(count, frequency, field, security_list, fq, include, fill, is_dict)
```

###### ä½¿ç”¨åœºæ™¯

è¯¥å‡½æ•°åœ¨å›æµ‹ã€äº¤æ˜“æ¨¡å—å¯ç”¨

###### æ¥å£è¯´æ˜

è·å–å†å²è¡Œæƒ…æ•°æ®ã€‚

æ³¨æ„äº‹é¡¹ï¼š

æ— 

###### å‚æ•°

countï¼š Kçº¿æ•°é‡ï¼Œå¤§äº0ï¼Œè¿”å›æŒ‡å®šæ•°é‡çš„Kçº¿è¡Œæƒ…ï¼›å¿…å¡«å‚æ•°ï¼›å…¥å‚ç±»å‹ï¼šintï¼›

frequencyï¼šKçº¿å‘¨æœŸï¼Œç°æœ‰æ”¯æŒ1åˆ†é’Ÿçº¿(1m)ã€5åˆ†é’Ÿçº¿(5m)ã€15åˆ†é’Ÿçº¿(15m)ã€30åˆ†é’Ÿçº¿(30m)ã€60åˆ†é’Ÿçº¿(60m)ã€120åˆ†é’Ÿçº¿(120m)ã€æ—¥çº¿(1d)ã€å‘¨çº¿(1w/weekly)ã€æœˆçº¿(mo/monthly)ã€å­£åº¦çº¿(1q/quarter)å’Œå¹´çº¿(1y/yearly)é¢‘ç‡çš„æ•°æ®ï¼›é€‰å¡«å‚æ•°ï¼Œé»˜è®¤ä¸º'1d'ï¼›å…¥å‚ç±»å‹ï¼šstrï¼›

fieldï¼šæŒ‡æ˜æ•°æ®ç»“æœé›†ä¸­æ‰€æ”¯æŒè¾“å‡ºçš„è¡Œæƒ…å­—æ®µï¼›é€‰å¡«å‚æ•°ï¼Œé»˜è®¤ä¸º['open','high','low','close','volume','money','price']ï¼›å…¥å‚ç±»å‹ï¼šlist[str,str]æˆ–strï¼›è¾“å‡ºå­—æ®µåŒ…æ‹¬ï¼š

open -- å¼€ç›˜ä»·ï¼Œå­—æ®µè¿”å›ç±»å‹ï¼šnumpy.float64ï¼›
high -- æœ€é«˜ä»·ï¼Œå­—æ®µè¿”å›ç±»å‹ï¼šnumpy.float64ï¼›
low --æœ€ä½ä»·ï¼Œå­—æ®µè¿”å›ç±»å‹ï¼šnumpy.float64ï¼›
close -- æ”¶ç›˜ä»·ï¼Œå­—æ®µè¿”å›ç±»å‹ï¼šnumpy.float64ï¼›
volume -- äº¤æ˜“é‡ï¼Œå­—æ®µè¿”å›ç±»å‹ï¼šnumpy.float64ï¼›
money -- äº¤æ˜“é‡‘é¢ï¼Œå­—æ®µè¿”å›ç±»å‹ï¼šnumpy.float64ï¼›
price -- æœ€æ–°ä»·ï¼Œå­—æ®µè¿”å›ç±»å‹ï¼šnumpy.float64ï¼›
preclose -- æ˜¨æ”¶ç›˜ä»·ï¼Œå­—æ®µè¿”å›ç±»å‹ï¼šnumpy.float64(ä»…æ—¥çº¿è¿”å›)ï¼›
high_limit -- æ¶¨åœä»·ï¼Œå­—æ®µè¿”å›ç±»å‹ï¼šnumpy.float64(ä»…æ—¥çº¿è¿”å›)ï¼›
low_limit -- è·Œåœä»·ï¼Œå­—æ®µè¿”å›ç±»å‹ï¼šnumpy.float64(ä»…æ—¥çº¿è¿”å›)ï¼›
unlimited -- åˆ¤æ–­æŸ¥è¯¢æ—¥æ˜¯å¦æ˜¯æ— æ¶¨è·Œåœé™åˆ¶(1:è¯¥æ—¥æ— æ¶¨è·Œåœé™åˆ¶;0:è¯¥æ—¥ä¸æ˜¯æ— æ¶¨è·Œåœé™åˆ¶)ï¼Œå­—æ®µè¿”å›ç±»å‹ï¼šnumpy.float64(ä»…æ—¥çº¿è¿”å›)ï¼›

security_listï¼šè¦è·å–æ•°æ®çš„è‚¡ç¥¨åˆ—è¡¨ï¼›é€‰å¡«å‚æ•°ï¼ŒNoneè¡¨ç¤ºåœ¨ä¸Šä¸‹æ–‡ä¸­çš„universeä¸­é€‰ä¸­çš„æ‰€æœ‰è‚¡ç¥¨ï¼›å…¥å‚ç±»å‹ï¼šlist[str,str]æˆ–strï¼›

fqï¼šæ•°æ®å¤æƒé€‰é¡¹ï¼Œæ”¯æŒåŒ…æ‹¬ï¼Œpre-å‰å¤æƒï¼Œpost-åå¤æƒï¼Œdypre-åŠ¨æ€å‰å¤æƒï¼ŒNone-ä¸å¤æƒï¼›é€‰å¡«å‚æ•°ï¼Œé»˜è®¤ä¸ºNoneï¼›å…¥å‚ç±»å‹ï¼šstrï¼›

includeï¼šæ˜¯å¦åŒ…å«å½“å‰å‘¨æœŸï¼ŒTrue â€“åŒ…å«ï¼ŒFalse-ä¸åŒ…å«ï¼›é€‰å¡«å‚æ•°ï¼Œé»˜è®¤ä¸ºFalseï¼›å…¥å‚ç±»å‹ï¼šboolï¼›

fillï¼šè¡Œæƒ…è·å–ä¸åˆ°æŸä¸€æ—¶åˆ»çš„åˆ†é’Ÿæ•°æ®æ—¶ï¼Œæ˜¯å¦ç”¨ä¸Šä¸€åˆ†é’Ÿçš„æ•°æ®è¿›è¡Œå¡«å……è¯¥æ—¶åˆ»æ•°æ®ï¼Œ'pre'â€“ç”¨ä¸Šä¸€åˆ†é’Ÿæ•°æ®å¡«å……ï¼Œ'nan'â€“NaNè¿›è¡Œå¡«å……(ä»…äº¤æ˜“æœ‰æ•ˆ)ï¼›é€‰å¡«å‚æ•°ï¼Œé»˜è®¤ä¸º'nan'ï¼›å…¥å‚ç±»å‹ï¼šstrï¼›

is_dictï¼šè¿”å›æ˜¯å¦æ˜¯å­—å…¸(dict)æ ¼å¼{str: array()}ï¼ŒTrue â€“æ˜¯ï¼ŒFalse-ä¸æ˜¯ï¼›é€‰å¡«å‚æ•°ï¼Œé»˜è®¤ä¸ºFalseï¼›è¿”å›ä¸ºå­—å…¸æ ¼å¼å–æ•°é€Ÿåº¦ç›¸å¯¹è¾ƒå¿«ï¼›å…¥å‚ç±»å‹ï¼šboolï¼›

###### è¿”å›

DataFrameæˆ–dictæ ¼å¼çš„å†å²è¡Œæƒ…æ•°æ®

###### ç¤ºä¾‹

```python
def handle_data(context, data):
    # è·å–è¿‡å»5å¤©çš„æ”¶ç›˜ä»·
    df = get_history(5, '1d', 'close', '600570.SS', fq=None, include=False)
    log.info(df)
```

##### get_price - è·å–å†å²æ•°æ®

```python
get_price(security_list, start_date, end_date, frequency, fields, fq, include)
```

###### ä½¿ç”¨åœºæ™¯

è¯¥å‡½æ•°åœ¨ç ”ç©¶ã€å›æµ‹ã€äº¤æ˜“æ¨¡å—å¯ç”¨

###### æ¥å£è¯´æ˜

è·å–æŒ‡å®šæ—¶é—´æ®µçš„å†å²æ•°æ®ã€‚

æ³¨æ„äº‹é¡¹ï¼š

æ— 

###### å‚æ•°

security_listï¼šè‚¡ç¥¨ä»£ç åˆ—è¡¨ï¼Œlistç±»å‹æˆ–strç±»å‹

start_dateï¼šå¼€å§‹æ—¥æœŸï¼Œstrç±»å‹ï¼Œæ ¼å¼ä¸º'YYYY-MM-DD'

end_dateï¼šç»“æŸæ—¥æœŸï¼Œstrç±»å‹ï¼Œæ ¼å¼ä¸º'YYYY-MM-DD'

frequencyï¼šæ•°æ®é¢‘ç‡ï¼Œstrç±»å‹ï¼Œæ”¯æŒ'1d'ã€'1m'ç­‰

fieldsï¼šå­—æ®µåˆ—è¡¨ï¼Œlistç±»å‹æˆ–strç±»å‹

fqï¼šå¤æƒç±»å‹ï¼Œstrç±»å‹

includeï¼šæ˜¯å¦åŒ…å«å½“å‰å‘¨æœŸï¼Œboolç±»å‹

###### è¿”å›

DataFrameæ ¼å¼çš„å†å²æ•°æ®

###### ç¤ºä¾‹

```python
def handle_data(context, data):
    # è·å–æŒ‡å®šæ—¶é—´æ®µçš„æ•°æ®
    df = get_price('600570.SS', '2023-01-01', '2023-12-31', '1d', ['open', 'close'])
    log.info(df)
```

### äº¤æ˜“ç›¸å…³å‡½æ•°

#### è‚¡ç¥¨äº¤æ˜“å‡½æ•°

##### order - æŒ‰æ•°é‡ä¹°å–

```python
order(security, amount, limit_price, style)
```

###### ä½¿ç”¨åœºæ™¯

è¯¥å‡½æ•°åœ¨å›æµ‹ã€äº¤æ˜“æ¨¡å—å¯ç”¨

###### æ¥å£è¯´æ˜

æŒ‰æŒ‡å®šæ•°é‡ä¹°å–è‚¡ç¥¨ã€‚

æ³¨æ„äº‹é¡¹ï¼š

æ— 

###### å‚æ•°

securityï¼šè‚¡ç¥¨ä»£ç ï¼Œstrç±»å‹

amountï¼šäº¤æ˜“æ•°é‡ï¼Œintç±»å‹ï¼Œæ­£æ•°ä¸ºä¹°å…¥ï¼Œè´Ÿæ•°ä¸ºå–å‡º

limit_priceï¼šé™ä»·ï¼Œfloatç±»å‹ï¼Œå¯é€‰

styleï¼šäº¤æ˜“æ–¹å¼ï¼Œå¯é€‰

###### è¿”å›

Orderå¯¹è±¡

###### ç¤ºä¾‹

```python
def handle_data(context, data):
    # ä¹°å…¥1000è‚¡
    order('600570.SS', 1000)
    # å–å‡º500è‚¡
    order('600570.SS', -500)
```

##### order_target - æŒ‡å®šç›®æ ‡æ•°é‡ä¹°å–

```python
order_target(security, amount, limit_price, style)
```

###### ä½¿ç”¨åœºæ™¯

è¯¥å‡½æ•°åœ¨å›æµ‹ã€äº¤æ˜“æ¨¡å—å¯ç”¨

###### æ¥å£è¯´æ˜

è°ƒæ•´æŒä»“åˆ°æŒ‡å®šæ•°é‡ã€‚

æ³¨æ„äº‹é¡¹ï¼š

æ— 

###### å‚æ•°

securityï¼šè‚¡ç¥¨ä»£ç ï¼Œstrç±»å‹

amountï¼šç›®æ ‡æŒä»“æ•°é‡ï¼Œintç±»å‹

limit_priceï¼šé™ä»·ï¼Œfloatç±»å‹ï¼Œå¯é€‰

styleï¼šäº¤æ˜“æ–¹å¼ï¼Œå¯é€‰

###### è¿”å›

Orderå¯¹è±¡

###### ç¤ºä¾‹

```python
def handle_data(context, data):
    # è°ƒæ•´æŒä»“åˆ°2000è‚¡
    order_target('600570.SS', 2000)
```

##### order_value - æŒ‡å®šç›®æ ‡ä»·å€¼ä¹°å–

```python
order_value(security, value, limit_price, style)
```

###### ä½¿ç”¨åœºæ™¯

è¯¥å‡½æ•°åœ¨å›æµ‹ã€äº¤æ˜“æ¨¡å—å¯ç”¨

###### æ¥å£è¯´æ˜

æŒ‰æŒ‡å®šä»·å€¼ä¹°å–è‚¡ç¥¨ã€‚

æ³¨æ„äº‹é¡¹ï¼š

æ— 

###### å‚æ•°

securityï¼šè‚¡ç¥¨ä»£ç ï¼Œstrç±»å‹

valueï¼šäº¤æ˜“ä»·å€¼ï¼Œfloatç±»å‹

limit_priceï¼šé™ä»·ï¼Œfloatç±»å‹ï¼Œå¯é€‰

styleï¼šäº¤æ˜“æ–¹å¼ï¼Œå¯é€‰

###### è¿”å›

Orderå¯¹è±¡

###### ç¤ºä¾‹

```python
def handle_data(context, data):
    # ä¹°å…¥ä»·å€¼10000å…ƒçš„è‚¡ç¥¨
    order_value('600570.SS', 10000)
```

### èèµ„èåˆ¸ä¸“ç”¨å‡½æ•°

#### èèµ„èåˆ¸äº¤æ˜“ç±»

##### margincash_open - èèµ„ä¹°å…¥

```python
margincash_open(security, amount, limit_price, style)
```

###### ä½¿ç”¨åœºæ™¯

è¯¥å‡½æ•°ä»…åœ¨äº¤æ˜“æ¨¡å—å¯ç”¨

###### æ¥å£è¯´æ˜

èèµ„ä¹°å…¥è‚¡ç¥¨ã€‚

æ³¨æ„äº‹é¡¹ï¼š

éœ€è¦å¼€é€šèèµ„èåˆ¸æƒé™

###### å‚æ•°

securityï¼šè‚¡ç¥¨ä»£ç ï¼Œstrç±»å‹

amountï¼šä¹°å…¥æ•°é‡ï¼Œintç±»å‹

limit_priceï¼šé™ä»·ï¼Œfloatç±»å‹ï¼Œå¯é€‰

styleï¼šäº¤æ˜“æ–¹å¼ï¼Œå¯é€‰

###### è¿”å›

Orderå¯¹è±¡

###### ç¤ºä¾‹

```python
def handle_data(context, data):
    # èèµ„ä¹°å…¥1000è‚¡
    margincash_open('600570.SS', 1000, 12.50)
```

##### margincash_close - å–åˆ¸è¿˜æ¬¾

```python
margincash_close(security, amount, limit_price, style)
```

###### ä½¿ç”¨åœºæ™¯

è¯¥å‡½æ•°ä»…åœ¨äº¤æ˜“æ¨¡å—å¯ç”¨

###### æ¥å£è¯´æ˜

å–åˆ¸è¿˜æ¬¾ã€‚

æ³¨æ„äº‹é¡¹ï¼š

éœ€è¦å¼€é€šèèµ„èåˆ¸æƒé™

###### å‚æ•°

securityï¼šè‚¡ç¥¨ä»£ç ï¼Œstrç±»å‹

amountï¼šå–å‡ºæ•°é‡ï¼Œintç±»å‹

limit_priceï¼šé™ä»·ï¼Œfloatç±»å‹ï¼Œå¯é€‰

styleï¼šäº¤æ˜“æ–¹å¼ï¼Œå¯é€‰

###### è¿”å›

Orderå¯¹è±¡

###### ç¤ºä¾‹

```python
def handle_data(context, data):
    # å–åˆ¸è¿˜æ¬¾500è‚¡
    margincash_close('600570.SS', 500, 13.00)
```

##### marginsec_open - èåˆ¸å–å‡º

```python
marginsec_open(security, amount, limit_price, style)
```

###### ä½¿ç”¨åœºæ™¯

è¯¥å‡½æ•°ä»…åœ¨äº¤æ˜“æ¨¡å—å¯ç”¨

###### æ¥å£è¯´æ˜

èåˆ¸å–å‡ºè‚¡ç¥¨ã€‚

æ³¨æ„äº‹é¡¹ï¼š

éœ€è¦å¼€é€šèèµ„èåˆ¸æƒé™

###### å‚æ•°

securityï¼šè‚¡ç¥¨ä»£ç ï¼Œstrç±»å‹

amountï¼šå–å‡ºæ•°é‡ï¼Œintç±»å‹

limit_priceï¼šé™ä»·ï¼Œfloatç±»å‹ï¼Œå¯é€‰

styleï¼šäº¤æ˜“æ–¹å¼ï¼Œå¯é€‰

###### è¿”å›

Orderå¯¹è±¡

###### ç¤ºä¾‹

```python
def handle_data(context, data):
    # èåˆ¸å–å‡º100è‚¡
    marginsec_open('600570.SS', 100, 12.50)
```

##### marginsec_close - ä¹°åˆ¸è¿˜åˆ¸

```python
marginsec_close(security, amount, limit_price, style)
```

###### ä½¿ç”¨åœºæ™¯

è¯¥å‡½æ•°ä»…åœ¨äº¤æ˜“æ¨¡å—å¯ç”¨

###### æ¥å£è¯´æ˜

ä¹°åˆ¸è¿˜åˆ¸ã€‚

æ³¨æ„äº‹é¡¹ï¼š

éœ€è¦å¼€é€šèèµ„èåˆ¸æƒé™

###### å‚æ•°

securityï¼šè‚¡ç¥¨ä»£ç ï¼Œstrç±»å‹

amountï¼šä¹°å…¥æ•°é‡ï¼Œintç±»å‹

limit_priceï¼šé™ä»·ï¼Œfloatç±»å‹ï¼Œå¯é€‰

styleï¼šäº¤æ˜“æ–¹å¼ï¼Œå¯é€‰

###### è¿”å›

Orderå¯¹è±¡

###### ç¤ºä¾‹

```python
def handle_data(context, data):
    # ä¹°åˆ¸è¿˜åˆ¸50è‚¡
    marginsec_close('600570.SS', 50, 12.00)
```

#### èèµ„èåˆ¸æŸ¥è¯¢ç±»

##### get_margincash_stocks - è·å–èèµ„æ ‡çš„

```python
get_margincash_stocks()
```

###### ä½¿ç”¨åœºæ™¯

è¯¥å‡½æ•°ä»…åœ¨äº¤æ˜“æ¨¡å—å¯ç”¨

###### æ¥å£è¯´æ˜

è·å–èèµ„æ ‡çš„åˆ—è¡¨ã€‚

æ³¨æ„äº‹é¡¹ï¼š

éœ€è¦å¼€é€šèèµ„èåˆ¸æƒé™

###### å‚æ•°

æ— 

###### è¿”å›

listæ ¼å¼çš„èèµ„æ ‡çš„åˆ—è¡¨

###### ç¤ºä¾‹

```python
def handle_data(context, data):
    # è·å–èèµ„æ ‡çš„
    stocks = get_margincash_stocks()
    log.info(stocks)
```

##### get_marginsec_stocks - è·å–èåˆ¸æ ‡çš„

```python
get_marginsec_stocks()
```

###### ä½¿ç”¨åœºæ™¯

è¯¥å‡½æ•°ä»…åœ¨äº¤æ˜“æ¨¡å—å¯ç”¨

###### æ¥å£è¯´æ˜

è·å–èåˆ¸æ ‡çš„åˆ—è¡¨ã€‚

æ³¨æ„äº‹é¡¹ï¼š

éœ€è¦å¼€é€šèèµ„èåˆ¸æƒé™

###### å‚æ•°

æ— 

###### è¿”å›

listæ ¼å¼çš„èåˆ¸æ ‡çš„åˆ—è¡¨

###### ç¤ºä¾‹

```python
def handle_data(context, data):
    # è·å–èåˆ¸æ ‡çš„
    stocks = get_marginsec_stocks()
    log.info(stocks)
```

### æœŸè´§ä¸“ç”¨å‡½æ•°

#### buy_open - æœŸè´§ä¹°å…¥å¼€ä»“

```python
buy_open(security, amount, limit_price, style)
```

##### ä½¿ç”¨åœºæ™¯

è¯¥å‡½æ•°åœ¨å›æµ‹ã€äº¤æ˜“æ¨¡å—å¯ç”¨

##### æ¥å£è¯´æ˜

æœŸè´§ä¹°å…¥å¼€ä»“ã€‚

æ³¨æ„äº‹é¡¹ï¼š

ä»…é€‚ç”¨äºæœŸè´§äº¤æ˜“

##### å‚æ•°

securityï¼šæœŸè´§åˆçº¦ä»£ç ï¼Œstrç±»å‹

amountï¼šå¼€ä»“æ‰‹æ•°ï¼Œintç±»å‹

limit_priceï¼šé™ä»·ï¼Œfloatç±»å‹ï¼Œå¯é€‰

styleï¼šäº¤æ˜“æ–¹å¼ï¼Œå¯é€‰

##### è¿”å›

Orderå¯¹è±¡

##### ç¤ºä¾‹

```python
def handle_data(context, data):
    # ä¹°å…¥å¼€ä»“1æ‰‹
    buy_open('IF2312', 1)
```

#### sell_close - æœŸè´§å–å‡ºå¹³ä»“

```python
sell_close(security, amount, limit_price, style)
```

##### ä½¿ç”¨åœºæ™¯

è¯¥å‡½æ•°åœ¨å›æµ‹ã€äº¤æ˜“æ¨¡å—å¯ç”¨

##### æ¥å£è¯´æ˜

æœŸè´§å–å‡ºå¹³ä»“ã€‚

æ³¨æ„äº‹é¡¹ï¼š

ä»…é€‚ç”¨äºæœŸè´§äº¤æ˜“

##### å‚æ•°

securityï¼šæœŸè´§åˆçº¦ä»£ç ï¼Œstrç±»å‹

amountï¼šå¹³ä»“æ‰‹æ•°ï¼Œintç±»å‹

limit_priceï¼šé™ä»·ï¼Œfloatç±»å‹ï¼Œå¯é€‰

styleï¼šäº¤æ˜“æ–¹å¼ï¼Œå¯é€‰

##### è¿”å›

Orderå¯¹è±¡

##### ç¤ºä¾‹

```python
def handle_data(context, data):
    # å–å‡ºå¹³ä»“1æ‰‹
    sell_close('IF2312', 1)
```

### æœŸæƒä¸“ç”¨å‡½æ•°

#### option_exercise - æœŸæƒè¡Œæƒ

```python
option_exercise(security, amount)
```

##### ä½¿ç”¨åœºæ™¯

è¯¥å‡½æ•°ä»…åœ¨äº¤æ˜“æ¨¡å—å¯ç”¨

##### æ¥å£è¯´æ˜

æœŸæƒè¡Œæƒæ“ä½œã€‚

æ³¨æ„äº‹é¡¹ï¼š

ä»…é€‚ç”¨äºæœŸæƒäº¤æ˜“

##### å‚æ•°

securityï¼šæœŸæƒåˆçº¦ä»£ç ï¼Œstrç±»å‹

amountï¼šè¡Œæƒæ•°é‡ï¼Œintç±»å‹

##### è¿”å›

Orderå¯¹è±¡

##### ç¤ºä¾‹

```python
def handle_data(context, data):
    # è¡Œæƒ2æ‰‹æœŸæƒ
    option_exercise('10002334.SH', 2)
```

#### get_opt_contracts - è·å–æœŸæƒåˆçº¦

```python
get_opt_contracts(underlying_symbol)
```

##### ä½¿ç”¨åœºæ™¯

è¯¥å‡½æ•°åœ¨ç ”ç©¶ã€å›æµ‹ã€äº¤æ˜“æ¨¡å—å¯ç”¨

##### æ¥å£è¯´æ˜

è·å–æŒ‡å®šæ ‡çš„çš„æœŸæƒåˆçº¦åˆ—è¡¨ã€‚

æ³¨æ„äº‹é¡¹ï¼š

æ— 

##### å‚æ•°

underlying_symbolï¼šæ ‡çš„ä»£ç ï¼Œstrç±»å‹

##### è¿”å›

listæ ¼å¼çš„æœŸæƒåˆçº¦åˆ—è¡¨

##### ç¤ºä¾‹

```python
def handle_data(context, data):
    # è·å–50ETFæœŸæƒåˆçº¦
    contracts = get_opt_contracts('510050.SH')
    log.info(contracts)
```

### è®¡ç®—å‡½æ•°

#### get_MACD - è·å–MACDæŒ‡æ ‡

```python
get_MACD(security, timeperiod)
```

##### ä½¿ç”¨åœºæ™¯

è¯¥å‡½æ•°åœ¨å›æµ‹ã€äº¤æ˜“æ¨¡å—å¯ç”¨

##### æ¥å£è¯´æ˜

è®¡ç®—MACDæŠ€æœ¯æŒ‡æ ‡ã€‚

æ³¨æ„äº‹é¡¹ï¼š

æ— 

##### å‚æ•°

securityï¼šè‚¡ç¥¨ä»£ç ï¼Œstrç±»å‹

timeperiodï¼šæ—¶é—´å‘¨æœŸï¼Œintç±»å‹

##### è¿”å›

dictæ ¼å¼çš„MACDæŒ‡æ ‡æ•°æ®

##### ç¤ºä¾‹

```python
def handle_data(context, data):
    # è®¡ç®—MACDæŒ‡æ ‡
    macd = get_MACD('600570.SS', 20)
    log.info(macd)
```

#### get_KDJ - è·å–KDJæŒ‡æ ‡

```python
get_KDJ(security, timeperiod)
```

##### ä½¿ç”¨åœºæ™¯

è¯¥å‡½æ•°åœ¨å›æµ‹ã€äº¤æ˜“æ¨¡å—å¯ç”¨

##### æ¥å£è¯´æ˜

è®¡ç®—KDJæŠ€æœ¯æŒ‡æ ‡ã€‚

æ³¨æ„äº‹é¡¹ï¼š

æ— 

##### å‚æ•°

securityï¼šè‚¡ç¥¨ä»£ç ï¼Œstrç±»å‹

timeperiodï¼šæ—¶é—´å‘¨æœŸï¼Œintç±»å‹

##### è¿”å›

dictæ ¼å¼çš„KDJæŒ‡æ ‡æ•°æ®

##### ç¤ºä¾‹

```python
def handle_data(context, data):
    # è®¡ç®—KDJæŒ‡æ ‡
    kdj = get_KDJ('600570.SS', 20)
    log.info(kdj)
```

### å…¶ä»–å‡½æ•°

#### log - æ—¥å¿—è®°å½•

```python
log.info(message)
log.warning(message)
log.error(message)
log.debug(message)
```

##### ä½¿ç”¨åœºæ™¯

è¯¥å‡½æ•°åœ¨å›æµ‹ã€äº¤æ˜“æ¨¡å—å¯ç”¨

##### æ¥å£è¯´æ˜

è®°å½•æ—¥å¿—ä¿¡æ¯ã€‚

æ³¨æ„äº‹é¡¹ï¼š

æ— 

##### å‚æ•°

messageï¼šæ—¥å¿—æ¶ˆæ¯ï¼Œstrç±»å‹

##### è¿”å›

None

##### ç¤ºä¾‹

```python
def handle_data(context, data):
    log.info('ç­–ç•¥å¼€å§‹æ‰§è¡Œ')
    log.warning('èµ„é‡‘ä¸è¶³')
    log.error('ä¸‹å•å¤±è´¥')
```

#### run_daily - æŒ‰æ—¥å‘¨æœŸå¤„ç†

```python
run_daily(func, time)
```

##### ä½¿ç”¨åœºæ™¯

è¯¥å‡½æ•°åœ¨å›æµ‹ã€äº¤æ˜“æ¨¡å—å¯ç”¨

##### æ¥å£è¯´æ˜

è®¾ç½®æŒ‰æ—¥æ‰§è¡Œçš„å®šæ—¶ä»»åŠ¡ã€‚

æ³¨æ„äº‹é¡¹ï¼š

æ— 

##### å‚æ•°

funcï¼šè¦æ‰§è¡Œçš„å‡½æ•°ï¼Œfunctionç±»å‹

timeï¼šæ‰§è¡Œæ—¶é—´ï¼Œstrç±»å‹ï¼Œæ ¼å¼ä¸º'HH:MM'

##### è¿”å›

None

##### ç¤ºä¾‹

```python
def initialize(context):
    run_daily(before_market_open, time='09:15')

def before_market_open(context):
    log.info('ç›˜å‰å‡†å¤‡')
```

#### run_interval - æŒ‰é—´éš”å‘¨æœŸå¤„ç†

```python
run_interval(func, seconds)
```

##### ä½¿ç”¨åœºæ™¯

è¯¥å‡½æ•°ä»…åœ¨äº¤æ˜“æ¨¡å—å¯ç”¨

##### æ¥å£è¯´æ˜

è®¾ç½®æŒ‰é—´éš”æ‰§è¡Œçš„å®šæ—¶ä»»åŠ¡ã€‚

æ³¨æ„äº‹é¡¹ï¼š

æ— 

##### å‚æ•°

funcï¼šè¦æ‰§è¡Œçš„å‡½æ•°ï¼Œfunctionç±»å‹

secondsï¼šé—´éš”ç§’æ•°ï¼Œintç±»å‹

##### è¿”å›

None

##### ç¤ºä¾‹

```python
def initialize(context):
    run_interval(check_market, 60)

def check_market(context):
    log.info('å¸‚åœºæ£€æŸ¥')
```

#### is_trade - ä¸šåŠ¡ä»£ç åœºæ™¯åˆ¤æ–­

```python
is_trade()
```

##### ä½¿ç”¨åœºæ™¯

è¯¥å‡½æ•°åœ¨å›æµ‹ã€äº¤æ˜“æ¨¡å—å¯ç”¨

##### æ¥å£è¯´æ˜

åˆ¤æ–­å½“å‰æ˜¯å¦ä¸ºäº¤æ˜“æ—¶é—´ã€‚

æ³¨æ„äº‹é¡¹ï¼š

æ— 

##### å‚æ•°

æ— 

##### è¿”å›

boolç±»å‹ï¼ŒTrueè¡¨ç¤ºäº¤æ˜“æ—¶é—´ï¼ŒFalseè¡¨ç¤ºéäº¤æ˜“æ—¶é—´

##### ç¤ºä¾‹

```python
def handle_data(context, data):
    if is_trade():
        log.info('å½“å‰ä¸ºäº¤æ˜“æ—¶é—´')
    else:
        log.info('å½“å‰ä¸ºéäº¤æ˜“æ—¶é—´')
```

#### check_limit - ä»£ç æ¶¨è·ŒåœçŠ¶æ€åˆ¤æ–­

```python
check_limit(security)
```

##### ä½¿ç”¨åœºæ™¯

è¯¥å‡½æ•°åœ¨å›æµ‹ã€ç ”ç©¶ã€äº¤æ˜“æ¨¡å—å¯ç”¨

##### æ¥å£è¯´æ˜

æ£€æŸ¥è‚¡ç¥¨æ˜¯å¦æ¶¨è·Œåœã€‚

æ³¨æ„äº‹é¡¹ï¼š

æ— 

##### å‚æ•°

securityï¼šè‚¡ç¥¨ä»£ç ï¼Œstrç±»å‹

##### è¿”å›

dictæ ¼å¼çš„æ¶¨è·ŒåœçŠ¶æ€ä¿¡æ¯

##### ç¤ºä¾‹

```python
def handle_data(context, data):
    # æ£€æŸ¥æ¶¨è·ŒåœçŠ¶æ€
    limit_info = check_limit('600570.SS')
    log.info(limit_info)
```

## æ•°æ®ç»“æ„

### Contextå¯¹è±¡

Contextå¯¹è±¡åŒ…å«å½“å‰çš„è´¦æˆ·ä¿¡æ¯å’ŒæŒä»“ä¿¡æ¯ã€‚

#### å±æ€§

portfolioï¼šPortfolioå¯¹è±¡ï¼ŒåŒ…å«è´¦æˆ·å’ŒæŒä»“ä¿¡æ¯

#### ç¤ºä¾‹

```python
def handle_data(context, data):
    # è·å–æ€»èµ„äº§
    total_value = context.portfolio.total_value
    # è·å–å¯ç”¨èµ„é‡‘
    cash = context.portfolio.cash
    # è·å–æŒä»“
    positions = context.portfolio.positions
```

### Portfolioå¯¹è±¡

Portfolioå¯¹è±¡åŒ…å«è´¦æˆ·çš„èµ„äº§å’ŒæŒä»“ä¿¡æ¯ã€‚

#### å±æ€§

total_valueï¼šæ€»èµ„äº§ï¼Œfloatç±»å‹

cashï¼šå¯ç”¨èµ„é‡‘ï¼Œfloatç±»å‹

positionsï¼šæŒä»“å­—å…¸ï¼Œdictç±»å‹

market_valueï¼šæŒä»“å¸‚å€¼ï¼Œfloatç±»å‹

#### ç¤ºä¾‹

```python
def handle_data(context, data):
    portfolio = context.portfolio
    log.info(f'æ€»èµ„äº§: {portfolio.total_value}')
    log.info(f'å¯ç”¨èµ„é‡‘: {portfolio.cash}')
    log.info(f'æŒä»“å¸‚å€¼: {portfolio.market_value}')
```

### Positionå¯¹è±¡

Positionå¯¹è±¡åŒ…å«å•ä¸ªè‚¡ç¥¨çš„æŒä»“ä¿¡æ¯ã€‚

#### å±æ€§

securityï¼šè‚¡ç¥¨ä»£ç ï¼Œstrç±»å‹

amountï¼šæŒä»“æ•°é‡ï¼Œintç±»å‹

avg_costï¼šå¹³å‡æˆæœ¬ï¼Œfloatç±»å‹

priceï¼šå½“å‰ä»·æ ¼ï¼Œfloatç±»å‹

market_valueï¼šæŒä»“å¸‚å€¼ï¼Œfloatç±»å‹

#### ç¤ºä¾‹

```python
def handle_data(context, data):
    position = get_position('600570.SS')
    log.info(f'æŒä»“æ•°é‡: {position.amount}')
    log.info(f'å¹³å‡æˆæœ¬: {position.avg_cost}')
    log.info(f'å½“å‰ä»·æ ¼: {position.price}')
```

### Orderå¯¹è±¡

Orderå¯¹è±¡åŒ…å«è®¢å•ä¿¡æ¯ã€‚

#### å±æ€§

securityï¼šè‚¡ç¥¨ä»£ç ï¼Œstrç±»å‹

amountï¼šè®¢å•æ•°é‡ï¼Œintç±»å‹

priceï¼šè®¢å•ä»·æ ¼ï¼Œfloatç±»å‹

statusï¼šè®¢å•çŠ¶æ€ï¼Œstrç±»å‹

order_idï¼šè®¢å•IDï¼Œstrç±»å‹

#### ç¤ºä¾‹

```python
def handle_data(context, data):
    order_obj = order('600570.SS', 1000)
    log.info(f'è®¢å•ID: {order_obj.order_id}')
    log.info(f'è®¢å•çŠ¶æ€: {order_obj.status}')
```

## æ³¨æ„äº‹é¡¹

1. æ‰€æœ‰è‚¡ç¥¨ä»£ç å¿…é¡»ä½¿ç”¨æ ‡å‡†æ ¼å¼ï¼Œå¦‚'600570.SS'ã€'000001.SZ'
2. äº¤æ˜“å‡½æ•°åªèƒ½åœ¨äº¤æ˜“æ—¶é—´å†…è°ƒç”¨
3. å›æµ‹å’Œäº¤æ˜“ç¯å¢ƒä¸‹æŸäº›å‡½æ•°çš„è¡Œä¸ºå¯èƒ½æœ‰æ‰€ä¸åŒ
4. æœŸè´§å’ŒæœŸæƒäº¤æ˜“éœ€è¦ç›¸åº”çš„æƒé™
5. èèµ„èåˆ¸äº¤æ˜“éœ€è¦å¼€é€šç›¸åº”æƒé™
6. æ•°æ®è·å–å‡½æ•°å¯èƒ½å—åˆ°ç½‘ç»œå’Œæ•°æ®æºé™åˆ¶
7. æŠ€æœ¯æŒ‡æ ‡è®¡ç®—éœ€è¦è¶³å¤Ÿçš„å†å²æ•°æ®
8. å®šæ—¶ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´å¯èƒ½å—åˆ°ç³»ç»Ÿè´Ÿè½½å½±å“

## ç‰ˆæœ¬ä¿¡æ¯

æœ¬æ–‡æ¡£åŸºäºPTrade APIå®˜æ–¹æ–‡æ¡£ç¼–å†™ï¼Œç‰ˆæœ¬ä¿¡æ¯è¯·å‚è€ƒå®˜æ–¹ç½‘ç«™ã€‚

æ–‡æ¡£æœ€åæ›´æ–°æ—¶é—´ï¼š2025å¹´7æœˆ6æ—¥
