import{_ as C,ae as j,q as i,b as n,a as c,A as b,w as g,v as u,a6 as I,F as f,z as p,d as K,B as w,D as h,H as B,s as y,l as _,ce as L,cf as P,cg as D,ch as v,ci as E,b8 as N,b9 as R,C as V,y as x}from"./main-CpP-5rLh.js";import{V as G}from"./VTable-C-cNChDa.js";import{C as z}from"./confirm-dialog-AMnfyuMm.js";import{c as U}from"./copy-to-clipboard-DoUvDJVx.js";import{useAdminStore as T}from"./admin-BQ68PA7O.js";import"./forwardRefs-CGpIPavG.js";import"./VDialog-tf0N3lvG.js";const F={name:"StatsTable",props:{title:{type:String,required:!0},items:{type:Object,required:!0}},data(){return{}},methods:{valueTable(e){return e&&typeof e=="object"?e:{}},tdClasses(e){return{indent:e[0]==="+"}},tdLabel(e){return e.replace(/^\+/,"")},nf(e){return typeof e=="number"?j.format(e):e}}},H={class:"statBlock"},$={key:0},q={colspan:"2",class:"subtitleRow"},M={key:1},X={class:"indent"};function Y(e,t,a,s,l,o){return u(),i("div",H,[n("h3",null,b(a.title),1),c(G,{class:"highlight-table"},{default:g(()=>[(u(!0),i(f,null,p(Object.entries(a.items),([r,d])=>(u(),i("tbody",{key:r},[typeof d=="object"?(u(),i("tr",$,[n("th",q,b(r),1)])):(u(),i("tr",M,[n("td",{class:K(o.tdClasses(r))},b(o.tdLabel(r)),3),n("td",null,b(o.nf(d)),1)])),(u(!0),i(f,null,p(Object.entries(o.valueTable(d)),([m,S])=>(u(),i("tr",{key:m},[n("td",X,b(m),1),n("td",null,b(o.nf(S)),1)]))),128))]))),128)),I(e.$slots,"default",{},void 0,!0)]),_:3})])}const J=C(F,[["render",Y],["__scopeId","data-v-4bb3ecd9"]]),k={topGroup:v,orderBy:D,fitTo:P,readingDirection:L},A={authGroupCount:"Authorization Groups",libraryCount:"Libraries",userAnonymousCount:"Anonymous Users",userRegisteredCount:"Registered Users"};Object.freeze(A);Object.freeze(k);const O=new Set(["storyArcNumbersCount","identifierTypesCount","contributorPersonsCount","contributorRolesCount"]);Object.freeze(O);const Q={name:"AdminTasksTab",components:{ConfirmDialog:z,StatsTable:J},data(){return{showTooltip:{show:!1},schemaHref:globalThis.CODEX.API_V3_PATH+"#/api/api_v3_admin_stats_retrieve"}},computed:{...h(V,{}),...h(T,{stats:e=>e.stats}),clipBoardEnabled(){return location.prototcal=="https:"},apiTooltip(){return this.clipBoardEnabled},clipBoardIcon(){return this.showTooltip?N:R},platformTable(){const e={};for(const[t,a]of Object.entries(this.stats?.platform)){const s=this.keyToLabel(t),l=t==="system"?`${a.name} ${a.release}`:a;e[s]=l}return e},configTable(){const e={};let t="";for(const[a,s]of Object.entries(this.stats?.config)){let l;if(a=="apiKey"){t=s;continue}else l=A[a];e[l]=s}return e["API Key"]=t,e},userSettingsTable(){const e={};for(const[t,a]of Object.entries(this.stats?.sessions)){const s={},l=k[t];for(const[r,d]of Object.entries(a)){let m;m=l?l[E(r)]:r,s[m]=d}const o=this.keyToLabel(t);e[o]=s}return e},browserGroupsTable(){const e={};for(const[t,a]of Object.entries(this.stats?.groups)){let s=this.keyToLabel(t);s!=="Series"&&(s+="s"),e[s]=a}return e},fileTypesTable(){const e={};for(const[t,a]of Object.entries(this.stats?.fileTypes)){const s=t==="unknown"?_(t):this.keyToLabel(t).toUpperCase();e[s]=a}return e},metadataTable(){const e={};for(const[t,a]of Object.entries(this.stats?.metadata)){let s=t==="countryCount"?"Countries":this.keyToLabel(t)+"s";O.has(t)&&(s=s.replace(/^\w+ /,"+")),e[s]=a}return e}},created(){this.loadStats()},methods:{...w(T,["loadStats","updateAPIKey"]),regenAPIKey(){this.updateAPIKey().then(this.loadStats).catch(console.warn)},onClickAPIKey(){this.clipBoardEnabled&&U(this.stats.config.apiKey,this.showTooltip)},keyToLabel(e){return e=e.replace(/Count$/,""),_(e)}}},W={key:0,id:"stats"},Z={id:"schemaDoc"},ee={colspan:"2"},te=["href"],se={colspan:"2"};function ae(e,t,a,s,l,o){const r=y("StatsTable"),d=y("ConfirmDialog");return e.stats?(u(),i("div",W,[c(r,{title:"Platform",items:o.platformTable},null,8,["items"]),c(r,{title:"Config",items:o.configTable},{default:g(()=>[n("tbody",null,[n("tr",Z,[n("td",ee,[t[0]||(t[0]=x(" The only endpoint accessible by API Key is ")),n("a",{href:l.schemaHref,target:"_blank"},"/admin/stats",8,te)])]),n("tr",null,[n("td",se,[c(d,{"button-text":"Regenerate API Key","title-text":"Regenerate",text:"API Key","confirm-text":"Regenerate",onConfirm:o.regenAPIKey},null,8,["onConfirm"])])])])]),_:1},8,["items"]),c(r,{title:"User Settings",items:o.userSettingsTable},null,8,["items"]),c(r,{title:"Browser Groups",items:o.browserGroupsTable},null,8,["items"]),c(r,{title:"File Types",items:o.fileTypesTable},null,8,["items"]),c(r,{title:"Metadata",items:o.metadataTable},null,8,["items"])])):B("",!0)}const de=C(Q,[["render",ae],["__scopeId","data-v-8fe4ac31"]]);export{de as default};
