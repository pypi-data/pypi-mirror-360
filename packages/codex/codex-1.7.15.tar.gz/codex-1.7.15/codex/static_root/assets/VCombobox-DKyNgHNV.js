import{u as Ve,t as F,e as ye,m as Ce,a as pe,V as ke,b as we,d as Se}from"./VSelect-Cv8OuNtL.js";import{p as Fe,q as Ie,c as H}from"./VSelectionControl-DoFzRlEh.js";import{u as De,f as Pe,p as Re,k as $,l as Ae}from"./forwardRefs-CGpIPavG.js";import{u as Ee,m as Te,h as Me}from"./filter-BucmWboA.js";import{g as _e,p as Ne,aQ as Be,r as M,aR as I,e as G,bB as Ke,c as x,t as Le,aS as D,bC as Q,aV as W,u as Oe,o as Ue,a as d,m as p,bD as ze,bE as J,bq as qe,b as k,bF as je,F as z,bG as He,n as $e,d as Ge,y as Qe}from"./main-CpP-5rLh.js";import{a as X,g as We}from"./VDialog-tf0N3lvG.js";import{V as Je}from"./VCheckboxBtn-Bxf1MS02.js";const Xe=Ne({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,...Te({filterKeys:["title"]}),...Ce({hideNoData:!0,returnObject:!0}),...Ue(Ie({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...Re({transition:!1})},"VCombobox"),nl=_e()({name:"VCombobox",props:Xe(),emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,"update:search":e=>!0,"update:menu":e=>!0},setup(e,Y){let{emit:Z,slots:c}=Y;const{t:_}=Be(),f=M(),b=I(!1),V=I(!0),N=I(!1),q=M(),B=M(),o=I(-1);let K=!1;const{items:ee,transformIn:le,transformOut:te}=Ve(e),{textColorClasses:ae,textColorStyles:ue}=De(()=>f.value?.color),a=G(e,"modelValue",[],l=>le(Ke(l)),l=>{const n=te(l);return e.multiple?n:n[0]??null}),P=Fe(e),R=x(()=>!!(e.chips||c.chip)),g=x(()=>R.value||!!c.selection),y=I(!e.multiple&&!g.value?a.value[0]?.title??"":""),r=x({get:()=>y.value,set:l=>{if(y.value=l??"",!e.multiple&&!g.value&&(a.value=[F(e,l)]),l&&e.multiple&&e.delimiters?.length){const n=l.split(new RegExp(`(?:${e.delimiters.join("|")})+`));n.length>1&&(n.forEach(i=>{i=i.trim(),i&&m(F(e,i))}),y.value="")}l||(o.value=-1),V.value=!l}}),ne=x(()=>typeof e.counterValue=="function"?e.counterValue(a.value):typeof e.counterValue=="number"?e.counterValue:e.multiple?a.value.length:r.value.length),{filteredItems:A,getMatches:oe}=Ee(e,ee,()=>V.value?"":r.value),C=x(()=>e.hideSelected?A.value.filter(l=>!a.value.some(n=>n.value===l.value)):A.value),E=x(()=>e.hideNoData&&!C.value.length||P.isReadonly.value||P.isDisabled.value),L=G(e,"menu"),s=x({get:()=>L.value,set:l=>{L.value&&!l&&q.value?.Î¨openChildren.size||l&&E.value||(L.value=l)}}),j=Le(()=>s.value?e.closeText:e.openText);D(y,l=>{K?W(()=>K=!1):b.value&&!s.value&&(s.value=!0),Z("update:search",l)}),D(a,l=>{!e.multiple&&!g.value&&(y.value=l[0]?.title??"")});const ie=x(()=>a.value.map(l=>l.value)),O=x(()=>(e.autoSelectFirst===!0||e.autoSelectFirst==="exact"&&r.value===C.value[0]?.title)&&C.value.length>0&&!V.value&&!N.value),U=M(),se=ye(U,f);function re(l){K=!0,e.openOnClear&&(s.value=!0)}function ce(){E.value||(s.value=!0)}function ve(l){E.value||(b.value&&(l.preventDefault(),l.stopPropagation()),s.value=!s.value)}function de(l){l.key!==" "&&J(l)&&f.value?.focus()}function fe(l){if(ze(l)||P.isReadonly.value)return;const n=f.value?.selectionStart,i=a.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(l.key)&&l.preventDefault(),["Enter","ArrowDown"].includes(l.key)&&(s.value=!0),["Escape"].includes(l.key)&&(s.value=!1),["Enter","Escape","Tab"].includes(l.key)&&(O.value&&["Enter","Tab"].includes(l.key)&&!a.value.some(t=>{let{value:u}=t;return u===C.value[0].value})&&m(A.value[0]),V.value=!0),l.key==="ArrowDown"&&O.value&&U.value?.focus("next"),l.key==="Enter"&&r.value&&(m(F(e,r.value)),g.value&&(y.value="")),["Backspace","Delete"].includes(l.key)){if(!e.multiple&&g.value&&a.value.length>0&&!r.value)return m(a.value[0],!1);if(~o.value){l.preventDefault();const t=o.value;m(a.value[o.value],!1),o.value=t>=i-1?i-2:t}else l.key==="Backspace"&&!r.value&&(o.value=i-1);return}if(e.multiple)if(l.key==="ArrowLeft"){if(o.value<0&&n&&n>0)return;const t=o.value>-1?o.value-1:i-1;a.value[t]?o.value=t:(o.value=-1,f.value?.setSelectionRange(r.value.length,r.value.length))}else if(l.key==="ArrowRight"){if(o.value<0)return;const t=o.value+1;a.value[t]?o.value=t:(o.value=-1,f.value?.setSelectionRange(0,0))}else~o.value&&J(l)&&(o.value=-1)}function me(){e.eager&&B.value?.calculateVisibleItems()}function he(){b.value&&(V.value=!0,f.value?.focus())}function m(l){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!l||l.props.disabled))if(e.multiple){const i=a.value.findIndex(u=>(e.valueComparator||Q)(u.value,l.value)),t=n??!~i;if(~i){const u=t?[...a.value,l]:[...a.value];u.splice(i,1),a.value=u}else t&&(a.value=[...a.value,l]);e.clearOnSelect&&(r.value="")}else{const i=n!==!1;a.value=i?[l]:[],y.value=i&&!g.value?l.title:"",W(()=>{s.value=!1,V.value=!0})}}function be(l){b.value=!0,setTimeout(()=>{N.value=!0})}function ge(l){N.value=!1}function xe(l){(l==null||l===""&&!e.multiple&&!g.value)&&(a.value=[])}return D(b,(l,n)=>{if(!(l||l===n)&&(o.value=-1,s.value=!1,r.value)){if(e.multiple){m(F(e,r.value));return}if(!g.value)return;a.value.some(i=>{let{title:t}=i;return t===r.value})?y.value="":m(F(e,r.value))}}),D(s,()=>{if(!e.hideSelected&&s.value&&a.value.length){const l=C.value.findIndex(n=>a.value.some(i=>(e.valueComparator||Q)(i.value,n.value)));qe&&window.requestAnimationFrame(()=>{l>=0&&B.value?.scrollToIndex(l)})}}),D(()=>e.items,(l,n)=>{s.value||b.value&&!n.length&&l.length&&(s.value=!0)}),Oe(()=>{const l=!!(!e.hideNoData||C.value.length||c["prepend-item"]||c["append-item"]||c["no-data"]),n=a.value.length>0,i=H.filterProps(e);return d(H,p({ref:f},i,{modelValue:r.value,"onUpdate:modelValue":[t=>r.value=t,xe],focused:b.value,"onUpdate:focused":t=>b.value=t,validationValue:a.externalValue,counterValue:ne.value,dirty:n,class:["v-combobox",{"v-combobox--active-menu":s.value,"v-combobox--chips":!!e.chips,"v-combobox--selection-slot":!!g.value,"v-combobox--selecting-index":o.value>-1,[`v-combobox--${e.multiple?"multiple":"single"}`]:!0},e.class],style:e.style,readonly:P.isReadonly.value,placeholder:n?void 0:e.placeholder,"onClick:clear":re,"onMousedown:control":ce,onKeydown:fe}),{...c,default:()=>k(z,null,[d(pe,p({ref:q,modelValue:s.value,"onUpdate:modelValue":t=>s.value=t,activator:"parent",contentClass:"v-combobox__content",disabled:E.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterEnter:me,onAfterLeave:he},e.menuProps),{default:()=>[l&&d(ke,p({ref:U,selected:ie.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:t=>t.preventDefault(),onKeydown:de,onFocusin:be,onFocusout:ge,tabindex:"-1","aria-live":"polite",color:e.itemColor??e.color},se,e.listProps),{default:()=>[c["prepend-item"]?.(),!C.value.length&&!e.hideNoData&&(c["no-data"]?.()??d(X,{key:"no-data",title:_(e.noDataText)},null)),d(we,{ref:B,renderless:!0,items:C.value,itemKey:"value"},{default:t=>{let{item:u,index:h,itemRef:T}=t;const w=p(u.props,{ref:T,key:u.value,active:O.value&&h===0?!0:void 0,onClick:()=>m(u,null)});return c.item?.({item:u,index:h,props:w})??d(X,p(w,{role:"option"}),{prepend:S=>{let{isSelected:v}=S;return k(z,null,[e.multiple&&!e.hideSelected?d(Je,{key:u.value,modelValue:v,ripple:!1,tabindex:"-1"},null):void 0,u.props.prependAvatar&&d(We,{image:u.props.prependAvatar},null),u.props.prependIcon&&d($,{icon:u.props.prependIcon},null)])},title:()=>V.value?u.title:Me("v-combobox",u.title,oe(u)?.title)})}}),c["append-item"]?.()]})]}),a.value.map((t,u)=>{function h(v){v.stopPropagation(),v.preventDefault(),m(t,!1)}const T={"onClick:close":h,onKeydown(v){v.key!=="Enter"&&v.key!==" "||(v.preventDefault(),v.stopPropagation(),h(v))},onMousedown(v){v.preventDefault(),v.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},w=R.value?!!c.chip:!!c.selection,S=w?He(R.value?c.chip({item:t,index:u,props:T}):c.selection({item:t,index:u})):void 0;if(!(w&&!S))return k("div",{key:t.value,class:Ge(["v-combobox__selection",u===o.value&&["v-combobox__selection--selected",ae.value]]),style:$e(u===o.value?ue.value:{})},[R.value?c.chip?d(Ae,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:t.title}}},{default:()=>[S]}):d(Se,p({key:"chip",closable:e.closableChips,size:"small",text:t.title,disabled:t.props.disabled},T),null):S??k("span",{class:"v-combobox__selection-text"},[t.title,e.multiple&&u<a.value.length-1&&k("span",{class:"v-combobox__selection-comma"},[Qe(",")])])])})]),"append-inner":function(){for(var t=arguments.length,u=new Array(t),h=0;h<t;h++)u[h]=arguments[h];return k(z,null,[c["append-inner"]?.(...u),(!e.hideNoData||e.items.length)&&e.menuIcon?d($,{class:"v-combobox__menu-icon",color:f.value?.fieldIconColor,icon:e.menuIcon,onMousedown:ve,onClick:je,"aria-label":_(j.value),title:_(j.value),tabindex:"-1"},null):void 0])}})}),Pe({isFocused:b,isPristine:V,menu:s,search:r,selectionIndex:o,filteredItems:A,select:m},f)}});export{nl as V};
