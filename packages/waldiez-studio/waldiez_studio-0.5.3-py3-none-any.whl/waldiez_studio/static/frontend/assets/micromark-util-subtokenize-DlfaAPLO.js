import{s as t}from"./micromark-util-chunked-3k3e5hER.js";class e{constructor(t){this.left=t?[...t]:[],this.right=[]}get(t){if(t<0||t>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+t+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return t<this.left.length?this.left[t]:this.right[this.right.length-t+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(t,e){const i=null==e?Number.POSITIVE_INFINITY:e;return i<this.left.length?this.left.slice(t,i):t>this.left.length?this.right.slice(this.right.length-i+this.left.length,this.right.length-t+this.left.length).reverse():this.left.slice(t).concat(this.right.slice(this.right.length-i+this.left.length).reverse())}splice(t,e,s){const n=e||0;this.setCursor(Math.trunc(t));const h=this.right.splice(this.right.length-n,Number.POSITIVE_INFINITY);return s&&i(this.left,s),h.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(t){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(t)}pushMany(t){this.setCursor(Number.POSITIVE_INFINITY),i(this.left,t)}unshift(t){this.setCursor(0),this.right.push(t)}unshiftMany(t){this.setCursor(0),i(this.right,t.reverse())}setCursor(t){if(!(t===this.left.length||t>this.left.length&&0===this.right.length||t<0&&0===this.left.length))if(t<this.left.length){const e=this.left.splice(t,Number.POSITIVE_INFINITY);i(this.right,e.reverse())}else{const e=this.right.splice(this.left.length+this.right.length-t,Number.POSITIVE_INFINITY);i(this.left,e.reverse())}}}function i(t,e){let i=0;if(e.length<1e4)t.push(...e);else for(;i<e.length;)t.push(...e.slice(i,i+1e4)),i+=1e4}function s(i){const s={};let h,r,l,g,o,f,c,u=-1;const p=new e(i);for(;++u<p.length;){for(;u in s;)u=s[u];if(h=p.get(u),u&&"chunkFlow"===h[1].type&&"listItemPrefix"===p.get(u-1)[1].type&&(f=h[1]._tokenizer.events,l=0,l<f.length&&"lineEndingBlank"===f[l][1].type&&(l+=2),l<f.length&&"content"===f[l][1].type))for(;++l<f.length&&"content"!==f[l][1].type;)"chunkText"===f[l][1].type&&(f[l][1]._isInFirstContentOfListItem=!0,l++);if("enter"===h[0])h[1].contentType&&(Object.assign(s,n(p,u)),u=s[u],c=!0);else if(h[1]._container){for(l=u,r=void 0;l--;)if(g=p.get(l),"lineEnding"===g[1].type||"lineEndingBlank"===g[1].type)"enter"===g[0]&&(r&&(p.get(r)[1].type="lineEndingBlank"),g[1].type="lineEnding",r=l);else if("linePrefix"!==g[1].type&&"listItemIndent"!==g[1].type)break;r&&(h[1].end={...p.get(r)[1].start},o=p.slice(r,u),o.unshift(h),p.splice(r,u-r+1,o))}}return t(i,0,Number.POSITIVE_INFINITY,p.slice(0)),!c}function n(t,e){const i=t.get(e)[1],s=t.get(e)[2];let n=e-1;const h=[];let r=i._tokenizer;r||(r=s.parser[i.contentType](i.start),i._contentTypeTextTrailing&&(r._contentTypeTextTrailing=!0));const l=r.events,g=[],o={};let f,c,u=-1,p=i,I=0,a=0;const T=[a];for(;p;){for(;t.get(++n)[1]!==p;);h.push(n),p._tokenizer||(f=s.sliceStream(p),p.next||f.push(null),c&&r.defineSkip(p.start),p._isInFirstContentOfListItem&&(r._gfmTasklistFirstContentOfListItem=!0),r.write(f),p._isInFirstContentOfListItem&&(r._gfmTasklistFirstContentOfListItem=void 0)),c=p,p=p.next}for(p=i;++u<l.length;)"exit"===l[u][0]&&"enter"===l[u-1][0]&&l[u][1].type===l[u-1][1].type&&l[u][1].start.line!==l[u][1].end.line&&(a=u+1,T.push(a),p._tokenizer=void 0,p.previous=void 0,p=p.next);for(r.events=[],p?(p._tokenizer=void 0,p.previous=void 0):T.pop(),u=T.length;u--;){const e=l.slice(T[u],T[u+1]),i=h.pop();g.push([i,i+e.length-1]),t.splice(i,2,e)}for(g.reverse(),u=-1;++u<g.length;)o[I+g[u][0]]=I+g[u][1],I+=g[u][1]-g[u][0]-1;return o}export{s};
