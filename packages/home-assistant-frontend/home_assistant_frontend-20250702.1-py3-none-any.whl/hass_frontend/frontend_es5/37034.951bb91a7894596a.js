"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["37034"],{7214:function(t,e,i){i.d(e,{Cj:function(){return l},F7:function(){return s},Hs:function(){return T},Kd:function(){return S},Kj:function(){return f},Nw:function(){return v},PA:function(){return r},Py:function(){return c},Qm:function(){return E},Z0:function(){return p},_Y:function(){return d},_m:function(){return a},dL:function(){return u},dO:function(){return w},hN:function(){return h},h_:function(){return _},j2:function(){return b},q6:function(){return g},uR:function(){return o}});i(39710),i(26847),i(81738),i(72489),i(56389),i(27530);var n=i(15459),s=function(t){return t[t.NONE=0]="NONE",t[t.ARITHMETIC=1]="ARITHMETIC",t[t.CIRCULAR=2]="CIRCULAR",t}({});const r=99387==i.j?["entity_not_recorded","entity_no_longer_recorded","state_class_removed","units_changed","mean_type_changed","no_state"]:null,a=t=>t.sendMessagePromise({type:"recorder/info"}),o=(t,e)=>t.callWS({type:"recorder/list_statistic_ids",statistic_type:e}),c=(t,e)=>t.callWS({type:"recorder/get_statistics_metadata",statistic_ids:e}),u=(t,e,i,n,s="hour",r,a)=>t.callWS({type:"recorder/statistics_during_period",start_time:e.toISOString(),end_time:null==i?void 0:i.toISOString(),statistic_ids:n,period:s,units:r,types:a}),d=(t,e,i,n)=>t.callWS({type:"recorder/statistic_during_period",statistic_id:e,units:n,fixed_period:i.fixed_period?{start_time:i.fixed_period.start instanceof Date?i.fixed_period.start.toISOString():i.fixed_period.start,end_time:i.fixed_period.end instanceof Date?i.fixed_period.end.toISOString():i.fixed_period.end}:void 0,calendar:i.calendar,rolling_window:i.rolling_window}),_=t=>t.callWS({type:"recorder/validate_statistics"}),l=(t,e,i)=>t.callWS({type:"recorder/update_statistics_metadata",statistic_id:e,unit_of_measurement:i}),h=(t,e)=>t.callWS({type:"recorder/clear_statistics",statistic_ids:e}),f=t=>{let e=null;if(!t)return null;for(const i of t)null!==i.change&&void 0!==i.change&&(null===e?e=i.change:e+=i.change);return e},g=(t,e)=>{let i=null;for(const n of e){if(!(n in t))continue;const e=f(t[n]);null!==e&&(null===i?i=e:i+=e)}return i},v=(t,e)=>t.some(t=>void 0!==t[e]&&null!==t[e]),y=["mean","min","max"],m=["sum","state","change"],p=(t,e)=>!(!y.includes(e)||0===t.mean_type)||!(!m.includes(e)||!t.has_sum),b=(t,e,i,n,s)=>{const r=new Date(i).toISOString();return t.callWS({type:"recorder/adjust_sum_statistics",statistic_id:e,start_time:r,adjustment:n,adjustment_unit_of_measurement:s})},S=(t,e,i)=>{const s=t.states[e];return s?(0,n.C)(s):(null==i?void 0:i.name)||e},w=(t,e,i)=>{let n;var s;e&&(n=null===(s=t.states[e])||void 0===s?void 0:s.attributes.unit_of_measurement);return void 0===n?null==i?void 0:i.statistics_unit_of_measurement:n},T=t=>t.includes(":"),E=t=>t.callWS({type:"recorder/update_statistics_issues"})},94969:function(t,e,i){i.a(t,async function(t,n){try{i.d(e,{J:function(){return E},MC:function(){return w},Zx:function(){return x},b4:function(){return T},kT:function(){return j}});var s=i(61943),r=(i(12212),i(25518),i(24674),i(55204),i(26847),i(24819),i(2394),i(18574),i(13571),i(20678),i(81738),i(94814),i(22960),i(6989),i(96821),i(87799),i(54480),i(11353),i(67886),i(65451),i(46015),i(38334),i(94880),i(75643),i(29761),i(48694),i(44261),i(67398),i(27530),i(38039)),a=i(7722),o=i(46363),c=i(5280),u=i(2061),d=i(6483),_=i(73228),l=i(98853),h=i(11736),f=i(46021),g=i(21343),v=i(72937),y=i(28598),m=i(40142),p=i(45691),b=t([m,p,y]);function w(t,e){var i=new Date(e);return t>2&&0===i.getHours()&&(i=(0,r.b)(i,1)),i.setMinutes(0,0,0),t>35&&i.setDate(1),t>2&&i.setHours(0),i.getTime()}function T(t){return t>35?"month":t>2?"day":"hour"}function E(t,e,i,n,s,r,o,c){var u=(0,a.j)(e,t),d=void 0!==r&&void 0!==o;return{xAxis:{type:"time",min:t,max:w(u,e)},yAxis:{type:"value",name:s,nameGap:2,nameTextStyle:{align:"left"},axisLabel:{formatter:function(t){return(0,y.uf)(Math.abs(t),i)}},splitLine:{show:!0}},grid:{top:15,bottom:0,left:1,right:1,containLabel:!0},tooltip:{trigger:"axis",formatter:function(t){if(Array.isArray(t)){var e=[],r=[];return t.forEach(function(t){var i;null!==(i=t.seriesId)&&void 0!==i&&i.startsWith("compare-")?r.push(t):e.push(t)}),[e,r].map(function(t){return k(t,i,n,u,d,s,c)}).filter(Boolean).join("<br><br>")}return k([t],i,n,u,d,s,c)}}}}function k(t,e,i,n,s,r,a){var c,u,d,_;if(null===(c=t[0])||void 0===c||!c.value)return"";var l,h=new Date(null!==(u=null===(d=t[0].value)||void 0===d?void 0:d[2])&&void 0!==u?u:null===(_=t[0].value)||void 0===_?void 0:_[0]);l=n>89?"".concat((0,m.NC)(h,e,i)):n>0?"".concat((0,m.ud)(h,e,i)):"".concat(s?"".concat((0,m.ud)(h,e,i),": "):"").concat((0,p.mr)(h,e,i)," â€“ ").concat((0,p.mr)((0,o.T)(h,1),e,i));var f='<h4 style="text-align: center; margin: 0;">'.concat(l,"</h4>"),g=0,v=0,b=0,S=0,w=t.map(function(t){var i,n=null===(i=t.value)||void 0===i?void 0:i[1],s=(0,y.uf)(n,e);return"0"!==s&&("bar"===t.componentSubType&&(n>0?(g+=n,v++):(b+=n,S++)),"".concat(t.marker," ").concat(t.seriesName,": ").concat(s," ").concat(r))}).filter(Boolean),T="";return 0!==g&&v>1&&a&&(T+="<br><b>".concat(a(g),"</b>")),0!==b&&S>1&&a&&(T+="<br><b>".concat(a(b),"</b>")),w.length>0?"".concat(f).concat(w.join("<br>")).concat(T):""}function x(t){Array.from(new Set(t.map(function(t){return t.data.map(function(t){return Number(t[0])})}).flat())).sort(function(t,e){return t-e}).forEach(function(e,i){for(var n={},r={},a=t.length-1;a>=0;a--){var o,c,u,d,_,l,h=t[a].data[i],f=h&&"object"===(0,s.Z)(h)&&"value"in h?h:{value:h},g=null===(o=f.value)||void 0===o?void 0:o[0],v=null!==(c=t[a].stack)&&void 0!==c?c:"";if(void 0!==g)if(Number(g)!==e)null===(l=t[a].data)||void 0===l||l.splice(i,0,{value:[e,0],itemStyle:{borderWidth:0}});else 0===(null===(u=f.value)||void 0===u?void 0:u[1])?t[a].data[i]=Object.assign(Object.assign({},f),{},{itemStyle:Object.assign(Object.assign({},f.itemStyle),{},{borderWidth:0})}):!n[v]&&(null===(d=f.value)||void 0===d?void 0:d[1])>0?(t[a].data[i]=Object.assign(Object.assign({},f),{},{itemStyle:Object.assign(Object.assign({},f.itemStyle),{},{borderRadius:[4,4,0,0]})}),n[v]=!0):!r[v]&&(null===(_=f.value)||void 0===_?void 0:_[1])<0&&(t[a].data[i]=Object.assign(Object.assign({},f),{},{itemStyle:Object.assign(Object.assign({},f.itemStyle),{},{borderRadius:[0,0,4,4]})}),r[v]=!0)}})}function j(t,e){if(!e)return function(t){return t};var i=(0,c.o)(t,e);if(0!==i&&t.getTime()===(0,u.e)(t).getTime())return function(t){return(0,d.B)(t,i)};var n=(0,_.d)(t,e);if(0!==n&&t.getTime()===(0,l.N)(t).getTime())return function(t){return(0,h.z)(t,n)};var s=(0,a.j)(t,e);if(0!==s&&t.getTime()===(0,f.b)(t).getTime())return function(t){return(0,g.E)(t,s)};var r=t.getTime()-e.getTime();return function(t){return(0,v.n)(t,r)}}[m,p,y]=b.then?(await b)():b,n()}catch(S){n(S)}})},75382:function(t,e,i){i.a(t,async function(t,n){try{i.r(e),i.d(e,{DEFAULT_DAYS_TO_SHOW:function(){return Z},HuiStatisticsGraphCard:function(){return C}});var s,r,a,o=i(74904),c=i(54982),u=i(29694),d=i(75778),_=i(54521),l=i(4490),h=i(20129),f=i(85297),g=i(53389),v=(i(40777),i(12212),i(70021),i(26847),i(2394),i(81738),i(29981),i(22960),i(54480),i(69920),i(1455),i(48694),i(67398),i(27530),i(73742)),y=i(7722),m=i(38039),p=i(59048),b=i(7616),S=i(31733),w=(i(31138),i(6640)),T=i(94969),E=i(7214),k=i(45063),x=i(93647),j=i(55577),O=t([w,T]);[w,T]=O.then?(await O)():O;var Z=30,C=function(t){function e(){var t;(0,_.Z)(this,e);for(var i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(t=(0,h.Z)(this,e,[].concat(n)))._entities=[],t._names={},t}return(0,f.Z)(e,t),(0,l.Z)(e,[{key:"disconnectedCallback",value:function(){(0,g.Z)(e,"disconnectedCallback",this,3)([]),this._unsubscribeEnergy(),this._interval&&(clearInterval(this._interval),this._interval=void 0)}},{key:"connectedCallback",value:function(){var t;(0,g.Z)(e,"connectedCallback",this,3)([]),this.hasUpdated&&(null!==(t=this._config)&&void 0!==t&&t.energy_date_selection?this._subscribeEnergy():void 0===this._interval&&this._setFetchStatisticsTimer(!0))}},{key:"_subscribeEnergy",value:function(){var t,e=this;this._energySub||(this._energySub=(0,w.UB)(this.hass,{key:null===(t=this._config)||void 0===t?void 0:t.collection_key}).subscribe(function(t){e._energyStart=t.start,e._energyEnd=t.end,e._getStatistics()}))}},{key:"_unsubscribeEnergy",value:function(){this._energySub&&(this._energySub(),this._energySub=void 0),this._energyStart=void 0,this._energyEnd=void 0}},{key:"getCardSize",value:function(){var t,e,i;return 5+(null!==(t=this._config)&&void 0!==t&&t.title?2:0)+(null!==(e=this._config)&&void 0!==e&&e.hide_legend?0:(null===(i=this._entities)||void 0===i?void 0:i.length)||0)}},{key:"getGridOptions",value:function(){return{columns:12,min_columns:6,min_rows:3}}},{key:"setConfig",value:function(t){var e=this;if(!t.entities||!Array.isArray(t.entities))throw new Error("Entities need to be an array");if(!t.entities.length)throw new Error("You must include at least one entity");var i=t.entities?(0,j.A)(t.entities,!1):[];this._entities=[],i.forEach(function(t){e._entities.push(t.entity),t.name&&(e._names[t.entity]=t.name)}),"string"==typeof t.stat_types?this._statTypes=[t.stat_types]:t.stat_types?this._statTypes=t.stat_types:this._statTypes=["change","state","sum","min","max","mean"],this._config=t}},{key:"shouldUpdate",value:function(t){return(0,x.Wh)(this,t)||t.size>1||!t.has("hass")}},{key:"willUpdate",value:function(t){if((0,g.Z)(e,"willUpdate",this,3)([t]),this._config&&t.has("_config")){var i=t.get("_config");if(this.hass){if(this._config.energy_date_selection&&!this._energySub)return void this._subscribeEnergy();if(!this._config.energy_date_selection&&this._energySub)return this._unsubscribeEnergy(),void this._setFetchStatisticsTimer();this._config.energy_date_selection&&this._energySub&&t.has("_config")&&(null==i?void 0:i.collection_key)!==this._config.collection_key&&(this._unsubscribeEnergy(),this._subscribeEnergy())}t.has("_config")&&(null==i?void 0:i.entities)!==this._config.entities?this._setFetchStatisticsTimer(!0):!t.has("_config")||(null==i?void 0:i.stat_types)===this._config.stat_types&&(null==i?void 0:i.days_to_show)===this._config.days_to_show&&(null==i?void 0:i.period)===this._config.period&&(null==i?void 0:i.unit)===this._config.unit||this._setFetchStatisticsTimer()}}},{key:"_setFetchStatisticsTimer",value:(b=(0,d.Z)((0,u.Z)().m(function t(){var e,i,n=this,s=arguments;return(0,u.Z)().w(function(t){for(;;)switch(t.n){case 0:if(i=s.length>0&&void 0!==s[0]&&s[0],clearInterval(this._interval),this._interval=0,!i){t.n=1;break}return t.n=1,this._getStatisticsMetaData(this._entities);case 1:return t.n=2,this._getStatistics();case 2:null!==(e=this._config)&&void 0!==e&&e.energy_date_selection||(this._interval=window.setInterval(function(){return n._getStatistics()},this._intervalTimeout));case 3:return t.a(2)}},t,this)})),function(){return b.apply(this,arguments)})},{key:"_period",get:function(){var t,e;return null!==(t=null===(e=this._config)||void 0===e?void 0:e.period)&&void 0!==t?t:this._energyStart&&this._energyEnd?(0,T.b4)((0,y.j)(this._energyEnd,this._energyStart)):void 0}},{key:"render",value:function(){var t,e;if(!this.hass||!this._config)return p.Ld;var i="number"==typeof(null===(t=this._config.grid_options)||void 0===t?void 0:t.rows);return(0,p.dy)(s||(s=(0,c.Z)([" <ha-card> ",' <div class="content ','"> <statistics-chart .hass="','" .isLoadingData="','" .statisticsData="','" .metadata="','" .period="','" .chartType="','" .statTypes="','" .names="','" .unit="','" .minYAxis="','" .maxYAxis="','" .startTime="','" .endTime="','" .fitYData="','" .hideLegend="','" .logarithmicScale="','" .daysToShow="','" .height="','" .expandLegend="','"></statistics-chart> </div> </ha-card> '])),this._config.title?(0,p.dy)(r||(r=(0,c.Z)(['<h1 class="card-header">',"</h1>"])),this._config.title):p.Ld,(0,S.$)({"has-header":!!this._config.title,"has-rows":!(null===(e=this._config.grid_options)||void 0===e||!e.rows)}),this.hass,!this._statistics,this._statistics,this._metadata,this._period,this._config.chart_type||"line",this._statTypes,this._names,this._unit,this._config.min_y_axis,this._config.max_y_axis,this._energyStart,this._energyEnd&&this._energyStart?(0,T.MC)((0,y.j)(this._energyEnd,this._energyStart),this._energyEnd):void 0,this._config.fit_y_data||!1,this._config.hide_legend||!1,this._config.logarithmic_scale||!1,this._energyStart&&this._energyEnd?(0,y.j)(this._energyEnd,this._energyStart):this._config.days_to_show||Z,i?"100%":void 0,this._config.expand_legend)}},{key:"_intervalTimeout",get:function(){var t;return 1e3*("5minute"===(null===(t=this._config)||void 0===t?void 0:t.period)?5:60)*60}},{key:"_getStatisticsMetaData",value:(v=(0,d.Z)((0,u.Z)().m(function t(e){var i,n;return(0,u.Z)().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,(0,E.Py)(this.hass,e);case 1:i=t.v,n={},i.forEach(function(t){n[t.statistic_id]=t}),this._metadata=n;case 2:return t.a(2)}},t,this)})),function(t){return v.apply(this,arguments)})},{key:"_getStatistics",value:(a=(0,d.Z)((0,u.Z)().m(function t(){var e,i,n,s,r,a,c,d,_=this;return(0,u.Z)().w(function(t){for(;;)switch(t.n){case 0:return i=null!==(e=this._energyStart)&&void 0!==e?e:(0,m.b)(new Date,24*(this._config.days_to_show||Z)+1),n=this._energyEnd,t.p=1,this._config.unit&&this._metadata&&(r=Object.values(this._metadata).find(function(t){return(0,E.dO)(_.hass,null==t?void 0:t.statistic_id,t)===_._config.unit}))&&(s=r.unit_class,this._unit=this._config.unit),!s&&this._metadata&&(a=this._metadata[this._entities[0]],s=null==a?void 0:a.unit_class,this._unit=s&&(0,E.dO)(this.hass,a.statistic_id,a)||void 0),c=s?(0,o.Z)({},s,this._unit):void 0,t.n=2,(0,E.dL)(this.hass,i,n,this._entities,this._period,c,this._statTypes);case 2:d=t.v,this._statistics={},this._entities.forEach(function(t){t in d&&(_._statistics[t]=d[t])}),t.n=4;break;case 3:t.p=3,t.v,this._statistics=void 0;case 4:return t.a(2)}},t,this,[[1,3]])})),function(){return a.apply(this,arguments)})}],[{key:"getConfigElement",value:(n=(0,d.Z)((0,u.Z)().m(function t(){return(0,u.Z)().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,Promise.all([i.e("73614"),i.e("15601"),i.e("15634"),i.e("28350"),i.e("97279"),i.e("16376"),i.e("2769"),i.e("68973"),i.e("29330"),i.e("55795"),i.e("87215")]).then(i.bind(i,55367));case 1:return t.a(2,document.createElement("hui-statistics-graph-card-editor"))}},t)})),function(){return n.apply(this,arguments)})},{key:"getStubConfig",value:function(t,e,i){var n=(0,k.j)(t,1,e,i,["sensor"],function(t){return"state_class"in t.attributes});return{type:"statistics-graph",entities:n.length?[n[0]]:[]}}}]);var n,a,v,b}(p.oi);C.styles=(0,p.iv)(a||(a=(0,c.Z)(["ha-card{display:flex;flex-direction:column;height:100%}.card-header{padding-bottom:0}.content{padding:16px;flex:1}.has-header{padding-top:0}statistics-chart{height:100%}.has-rows{--chart-max-height:100%}"]))),(0,v.__decorate)([(0,b.Cb)({attribute:!1})],C.prototype,"hass",void 0),(0,v.__decorate)([(0,b.SB)()],C.prototype,"_config",void 0),(0,v.__decorate)([(0,b.SB)()],C.prototype,"_statistics",void 0),(0,v.__decorate)([(0,b.SB)()],C.prototype,"_metadata",void 0),(0,v.__decorate)([(0,b.SB)()],C.prototype,"_unit",void 0),(0,v.__decorate)([(0,b.SB)()],C.prototype,"_energyStart",void 0),(0,v.__decorate)([(0,b.SB)()],C.prototype,"_energyEnd",void 0),C=(0,v.__decorate)([(0,b.Mo)("hui-statistics-graph-card")],C),n()}catch(A){n(A)}})},6483:function(t,e,i){i.d(e,{B:function(){return s}});var n=i(11736);function s(t,e,i){return(0,n.z)(t,12*e,i)}},5280:function(t,e,i){i.d(e,{o:function(){return a}});i(26847),i(27530);var n=i(69875),s=i(45589);function r(t,e,i){const[s,r]=(0,n.d)(null==i?void 0:i.in,t,e);return s.getFullYear()-r.getFullYear()}function a(t,e,i){const[a,o]=(0,n.d)(null==i?void 0:i.in,t,e),c=(0,s.U)(a,o),u=Math.abs(r(a,o));a.setFullYear(1584),o.setFullYear(1584);const d=c*(u-+((0,s.U)(a,o)===-c));return 0===d?0:d}}}]);
//# sourceMappingURL=37034.951bb91a7894596a.js.map