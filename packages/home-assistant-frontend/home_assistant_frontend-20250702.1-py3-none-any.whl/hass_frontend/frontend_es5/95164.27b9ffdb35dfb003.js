"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["95164"],{9924:function(t,e,a){a.d(e,{t:function(){return c}});var n=a(61943),i=a(54521),s=a(4490),o=(a(40777),a(87622),a(2394),a(13571),a(81738),a(22960),a(21700),a(87799),a(96389),a(24533),a(54480),a(64510),a(67398),function(){return(0,s.Z)(function t(){var e=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.localStorage;(0,i.Z)(this,t),this._storage={},this._listeners={},this.storage=a,this.storage===window.localStorage&&window.addEventListener("storage",function(t){t.key&&e.hasKey(t.key)&&(e._storage[t.key]=t.newValue?JSON.parse(t.newValue):t.newValue,e._listeners[t.key]&&e._listeners[t.key].forEach(function(a){return a(t.oldValue?JSON.parse(t.oldValue):t.oldValue,e._storage[t.key])}))})},[{key:"addFromStorage",value:function(t){if(!this._storage[t]){var e=this.storage.getItem(t);e&&(this._storage[t]=JSON.parse(e))}}},{key:"subscribeChanges",value:function(t,e){var a=this;return this._listeners[t]?this._listeners[t].push(e):this._listeners[t]=[e],function(){a.unsubscribeChanges(t,e)}}},{key:"unsubscribeChanges",value:function(t,e){if(t in this._listeners){var a=this._listeners[t].indexOf(e);-1!==a&&this._listeners[t].splice(a,1)}}},{key:"hasKey",value:function(t){return t in this._storage}},{key:"getValue",value:function(t){return this._storage[t]}},{key:"setValue",value:function(t,e){var a=this._storage[t];this._storage[t]=e;try{void 0===e?this.storage.removeItem(t):this.storage.setItem(t,JSON.stringify(e))}catch(n){}finally{this._listeners[t]&&this._listeners[t].forEach(function(t){return t(a,e)})}}}])}()),r={};function c(t){return function(e,a){if("object"===(0,n.Z)(a))throw new Error("This decorator does not support this compilation type.");var i,s=t.storage||"localStorage";s&&s in r?i=r[s]:(i=new o(window[s]),r[s]=i);var c=t.key||String(a);i.addFromStorage(c);var d=!1!==t.subscribe?function(t){return i.subscribeChanges(c,function(e,n){t.requestUpdate(a,e)})}:void 0,u=function(){return i.hasKey(c)?t.deserializer?t.deserializer(i.getValue(c)):i.getValue(c):void 0},h=function(e,n){var s;t.state&&(s=u()),i.setValue(c,t.serializer?t.serializer(n):n),t.state&&e.requestUpdate(a,s)},l=e.performUpdate;if(e.performUpdate=function(){this.__initialized=!0,l.call(this)},t.subscribe){var _=e.connectedCallback,p=e.disconnectedCallback;e.connectedCallback=function(){_.call(this);this.__unbsubLocalStorage||(this.__unbsubLocalStorage=null==d?void 0:d(this))},e.disconnectedCallback=function(){var t;p.call(this);var e=this;null===(t=e.__unbsubLocalStorage)||void 0===t||t.call(e),e.__unbsubLocalStorage=void 0}}var f,v=Object.getOwnPropertyDescriptor(e,a);if(void 0===v)f={get:function(){return u()},set:function(t){(this.__initialized||void 0===u())&&h(this,t)},configurable:!0,enumerable:!0};else{var m=v.set;f=Object.assign(Object.assign({},v),{},{get:function(){return u()},set:function(t){(this.__initialized||void 0===u())&&h(this,t),null==m||m.call(this,t)}})}Object.defineProperty(e,a,f)}}},99153:function(t,e,a){a.a(t,async function(t,n){try{a.r(e),a.d(e,{HuiEnergyDevicesDetailGraphCard:function(){return B}});var i,s,o,r=a(75706),c=a(42385),d=a(54982),u=a(54521),h=a(4490),l=a(20129),_=a(85297),p=(a(12212),a(25518),a(70021),a(87622),a(24819),a(2394),a(44438),a(18574),a(81738),a(94814),a(29981),a(22960),a(6989),a(93190),a(96821),a(87799),a(24533),a(54480),a(64455),a(6202),a(67398),a(73742)),f=a(26062),v=a(66386),m=a(59048),g=a(7616),y=a(31733),b=a(28105),k=a(55815),S=a(94412),C=(a(31138),a(37008)),w=a(6640),D=a(7214),E=a(6291),Z=a(93647),O=a(94969),z=a(9924),U=a(28598),x=t([C,U,w,O]);[C,U,w,O]=x.then?(await x)():x;var B=function(t){function e(){var t;(0,u.Z)(this,e);for(var a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];return(t=(0,l.Z)(this,e,[].concat(n)))._chartData=[],t._start=(0,f.I)(),t._end=(0,v.p)(),t._hiddenStats=[],t.hassSubscribeRequiredHostProps=["_config"],t._formatTotal=function(e){return t.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.total_consumed",{num:(0,U.uf)(e,t.hass.locale),unit:"kWh"})},t._createOptions=(0,b.Z)(function(e,a,n,i,s,o,r){var c=(0,O.J)(e,a,n,i,s,o,r,t._formatTotal);return Object.assign(Object.assign({},c),{},{legend:{show:!0,type:"custom",data:t._legendData,selected:t._hiddenStats.reduce(function(t,e){return t[e]=!1,t},{})},grid:{top:15,bottom:0,left:1,right:1,containLabel:!0}})}),t}return(0,_.Z)(e,t),(0,h.Z)(e,[{key:"hassSubscribe",value:function(){var t,e=this;return[(0,w.UB)(this.hass,{key:null===(t=this._config)||void 0===t?void 0:t.collection_key}).subscribe(function(t){e._data=t})]}},{key:"getCardSize",value:function(){return 3}},{key:"setConfig",value:function(t){this._config=t}},{key:"shouldUpdate",value:function(t){return(0,Z.SN)(this,t)||t.size>1||!t.has("hass")}},{key:"willUpdate",value:function(t){(t.has("_config")||t.has("_data"))&&this._processStatistics()}},{key:"render",value:function(){return this.hass&&this._config?(0,m.dy)(i||(i=(0,d.Z)([" <ha-card> ",' <div class="content ','"> <ha-chart-base .hass="','" .data="','" .options="','" @dataset-hidden="','" @dataset-unhidden="','"></ha-chart-base> </div> </ha-card> '])),this._config.title?(0,m.dy)(s||(s=(0,d.Z)(['<h1 class="card-header">',"</h1>"])),this._config.title):"",(0,y.$)({"has-header":!!this._config.title}),this.hass,this._chartData,this._createOptions(this._start,this._end,this.hass.locale,this.hass.config,"kWh",this._compareStart,this._compareEnd),this._datasetHidden,this._datasetUnhidden):m.Ld}},{key:"_datasetHidden",value:function(t){this._hiddenStats=[].concat((0,c.Z)(this._hiddenStats),[t.detail.name])}},{key:"_datasetUnhidden",value:function(t){this._hiddenStats=this._hiddenStats.filter(function(e){return e!==t.detail.name})}},{key:"_processStatistics",value:function(){if(this._data){var t=this._data;this._start=t.start,this._end=t.end||(0,v.p)(),this._compareStart=t.startCompare,this._compareEnd=t.endCompare;var e=t.stats,a=t.statsCompare,n=getComputedStyle(this),i=t.prefs.device_consumption,s={};i.forEach(function(t){t.included_in_stat&&(s[t.included_in_stat]=s[t.included_in_stat]||[],s[t.included_in_stat].push(t.stat_consumption))});var o={};t.prefs.device_consumption.forEach(function(t){var a=t.stat_consumption in e&&(0,D.Kj)(e[t.stat_consumption])||0;o[t.stat_consumption]=a});var r={};t.prefs.device_consumption.forEach(function(t){r[t.stat_consumption]=(s[t.stat_consumption]||[]).reduce(function(t,e){return t-o[e]},o[t.stat_consumption])});var d=t.prefs.device_consumption.map(function(t){return t.stat_consumption});d.sort(function(t,e){return r[e]-r[t]});var u=[],h=(0,w.EH)(t),l=h.summedData,_=h.compareSummedData,p="from_grid"in l||"solar"in l||"from_battery"in l,f=p?(0,w.E4)(l,_):{consumption:void 0,compareConsumption:void 0},m=f.consumption,g=f.compareConsumption;if(a){var y=this._processDataSet(n,a,t.statsMetadata,t.prefs.device_consumption,d,s,!0);if(u.push.apply(u,(0,c.Z)(y)),p){var b=this._processUntracked(n,y,g,!0);u.push(b)}}u.push({id:"compare-placeholder",type:"bar",stack:t.statsCompare?"devicesCompare":"devices",data:[]});var k=this._processDataSet(n,e,t.statsMetadata,t.prefs.device_consumption,d,s);if(u.push.apply(u,(0,c.Z)(k)),this._legendData=k.map(function(t){var e;return{name:t.name,itemStyle:{color:t.color,borderColor:null===(e=t.itemStyle)||void 0===e?void 0:e.borderColor}}}),p){var S,C=this._processUntracked(n,k,m,!1);u.push(C),this._legendData.push({name:C.name,itemStyle:{color:C.color,borderColor:null===(S=C.itemStyle)||void 0===S?void 0:S.borderColor}})}(0,O.Zx)(u),this._chartData=u}}},{key:"_processUntracked",value:function(t,e,a,n){var i={};e.forEach(function(t){t.data.forEach(function(t){i[t[n?2:0]]=(i[t[n?2:0]]||0)+t[1]})});var s=(0,O.kT)(this._start,this._compareStart),o=[];Object.keys(a.used_total).sort(function(t,e){return Number(t)-Number(e)}).forEach(function(t){var e=Number(t),r=[e,a.used_total[t]-(i[t]||0)];n&&(r[2]=r[0],r[0]=s(new Date(e)).getTime()),o.push(r)});var r=Date.now();return{type:"bar",cursor:"default",id:n?"compare-untracked-".concat(r):"untracked-".concat(r),name:this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_detail_graph.untracked_consumption"),itemStyle:{borderColor:(0,S.H)(t,this.hass.themes.darkMode,!1,n,"--history-unknown-color")},barMaxWidth:50,color:(0,S.H)(t,this.hass.themes.darkMode,!0,n,"--history-unknown-color"),data:o,stack:n?"devicesCompare":"devices"}}},{key:"_processDataSet",value:function(t,e,a,n,i,s){var o=this,c=arguments.length>6&&void 0!==arguments[6]&&arguments[6],d=[],u=(0,O.kT)(this._start,this._compareStart);return n.forEach(function(n,h){var l,_=i.indexOf(n.stat_consumption);if(null!==(l=o._config)&&void 0!==l&&l.max_devices&&_>=o._config.max_devices)console.warn("Max devices exceeded for ".concat(n.name," (").concat(_," >= ").concat(o._config.max_devices,")"));else{var p=(0,k.hZ)(h,t),f=null,v=[];if(n.stat_consumption in e){var m,g=e[n.stat_consumption],y=(0,r.Z)(g);try{var b=function(){var t=m.value;if(null===t.change||void 0===t.change||0===t.change)return 0;if(f===t.start)return 0;var a=0;(s[n.stat_consumption]||[]).forEach(function(n){var i,s=e[n];a+=(null==s||null===(i=s.find(function(e){return e.start===t.start}))||void 0===i?void 0:i.change)||0});var i=[t.start,t.change-a];c&&(i[2]=i[0],i[0]=u(new Date(t.start)).getTime()),v.push(i),f=t.start};for(y.s();!(m=y.n()).done;)b()}catch(C){y.e(C)}finally{y.f()}}var S=(n.name||(0,D.Kd)(o.hass,n.stat_consumption,a[n.stat_consumption]))+(n.stat_consumption in s?" (".concat(o.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_detail_graph.untracked"),")"):"");d.push({type:"bar",cursor:"default",id:c?"compare-".concat(n.stat_consumption,"-").concat(_):"".concat(n.stat_consumption,"-").concat(_),name:S,itemStyle:{borderColor:c?p+"7F":p},barMaxWidth:50,color:c?p+"32":p+"7F",data:v,stack:c?"devicesCompare":"devices"})}}),i.map(function(t){return d.find(function(e){return o._getStatIdFromId(e.id)===t})}).filter(Boolean)}},{key:"_getStatIdFromId",value:function(t){return t.replace(/^compare-/,"").replace(/-\d+$/,"")}}])}((0,E.f)(m.oi));B.styles=(0,m.iv)(o||(o=(0,d.Z)([".card-header{padding-bottom:0}.content{padding:16px}.has-header{padding-top:0}"]))),(0,p.__decorate)([(0,g.Cb)({attribute:!1})],B.prototype,"hass",void 0),(0,p.__decorate)([(0,g.SB)()],B.prototype,"_config",void 0),(0,p.__decorate)([(0,g.SB)()],B.prototype,"_chartData",void 0),(0,p.__decorate)([(0,g.SB)()],B.prototype,"_data",void 0),(0,p.__decorate)([(0,g.SB)()],B.prototype,"_legendData",void 0),(0,p.__decorate)([(0,g.SB)()],B.prototype,"_start",void 0),(0,p.__decorate)([(0,g.SB)()],B.prototype,"_end",void 0),(0,p.__decorate)([(0,g.SB)()],B.prototype,"_compareStart",void 0),(0,p.__decorate)([(0,g.SB)()],B.prototype,"_compareEnd",void 0),(0,p.__decorate)([(0,g.SB)(),(0,z.t)({key:"energy-devices-hidden-stats",state:!0,subscribe:!1})],B.prototype,"_hiddenStats",void 0),B=(0,p.__decorate)([(0,g.Mo)("hui-energy-devices-detail-graph-card")],B),n()}catch(V){n(V)}})}}]);
//# sourceMappingURL=95164.27b9ffdb35dfb003.js.map