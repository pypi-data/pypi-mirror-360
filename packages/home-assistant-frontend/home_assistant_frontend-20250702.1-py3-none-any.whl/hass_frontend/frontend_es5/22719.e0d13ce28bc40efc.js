"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["22719"],{49639:function(t,e,r){r.a(t,async function(t,a){try{r.r(e),r.d(e,{HuiEnergyUsageGraphCard:function(){return A}});var o,n,s,i,c=r(10354),d=r(29694),u=r(42385),l=r(75706),_=r(75778),h=r(54982),f=r(54521),g=r(4490),p=r(20129),y=r(85297),v=(r(12212),r(39710),r(2394),r(18574),r(81738),r(22960),r(72489),r(87799),r(48454),r(24533),r(54480),r(69920),r(67398),r(73742)),m=r(26062),b=r(66386),k=r(63359),Z=r(59048),S=r(7616),O=r(31733),j=r(28105),C=r(94412),E=r(28598),x=r(37008),z=(r(31138),r(6640)),D=r(7214),w=r(6291),B=r(93647),M=r(94969),H=t([x,E,z,M]);[x,E,z,M]=H.then?(await H)():H;var I={to_grid:"--energy-grid-return-color",to_battery:"--energy-battery-in-color",from_grid:"--energy-grid-consumption-color",used_grid:"--energy-grid-consumption-color",used_solar:"--energy-solar-color",used_battery:"--energy-battery-out-color"},A=function(t){function e(){var t;(0,f.Z)(this,e);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(t=(0,p.Z)(this,e,[].concat(a)))._chartData=[],t._start=(0,m.I)(),t._end=(0,b.p)(),t.hassSubscribeRequiredHostProps=["_config"],t._formatTotal=function(e){return e>0?t.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.total_consumed",{num:(0,E.uf)(e,t.hass.locale)}):t.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.total_returned",{num:(0,E.uf)(-e,t.hass.locale)})},t._createOptions=(0,j.Z)(function(e,r,a,o,n,s){var i=(0,M.J)(e,r,a,o,"kWh",n,s,t._formatTotal);return Object.assign(Object.assign({},i),{},{tooltip:Object.assign(Object.assign({},i.tooltip),{},{formatter:function(t){var e,r;return Array.isArray(t)?(t.sort(function(t,e){var r,a,o=null===(r=t.value)||void 0===r?void 0:r[1],n=null===(a=e.value)||void 0===a?void 0:a[1];return o>0&&n<0?-1:n>0&&o<0?1:o>0?e.componentIndex-t.componentIndex:t.componentIndex-e.componentIndex}),null===(e=i.tooltip)||void 0===e||null===(r=e.formatter)||void 0===r?void 0:r.call(e,t)):""}})})}),t}return(0,y.Z)(e,t),(0,g.Z)(e,[{key:"hassSubscribe",value:function(){var t,e=this;return[(0,z.UB)(this.hass,{key:null===(t=this._config)||void 0===t?void 0:t.collection_key}).subscribe(function(t){return e._getStatistics(t)})]}},{key:"getCardSize",value:function(){return 3}},{key:"setConfig",value:function(t){this._config=t}},{key:"shouldUpdate",value:function(t){return(0,B.SN)(this,t)||t.size>1||!t.has("hass")}},{key:"render",value:function(){return this.hass&&this._config?(0,Z.dy)(o||(o=(0,h.Z)([" <ha-card> ",' <div class="content ','"> <ha-chart-base .hass="','" .data="','" .options="','" chart-type="bar"></ha-chart-base> '," </div> </ha-card> "])),this._config.title?(0,Z.dy)(n||(n=(0,h.Z)(['<h1 class="card-header">',"</h1>"])),this._config.title):"",(0,O.$)({"has-header":!!this._config.title}),this.hass,this._chartData,this._createOptions(this._start,this._end,this.hass.locale,this.hass.config,this._compareStart,this._compareEnd),this._chartData.some(function(t){return t.data.length})?"":(0,Z.dy)(s||(s=(0,h.Z)(['<div class="no-data"> '," </div>"])),(0,k.z)(this._start)?this.hass.localize("ui.panel.lovelace.cards.energy.no_data"):this.hass.localize("ui.panel.lovelace.cards.energy.no_data_period"))):Z.Ld}},{key:"_getStatistics",value:(r=(0,_.Z)((0,d.Z)().m(function t(e){var r,a,o,n,s,i,c,_,h,f,g,p,y,v,m,k,Z,S,O,j,C;return(0,d.Z)().w(function(t){for(;;)switch(t.n){case 0:r=[],a={},o=(0,l.Z)(e.prefs.energy_sources),t.p=1,o.s();case 2:if((n=o.n()).done){t.n=7;break}if("solar"!==(s=n.value).type){t.n=3;break}return a.solar?a.solar.push(s.stat_energy_from):a.solar=[s.stat_energy_from],t.a(3,6);case 3:if("battery"!==s.type){t.n=4;break}return a.to_battery?(a.to_battery.push(s.stat_energy_to),a.from_battery.push(s.stat_energy_from)):(a.to_battery=[s.stat_energy_to],a.from_battery=[s.stat_energy_from]),t.a(3,6);case 4:if("grid"===s.type){t.n=5;break}return t.a(3,6);case 5:i=(0,l.Z)(s.flow_from);try{for(i.s();!(c=i.n()).done;)_=c.value,a.from_grid?a.from_grid.push(_.stat_energy_from):a.from_grid=[_.stat_energy_from]}catch(d){i.e(d)}finally{i.f()}h=(0,l.Z)(s.flow_to);try{for(h.s();!(f=h.n()).done;)g=f.value,a.to_grid?a.to_grid.push(g.stat_energy_to):a.to_grid=[g.stat_energy_to]}catch(d){h.e(d)}finally{h.f()}case 6:t.n=2;break;case 7:t.n=9;break;case 8:t.p=8,C=t.v,o.e(C);case 9:return t.p=9,o.f(),t.f(9);case 10:p=getComputedStyle(this),y={},Object.keys(I).forEach(function(t){y[t]={},"used_grid"!==t&&"used_solar"!==t&&"used_battery"!==t&&a[t]&&Object.values(a[t]).forEach(function(e,r){y[t][e]=r})}),v={used_grid:this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.combined_from_grid"),used_solar:this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.consumed_solar"),used_battery:this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.consumed_battery")},this._start=e.start,this._end=e.end||(0,b.p)(),this._compareStart=e.startCompare,this._compareEnd=e.endCompare,m=(0,z.EH)(e),k=m.summedData,Z=m.compareSummedData,S=(0,z.E4)(k,Z),O=S.consumption,j=S.compareConsumption,e.statsCompare&&r.push.apply(r,(0,u.Z)(this._processDataSet(e.statsCompare,e.statsMetadata,Z,j,a,y,p,v,!0))),r.push({id:"compare-placeholder",type:"bar",stack:e.statsCompare?"compare":"usage",data:[],order:0}),r.push.apply(r,(0,u.Z)(this._processDataSet(e.stats,e.statsMetadata,k,O,a,y,p,v,!1))),r.sort(function(t,e){return t.order-e.order}),(0,M.Zx)(r),this._chartData=r;case 11:return t.a(2)}},t,this,[[1,8,9,10]])})),function(t){return r.apply(this,arguments)})},{key:"_processDataSet",value:function(t,e,r,a,o,n,s,i){var d=this,u=arguments.length>8&&void 0!==arguments[8]&&arguments[8],_=[],h={};if(Object.entries(o).forEach(function(e){var r=(0,c.Z)(e,2),a=r[0],o=r[1];if(["to_grid","from_grid","to_battery"].includes(a)){var n={};o.forEach(function(e){var r=t[e];if(r){var a={};r.forEach(function(t){if(null!==t.change&&void 0!==t.change){var e=t.change;t.start in a||(a[t.start]=e)}}),n[e]=a}}),h[a]=n}}),h.used_solar={used_solar:a.used_solar},h.used_battery={used_battery:a.used_battery},h.from_grid&&r.to_battery){for(var f={},g=function(){var t=(0,c.Z)(y[p],2),e=t[0];if(!t[1])return 1;for(var r,o=0,n=0,s=Object.entries(h.from_grid);n<s.length;n++){var i=(0,c.Z)(s[n],2),d=i[0];if(i[1][e]&&(r=d,o++),o>1)break}1===o?h.from_grid[r][e]=a.used_grid[e]:(Object.values(h.from_grid).forEach(function(t){delete t[e]}),f[e]=a.used_grid[e])},p=0,y=Object.entries(a.grid_to_battery);p<y.length;p++)g();h.used_grid={used_grid:f}}var v=r.timestamps,m=(0,M.kT)(this._start,this._compareStart);return Object.entries(h).forEach(function(t,r){var a=(0,c.Z)(t,2),o=a[0],f=a[1];Object.entries(f).forEach(function(t){var a,f,g,p=(0,c.Z)(t,2),y=p[0],b=p[1],k=[],Z=(0,l.Z)(v);try{for(Z.s();!(g=Z.n()).done;){var S=g.value,O=b[S]||0,j=[new Date(S),O&&["to_grid","to_battery"].includes(o)?-1*O:O];u&&(j[2]=j[0],j[0]=m(j[0])),k.push(j)}}catch(E){Z.e(E)}finally{Z.f()}_.push({id:"".concat(u?"compare-":"").concat(y,"-").concat(o),type:"bar",cursor:"default",name:o in i?i[o]:(0,D.Kd)(d.hass,y,e[y]),order:"used_solar"===o?1:"to_battery"===o?Object.keys(h).length:r+2,barMaxWidth:50,itemStyle:{borderColor:(0,C.H)(s,d.hass.themes.darkMode,!1,u,I[o],null===(a=n[o])||void 0===a?void 0:a[y])},color:(0,C.H)(s,d.hass.themes.darkMode,!0,u,I[o],null===(f=n[o])||void 0===f?void 0:f[y]),stack:u?"compare":"usage",data:k})})}),_}}]);var r}((0,w.f)(Z.oi));A.styles=(0,Z.iv)(i||(i=(0,h.Z)(["ha-card{height:100%}.card-header{padding-bottom:0}.content{padding:16px}.has-header{padding-top:0}.no-data{position:absolute;height:100%;top:0;left:0;right:0;display:flex;justify-content:center;align-items:center;padding:20%;margin-left:32px;margin-inline-start:32px;margin-inline-end:initial;box-sizing:border-box}"]))),(0,v.__decorate)([(0,S.Cb)({attribute:!1})],A.prototype,"hass",void 0),(0,v.__decorate)([(0,S.SB)()],A.prototype,"_config",void 0),(0,v.__decorate)([(0,S.SB)()],A.prototype,"_chartData",void 0),(0,v.__decorate)([(0,S.SB)()],A.prototype,"_start",void 0),(0,v.__decorate)([(0,S.SB)()],A.prototype,"_end",void 0),(0,v.__decorate)([(0,S.SB)()],A.prototype,"_compareStart",void 0),(0,v.__decorate)([(0,S.SB)()],A.prototype,"_compareEnd",void 0),A=(0,v.__decorate)([(0,S.Mo)("hui-energy-usage-graph-card")],A),a()}catch(K){a(K)}})},93859:function(t,e,r){r.d(e,{y:function(){return o}});var a=r(70323);function o(t){return(0,a.L)(t,Date.now())}},31007:function(t,e,r){r.d(e,{K:function(){return n}});r(26847),r(27530);var a=r(69875),o=r(46021);function n(t,e,r){const[n,s]=(0,a.d)(null==r?void 0:r.in,t,e);return+(0,o.b)(n)===+(0,o.b)(s)}},63359:function(t,e,r){r.d(e,{z:function(){return s}});var a=r(70323),o=r(93859),n=r(31007);function s(t,e){return(0,n.K)((0,a.L)((null==e?void 0:e.in)||t,t),(0,o.y)((null==e?void 0:e.in)||t))}}}]);
//# sourceMappingURL=22719.e0d13ce28bc40efc.js.map