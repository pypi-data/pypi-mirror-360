"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["65738"],{89166:function(t,e,n){n.a(t,async function(t,i){try{n.d(e,{Nu:function(){return S},V3:function(){return E},Vk:function(){return y},YA:function(){return k},xS:function(){return g},zP:function(){return Z}});var s=n(42385),a=n(10354),r=n(75706),u=n(54521),o=n(4490),c=(n(12212),n(25518),n(70021),n(39710),n(26847),n(24819),n(2394),n(18574),n(73042),n(81738),n(94814),n(29981),n(22960),n(6989),n(72489),n(87799),n(48454),n(24533),n(54480),n(69920),n(56303),n(11353),n(67886),n(65451),n(46015),n(38334),n(94880),n(75643),n(29761),n(56389),n(48694),n(67398),n(27530),n(44272)),l=n(10388),f=n(15459),d=t([l]);l=(d.then?(await d)():d)[0];var h=["climate","humidifier","water_heater"],v=["climate","humidifier","input_datetime","water_heater","person","device_tracker"],m=["temperature","current_temperature","target_temp_low","target_temp_high","hvac_action","humidity","mode","action","current_humidity"],_=function(t,e){return!t.states[e]||v.includes((0,c.M)(e))},y=function(t,e,n,i,s){var a={type:"history/stream",entity_ids:s,start_time:n.toISOString(),end_time:i.toISOString(),minimal_response:!0,no_attributes:!s.some(function(e){return _(t,e)})},r=new b(t);return t.connection.subscribeMessage(function(t){return e(r.processMessage(t))},a)},b=function(){return(0,o.Z)(function t(e,n){(0,u.Z)(this,t),this.hass=e,this.hoursToShow=n,this.combinedHistory={}},[{key:"processMessage",value:function(t){if(!this.combinedHistory||!Object.keys(this.combinedHistory).length)return this.combinedHistory=t.states,this.combinedHistory;if(!Object.keys(t.states).length)return this.combinedHistory;for(var e=this.hoursToShow?((new Date).getTime()-3600*this.hoursToShow*1e3)/1e3:void 0,n={},i=0,s=Object.keys(this.combinedHistory);i<s.length;i++){n[s[i]]=[]}for(var a=0,r=Object.keys(t.states);a<r.length;a++){n[r[a]]=[]}for(var u=0,o=Object.keys(n);u<o.length;u++){var c=o[u];if(c in this.combinedHistory&&c in t.states){var l=this.combinedHistory[c],f=l[l.length-1];n[c]=l.concat(t.states[c]),t.states[c][0].lu<f.lu&&(n[c]=n[c].sort(function(t,e){return t.lu-e.lu}))}else c in this.combinedHistory?n[c]=this.combinedHistory[c]:n[c]=t.states[c];if(e&&c in this.combinedHistory){var d=n[c].filter(function(t){return t.lu<e});if(!d.length)continue;if(n[c]=n[c].filter(function(t){return t.lu>=e}),n[c].length&&n[c][0].lu===e)continue;var h=d[d.length-1];h.lu=e,n[c].unshift(h)}}return this.combinedHistory=n,this.combinedHistory}}])}(),g=function(t,e,n,i,s){var a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],r=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],u={type:"history/stream",entity_ids:i,start_time:new Date((new Date).getTime()-3600*n*1e3).toISOString(),minimal_response:a,significant_changes_only:r,no_attributes:null!=s?s:!i.some(function(e){return _(t,e)})},o=new b(t,n);return t.connection.subscribeMessage(function(t){return e(o.processMessage(t))},u)},p=function(t,e){return t.state===e.state&&(!t.attributes||!e.attributes||m.every(function(n){return t.attributes[n]===e.attributes[n]}))},O=["counter","input_number","number"],j=function(t){return O.includes(t)},w=function(t){return"unit_of_measurement"in t||"state_class"in t},k=function(t,e,n,i){var s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r={};n.forEach(function(t){t in e&&(r[t]=e[t])});var u={};Object.entries(r).forEach(function(t){var e=(0,a.Z)(t,2),n=e[0],i=e[1].map(function(t){return{s:null!=t.mean?t.mean.toString():t.state.toString(),lc:t.start/1e3,a:{},lu:t.start/1e3}});u[n]=i});var o=S(t,u,[],t.localize,i,s,!0);return((null==o?void 0:o.line)||[]).forEach(function(t){t.data.forEach(function(t){t.statistics=t.states,t.states=[]})}),o},S=function(t,e,n,i,a){var u=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],d={},v=[],_={};return new Set([].concat((0,s.Z)(n),(0,s.Z)(Object.keys(e)))).forEach(function(n){n in e?_[n]=e[n]:t.states[n]&&(_[n]=[{s:t.states[n].state,a:t.states[n].attributes,lu:new Date(t.states[n].last_updated).getTime()/1e3}])}),_?(Object.keys(_).forEach(function(e){var n,h=_[e];if(0!==h.length){var m,y=(0,c.M)(e),b=e in t.states?t.states[e]:void 0,g=b||j(y)?void 0:h.find(function(t){return t.a&&w(t.a)});m=Z(y,b,g,a,o)?(null==b?void 0:b.attributes.unit_of_measurement)||(null==g?void 0:g.a.unit_of_measurement)||" ":{zone:i("ui.dialogs.more_info_control.zone.graph_unit"),climate:t.config.unit_system.temperature,humidifier:"%",water_heater:t.config.unit_system.temperature}[y];var p={climate:"temperature",humidifier:"humidity",water_heater:"temperature"}[y]||(null===(n=(null==b?void 0:b.attributes)||(null==g?void 0:g.a))||void 0===n?void 0:n.device_class),O=H(m,p,u);if(m)if(O&&O in d&&e in d[O]){var k;(k=d[O][e]).push.apply(k,(0,s.Z)(h))}else O&&(O in d||(d[O]={}),d[O][e]=h);else v.push(function(t,e,n,i,s,a,u){var o,c=[],d=a[0],h=(0,r.Z)(a);try{for(h.s();!(o=h.n()).done;){var v=o.value;if(!(c.length>0&&v.s===c[c.length-1].state)){var m={};null!=u&&u.attributes.device_class&&(m.device_class=null==u?void 0:u.attributes.device_class),c.push({state_localize:(0,l.computeStateDisplayFromEntityAttributes)(t,e,[],n,i[s],s,Object.assign(Object.assign({},v.a||d.a),m),v.s),state:v.s,last_changed:1e3*(v.lc?v.lc:v.lu)})}}}catch(_){h.e(_)}finally{h.f()}return{name:(0,f.a)(s,(null==u?void 0:u.attributes)||d.a),entity_id:s,data:c}}(i,t.locale,t.config,t.entities,e,h,b))}}),{line:Object.keys(d).map(function(e){var n=e.split("_");return function(t,e,n,i){var s=[];return Object.keys(n).forEach(function(t){var e,a=n[t],u=a[0],o=(0,c.M)(t),l=[],d=(0,r.Z)(a);try{for(d.s();!(e=d.n()).done;){var v=e.value,_=void 0;if(h.includes(o)){_={state:v.s,last_changed:1e3*v.lu,attributes:{}};for(var y=0,b=m;y<b.length;y++){var g=b[y];g in v.a&&(_.attributes[g]=v.a[g])}}else _={state:v.s,last_changed:1e3*(v.lc?v.lc:v.lu),attributes:{}};l.length>1&&p(_,l[l.length-1])&&p(_,l[l.length-2])||l.push(_)}}catch(j){d.e(j)}finally{d.f()}var O=t in i?i[t].attributes:"friendly_name"in u.a?u.a:void 0;s.push({domain:o,name:(0,f.a)(t,O||{}),entity_id:t,states:l})}),{unit:t,device_class:e,identifier:Object.keys(n).join(""),data:s}}(n[0],n[1]||void 0,d[e],t.states)}),timeline:v}):{line:[],timeline:[]}},H=function(t,e,n){return n?"".concat(t,"_").concat(e||""):t},Z=function(t,e,n,i){return arguments.length>4&&void 0!==arguments[4]&&arguments[4]||j(t)||null!=e&&w(e.attributes)||null!=e&&"sensor"===t&&function(t,e){return null!=t.attributes.device_class&&e.includes(t.attributes.device_class)}(e,i)||null!=n},E=function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!e)return t;var i,a=Object.assign(Object.assign({},t),{},{line:[]}),u={},o=(0,r.Z)(t.line);try{for(o.s();!(i=o.n()).done;){var c=i.value,l=H(c.unit,c.device_class,n);l&&(u[l]={historyItem:c})}}catch(k){o.e(k)}finally{o.f()}var f,d=(0,r.Z)(e.line);try{var h=function(){var e,i,s=f.value;" "===s.unit&&(s.unit=null!==(e=null===(i=t.line.find(function(t){return t.identifier===s.identifier}))||void 0===i?void 0:i.unit)&&void 0!==e?e:" ");var a=H(s.unit,s.device_class,n);if(!a)return 1;a in u?u[a].ltsItem=s:u[a]={ltsItem:s}};for(d.s();!(f=d.n()).done;)h()}catch(k){d.e(k)}finally{d.f()}for(var v=0,m=Object.values(u);v<m.length;v++){var _=m[v],y=_.historyItem,b=_.ltsItem;if(y&&b){var g,p=Object.assign(Object.assign({},y),{},{data:[]}),O=new Set([].concat((0,s.Z)(y.data.map(function(t){return t.entity_id})),(0,s.Z)(b.data.map(function(t){return t.entity_id})))),j=(0,r.Z)(O);try{var w=function(){var t,e=g.value,n=y.data.find(function(t){return t.entity_id===e}),i=b.data.find(function(t){return t.entity_id===e});if(!n||!i)return p.data.push(n||i),1;var s,a=(null===(t=n.states[0])||void 0===t?void 0:t.last_changed)||i.statistics[i.statistics.length-1].last_changed+1,u=[],o=(0,r.Z)(i.statistics);try{for(o.s();!(s=o.n()).done;){var c=s.value;if(c.last_changed>=a)break;u.push(c)}}catch(k){o.e(k)}finally{o.f()}p.data.push(0===u.length?n:Object.assign(Object.assign({},n),{},{statistics:u}))};for(j.s();!(g=j.n()).done;)w()}catch(k){j.e(k)}finally{j.f()}a.line.push(p)}else a.line.push(y||b)}return a};i()}catch(I){i(I)}})}}]);
//# sourceMappingURL=65738.e10c00925b84bb6a.js.map