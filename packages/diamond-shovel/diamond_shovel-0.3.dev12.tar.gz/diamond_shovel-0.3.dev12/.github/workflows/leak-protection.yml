name: "leak-protection"

on:
  push:
    branches:
      - 'com/*'

jobs:
  delete:
    runs-on: ubuntu-latest
    steps:
      - name: "Delete leaked branches"
        uses: actions/checkout@v4
        permissions:
          contents: write
          pull-requests: write
        with:
          ref: 'refs/remotes/origin/com/*'
        run: |
          git branch -r | grep 'origin/com/' | cut -d'/' -f3 | xargs -I {} curl -X DELETE -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" https://api.github.com/repos/$GITHUB_REPOSITORY/git/refs/heads/{}
