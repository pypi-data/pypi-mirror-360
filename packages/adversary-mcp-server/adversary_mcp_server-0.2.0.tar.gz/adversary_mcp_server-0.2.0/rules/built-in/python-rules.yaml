# Built-in Python Security Rules
# These rules detect common security vulnerabilities in Python code

rules:
  - id: "python_sql_injection"
    name: "SQL Injection"
    description: "Direct string concatenation in SQL queries"
    category: "injection"
    severity: "high"
    languages: ["python"]
    
    conditions:
      - type: "pattern"
        value: "cursor\\.execute\\(.*\\+.*\\)"
      - type: "pattern"
        value: "cursor\\.execute\\(.*%.*\\)"
      - type: "pattern"
        value: ".*=.*['\"].*\\+.*['\"].*"
    
    exploit_templates:
      - type: "payload"
        template: "' OR '1'='1' --"
        description: "Basic SQL injection payload"
    
    remediation: "Use parameterized queries or prepared statements"
    references:
      - "https://owasp.org/Top10/A03_2021-Injection/"
    cwe_id: "CWE-89"
    owasp_category: "A03:2021 - Injection"

  - id: "python_command_injection"
    name: "Command Injection"
    description: "User input passed to shell commands"
    category: "injection"
    severity: "critical"
    languages: ["python"]
    
    conditions:
      - type: "function_call"
        value: ["os.system", "subprocess.call", "subprocess.run", "os.popen"]
    
    exploit_templates:
      - type: "payload"
        template: "; cat /etc/passwd"
        description: "Command injection to read sensitive files"
    
    remediation: "Use subprocess with shell=False and validate input"
    references:
      - "https://owasp.org/Top10/A03_2021-Injection/"
    cwe_id: "CWE-78"

  - id: "python_pickle_deserialize"
    name: "Unsafe Pickle Deserialization"
    description: "Pickle deserialization of untrusted data"
    category: "deserialization"
    severity: "critical"
    languages: ["python"]
    
    conditions:
      - type: "function_call"
        value: ["pickle.loads", "pickle.load", "cPickle.loads", "cPickle.load"]
    
    exploit_templates:
      - type: "python"
        template: "import pickle; pickle.loads(b'cos\\nsystem\\n(S\\'whoami\\'\\ntR.')"
        description: "Pickle payload for command execution"
    
    remediation: "Use safe serialization formats like JSON"
    references:
      - "https://docs.python.org/3/library/pickle.html#restriction"
    cwe_id: "CWE-502" 