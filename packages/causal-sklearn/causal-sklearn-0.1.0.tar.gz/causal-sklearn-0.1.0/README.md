# Causal-Sklearn - åŸºäºCausalEngineâ„¢æ ¸å¿ƒçš„å› æœå›å½’å’Œåˆ†ç±»

åŸºäºçªç ´æ€§CausalEngineâ„¢ç®—æ³•çš„scikit-learnå…¼å®¹å®ç° - å°†å› æœæ¨ç†å¸¦å…¥ä¼ ç»Ÿæœºå™¨å­¦ä¹ ç”Ÿæ€ç³»ç»Ÿã€‚

## æ ¸å¿ƒæ¦‚å¿µ

**ä¼ ç»Ÿæœºå™¨å­¦ä¹ **: ä»å¯è§‚æµ‹ä¸ªä½“ç‰¹å¾åˆ°ç»“æœçš„æ˜ å°„(from observable individual fetures to outcome)
- å›å½’: X â†’ Y (æ•°å€¼ç»“æœ)  
- åˆ†ç±»: X â†’ Y (ç±»åˆ«ç»“æœ)

**å› æœæœºå™¨å­¦ä¹ **: ä»ä¸å¯è§‚æµ‹ä¸ªä½“å› æœè¡¨ç¤ºåˆ°ç»“æœçš„æ¨ç†(from unobservable individual causal representation to outcome)
- å› æœå›å½’: U â†’ Y (æ•°å€¼ç»“æœ)
- å› æœåˆ†ç±»: U â†’ Y (ç±»åˆ«ç»“æœ)

æ•°å­¦æœ¬è´¨: CausalEngine å­¦ä¹ ç»“æ„æ–¹ç¨‹ **Y = f(U, Îµ)** è€Œéå­¦ä¹ æ¡ä»¶æœŸæœ› **E[Y|X]**. 

## é¡¹ç›®æ¦‚è¿°

Causal-Sklearnå°†å¼ºå¤§çš„å› æœæ¨ç†èƒ½åŠ›å¼•å…¥åˆ°ç†Ÿæ‚‰çš„scikit-learnç”Ÿæ€ç³»ç»Ÿä¸­ã€‚åŸºäºé©å‘½æ€§çš„CausalEngineâ„¢ç®—æ³•æ„å»ºï¼Œå®ƒæä¾›äº†ä¼ ç»ŸMLä¼°è®¡å™¨çš„ç›´æ¥æ›¿ä»£å“ï¼Œèƒ½å¤Ÿç†è§£å› æœå…³ç³»è€Œä¸ä»…ä»…æ˜¯ç›¸å…³æ€§ã€‚

### ğŸ¯ æ ¸å¿ƒçªç ´
- **å› æœvsç›¸å…³**: è¶…è¶Šä¼ ç»Ÿæ¨¡å¼åŒ¹é…ï¼Œå®ç°çœŸæ­£çš„å› æœå…³ç³»ç†è§£
- **é²æ£’æ€§ä¼˜åŠ¿**: åœ¨å™ªå£°å’Œå¼‚å¸¸å€¼å­˜åœ¨æ—¶è¡¨ç°å‡ºè‰²ï¼Œè¿œè¶…ä¼ ç»Ÿæ–¹æ³•
- **æ•°å­¦åˆ›æ–°**: ä»¥æŸ¯è¥¿åˆ†å¸ƒä¸ºæ ¸å¿ƒçš„å…¨æ–°æ•°å­¦æ¡†æ¶
- **sklearnå…¼å®¹**: å®Œç¾èå…¥ç°æœ‰MLå·¥ä½œæµï¼Œæ— éœ€æ”¹å˜ä½¿ç”¨ä¹ æƒ¯

## ğŸŒŸ æ ¸å¿ƒç‰¹æ€§

- **ğŸ”§ Scikit-learnå…¼å®¹**: å®Œå…¨å…¼å®¹sklearnæ¥å£ï¼Œå¯ç›´æ¥æ›¿æ¢`MLPRegressor`å’Œ`MLPClassifier`
- **ğŸ§  å› æœæ¨ç†**: è¶…è¶Šæ¨¡å¼åŒ¹é…ï¼Œç†è§£æ•°æ®èƒŒåçš„å› æœå…³ç³»
- **ğŸ›¡ï¸ é²æ£’æ€§å“è¶Š**: åœ¨æ ‡ç­¾å™ªå£°å’Œå¼‚å¸¸å€¼ç¯å¢ƒä¸‹æ€§èƒ½è¿œè¶…ä¼ ç»Ÿæ–¹æ³•
- **ğŸ“Š åˆ†å¸ƒé¢„æµ‹**: æä¾›å®Œæ•´çš„åˆ†å¸ƒè¾“å‡ºï¼Œè€Œéä»…ç‚¹ä¼°è®¡
- **âš™ï¸ å¤šæ¨¡å¼æ¨ç†**: æ”¯æŒdeterministicã€standardã€samplingç­‰å¤šç§æ¨ç†æ¨¡å¼
- **ğŸ¯ çœŸå®ä¸–ç•ŒéªŒè¯**: åœ¨åŠ å·æˆ¿ä»·ç­‰çœŸå®æ•°æ®é›†ä¸Šå±•ç°æ˜¾è‘—ä¼˜åŠ¿

## ğŸ“Š å®éªŒç»“æœäº®ç‚¹

æˆ‘ä»¬åœ¨ `quick_test_causal_engine.py` è„šæœ¬ä¸­è¿›è¡Œäº†ä¸¥æ ¼çš„åŸºå‡†æµ‹è¯•ã€‚ç»“æœæ˜ç¡®å±•ç¤ºäº† CausalEngine çš„ `standard` æ¨¡å¼åœ¨å«å™ªæ•°æ®ä¸‹çš„å“è¶Šæ€§èƒ½ï¼Œè€Œ `deterministic` æ¨¡å¼ä½œä¸ºå› æœæ¨¡å‹çš„åŸºçº¿ï¼Œå…¶è¡¨ç°ä¸ä¼ ç»ŸMLPç›¸ä¼¼ã€‚

### å›å½’ä»»åŠ¡ (30% æ ‡ç­¾å™ªå£°)

åœ¨å›å½’ä»»åŠ¡ä¸­ï¼ŒCausalEngine çš„ `standard` æ¨¡å¼å±•ç°å‡ºå‹å€’æ€§ä¼˜åŠ¿ï¼Œå„é¡¹è¯¯å·®æŒ‡æ ‡å‡è¿œä¼˜äºä¼ ç»Ÿæ–¹æ³•ã€‚

| æ–¹æ³•                       | MAE (â†“) | MdAE (â†“) | RMSE (â†“) | RÂ² (â†‘) |
| :------------------------- | :------ | :------- | :------- | :----- |
| sklearn                    | 47.60   | 39.28    | 59.87    | 0.8972 |
| pytorch                    | 59.70   | 47.25    | 77.36    | 0.8284 |
| Causal (deterministic)     | 58.55   | 45.20    | 78.12    | 0.8249 |
| **Causal (standard)**      | **11.41** | **10.22** | **13.65** | **0.9947** |

*`standard` æ¨¡å¼é€šè¿‡å…¶ç‹¬ç‰¹çš„å› æœæ¨ç†æœºåˆ¶ï¼Œåœ¨å™ªå£°ç¯å¢ƒä¸‹å®ç°äº†æ€§èƒ½çš„é£è·ƒï¼Œè¯æ˜äº†å…¶å“è¶Šçš„é²æ£’æ€§ã€‚*

### åˆ†ç±»ä»»åŠ¡ (30% æ ‡ç­¾å™ªå£°)

åœ¨3åˆ†ç±»ä»»åŠ¡ä¸­ï¼Œ`CausalClassifier (standard)` æ¨¡å¼åœ¨æ‰€æœ‰å…³é”®æŒ‡æ ‡ä¸Šå‡è¾¾åˆ°æœ€ä½³è¡¨ç°ï¼Œæ˜¾è‘—ä¼˜äºæ‰€æœ‰åŸºçº¿æ¨¡å‹ã€‚

| æ–¹æ³•                       | Accuracy (â†‘) | Precision (â†‘) | Recall (â†‘) | F1-Score (â†‘) |
| :------------------------- | :----------- | :------------ | :--------- | :----------- |
| sklearn                    | 0.8850       | 0.8847        | 0.8850     | 0.8848       |
| pytorch                    | 0.8950       | 0.8952        | 0.8950     | 0.8951       |
| sklearn_ovr                | 0.8975       | 0.8987        | 0.8974     | 0.8974       |
| Causal (deterministic)     | 0.8888       | 0.8935        | 0.8890     | 0.8884       |
| **Causal (standard)**      | **0.9225**   | **0.9224**    | **0.9225** | **0.9224**   |

*è¿™å†æ¬¡è¯æ˜äº† CausalEngine çš„ `standard` æ¨¡å¼ä¸ä»…åœ¨å›å½’ä¸­è¡¨ç°ä¼˜å¼‚ï¼Œåœ¨åˆ†ç±»ä»»åŠ¡ä¸­åŒæ ·å…·æœ‰å¤„ç†æ ‡ç­¾å™ªå£°çš„é¢†å…ˆä¼˜åŠ¿ã€‚*

## å®‰è£…

### é€šè¿‡ PyPI å®‰è£…ï¼ˆæ¨èï¼‰

```bash
pip install causal-sklearn
```

### ä»æºä»£ç å®‰è£…

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/1587causalai/causal-sklearn.git
cd causal-sklearn

# å®‰è£…ä¾èµ–å¹¶å®‰è£…åŒ…
pip install -e .
```

### ç³»ç»Ÿè¦æ±‚

- **Python**: >= 3.8
- **æ ¸å¿ƒä¾èµ–**: 
  - numpy >= 1.21.0
  - scipy >= 1.7.0  
  - scikit-learn >= 1.0.0
  - torch >= 1.10.0
  - pandas >= 1.3.0

### éªŒè¯å®‰è£…

```python
import causal_sklearn
print(f"Causal-sklearn version: {causal_sklearn.__version__}")
print("å®‰è£…æˆåŠŸï¼ğŸ‰")
```

## å¿«é€Ÿå¼€å§‹

### åŸºç¡€ä½¿ç”¨ç¤ºä¾‹

```python
from causal_sklearn import MLPCausalRegressor, MLPCausalClassifier
from sklearn.datasets import make_regression, make_classification
from sklearn.model_selection import train_test_split

# å›å½’ç¤ºä¾‹
X, y = make_regression(n_samples=1000, n_features=20, noise=0.1)
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2)

regressor = MLPCausalRegressor(mode='standard', random_state=42)
regressor.fit(X_train, y_train)
predictions = regressor.predict(X_test)
distributions = regressor.predict_dist(X_test) # è¿”å›å®Œæ•´çš„Cauchyåˆ†å¸ƒå‚æ•°

# åˆ†ç±»ç¤ºä¾‹
X, y = make_classification(n_samples=1000, n_features=20, n_classes=3)
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2)

classifier = MLPCausalClassifier(mode='standard', random_state=42)
classifier.fit(X_train, y_train)
predictions = classifier.predict(X_test)
probabilities = classifier.predict_proba(X_test)
```

### ğŸš€ å¿«é€ŸéªŒè¯æµ‹è¯•

è¿è¡Œå¿«é€Ÿæµ‹è¯•è„šæœ¬ï¼ŒåŒæ—¶éªŒè¯å›å½’å’Œåˆ†ç±»æ€§èƒ½ï¼š

```bash
# è¿è¡Œå®Œæ•´çš„å¿«é€Ÿæµ‹è¯•ï¼ˆå›å½’+åˆ†ç±»ï¼‰
python scripts/quick_test_causal_engine.py

# è¿™ä¸ªè„šæœ¬å°†ï¼š
# 1. ç”Ÿæˆåˆæˆæ•°æ®ï¼ˆå›å½’ï¼š4000æ ·æœ¬Ã—12ç‰¹å¾ï¼Œåˆ†ç±»ï¼š4000æ ·æœ¬Ã—10ç‰¹å¾Ã—3ç±»ï¼‰
# 2. åœ¨30%å™ªå£°ä¸‹æ¯”è¾ƒ8ç§æ–¹æ³•æ€§èƒ½
# 3. ç»Ÿä¸€æ ‡å‡†åŒ–ç­–ç•¥ç¡®ä¿å…¬å¹³æ¯”è¾ƒ
# 4. ç”Ÿæˆå®Œæ•´çš„æ€§èƒ½åˆ†ææŠ¥å‘Šå’Œå¯è§†åŒ–å›¾è¡¨
```

**å¿«é€Ÿæµ‹è¯•äº®ç‚¹**ï¼š
- âš¡ å¿«é€ŸéªŒè¯ï¼šå‡ åˆ†é’Ÿå†…å®Œæˆå…¨é¢æµ‹è¯•
- ğŸ”„ åŒä»»åŠ¡æ”¯æŒï¼šåŒæ—¶æµ‹è¯•å›å½’å’Œåˆ†ç±»èƒ½åŠ›
- ğŸ¯ 8ç§æ–¹æ³•å¯¹æ¯”ï¼šsklearn/PyTorchåŸºçº¿ + CausalEngineå››ç§æ¨¡å¼
- ğŸ“Š ç§‘å­¦å®éªŒè®¾è®¡ï¼šæ— æ•°æ®æ³„éœ²çš„æ ‡å‡†åŒ–ç­–ç•¥
- ğŸ›¡ï¸ å™ªå£°é²æ£’æ€§ï¼šåœ¨30%å™ªå£°ç¯å¢ƒä¸‹éªŒè¯ä¼˜åŠ¿

### ğŸ  çœŸå®ä¸–ç•Œæ•™ç¨‹ - åŠ å·æˆ¿ä»·é¢„æµ‹

è¿è¡Œå®Œæ•´çš„çœŸå®ä¸–ç•Œå›å½’æ•™ç¨‹ï¼Œå±•ç¤ºCausalEngineçš„å¼ºå¤§æ€§èƒ½ï¼š

```bash
# è¿è¡ŒçœŸå®ä¸–ç•Œå›å½’æ•™ç¨‹ï¼ˆsklearn-styleç‰ˆæœ¬ï¼‰
python examples/comprehensive_causal_modes_tutorial_sklearn_style.py

# è¿™ä¸ªæ•™ç¨‹å°†ï¼š
# 1. åŠ è½½åŠ å·æˆ¿ä»·æ•°æ®é›†ï¼ˆ20,640ä¸ªæ ·æœ¬ï¼‰
# 2. åœ¨30%æ ‡ç­¾å™ªå£°ä¸‹æ¯”è¾ƒ13ç§æ–¹æ³•
# 3. æµ‹è¯•CausalEngineæ‰€æœ‰4ç§æ¨ç†æ¨¡å¼
# 4. ç”Ÿæˆæ ‡å‡†ç‰ˆå’Œæ‰©å±•ç‰ˆæ€§èƒ½å¯¹æ¯”å›¾è¡¨
```

**çœŸå®ä¸–ç•Œæ•™ç¨‹äº®ç‚¹**ï¼š
- ğŸŒ çœŸå®æ•°æ®ï¼šåŠ å·æˆ¿ä»·æ•°æ®é›†çš„å®Œæ•´åˆ†æ
- ğŸ”¬ å…¨é¢å¯¹æ¯”ï¼š13ç§æ–¹æ³•ï¼ˆä¼ ç»ŸML + ç¨³å¥å›å½’ + CausalEngineå››æ¨¡å¼ï¼‰
- ğŸ“Š åŒé‡å¯è§†åŒ–ï¼šæ ‡å‡†ç‰ˆï¼ˆ9ç§æ ¸å¿ƒæ–¹æ³•ï¼‰+ æ‰©å±•ç‰ˆï¼ˆ13ç§å…¨æ–¹æ³•ï¼‰
- ğŸ¯ CausalEngineä¸“é¡¹ï¼šå››ç§æ¨ç†æ¨¡å¼çš„æ·±åº¦å¯¹æ¯”åˆ†æ
- ğŸ›¡ï¸ é²æ£’æ€§éªŒè¯ï¼šåœ¨30%å™ªå£°ç¯å¢ƒä¸‹çš„çœŸå®è¡¨ç°

### ğŸ“ˆ é²æ£’æ€§æµ‹è¯•è„šæœ¬

æµ‹è¯•ç®—æ³•åœ¨ä¸åŒå™ªå£°æ°´å¹³ä¸‹çš„é²æ£’æ€§è¡¨ç°ï¼š

```bash
# å›å½’ç®—æ³•é²æ£’æ€§æµ‹è¯•ï¼ˆçœŸå®æ•°æ®é›†ï¼‰
python scripts/regression_robustness_real_datasets.py

# åˆ†ç±»ç®—æ³•é²æ£’æ€§æµ‹è¯•ï¼ˆçœŸå®æ•°æ®é›†ï¼‰
python scripts/classification_robustness_real_datasets.py

# è¿™äº›è„šæœ¬å°†ï¼š
# 1. ä½¿ç”¨sklearnå†…ç½®çœŸå®æ•°æ®é›†
# 2. æµ‹è¯•0%-100%å™ªå£°æ¢¯åº¦ï¼ˆ11ä¸ªçº§åˆ«ï¼‰
# 3. æ¯”è¾ƒå¤šç§ç®—æ³•çš„é²æ£’æ€§æ›²çº¿
# 4. æ”¯æŒå¤šæ¬¡è¿è¡Œå–å¹³å‡ï¼Œæé«˜ç»“æœç¨³å®šæ€§
```



## ğŸ“š æ–‡æ¡£ä¸ç†è®ºåŸºç¡€

### ğŸ§® æ•°å­¦ç†è®ºåŸºç¡€
- **[ğŸŒŸ æ•°å­¦åŸºç¡€ (ä¸­æ–‡)](docs/mathematical_foundation.md)** - **æœ€æ ¸å¿ƒæ–‡æ¡£** å®Œæ•´çš„CausalEngineç†è®ºæ¡†æ¶
- **[One-Pager Summary](docs/ONE_PAGER.md)** - Executive summary of CausalEngine

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨Apache License 2.0 - è¯¦è§[LICENSE](LICENSE)æ–‡ä»¶ã€‚


## ğŸ“– å­¦æœ¯å¼•ç”¨

å¦‚æœæ‚¨åœ¨ç ”ç©¶ä¸­ä½¿ç”¨äº†Causal-Sklearnï¼Œè¯·å¼•ç”¨ï¼š

```bibtex
@software{causal_sklearn,
  title={Causal-Sklearn: Scikit-learn Compatible Causal Regression and Classification},
  author={Heyang Gong},
  year={2025},
  url={https://github.com/1587causalai/causal-sklearn},
  note={åŸºäºCausalEngineâ„¢æ ¸å¿ƒçš„å› æœå›å½’å’Œå› æœåˆ†ç±»ç®—æ³•çš„scikit-learnå…¼å®¹å®ç°}
}
```

---

<div align="center">

**ğŸŒŸ CausalEngineâ„¢ - åŸºäºå½’å› è¡ŒåŠ¨æ¡†æ¶çš„å› æœæ¨ç†å¼•æ“ ğŸŒŸ**

*ä»ç›¸å…³æ€§åˆ°å› æœæ€§ï¼Œä»æ¨¡å¼åŒ¹é…åˆ°å› æœç†è§£*

</div>