"use strict";(self["webpackChunkdebiai_frontend"]=self["webpackChunkdebiai_frontend"]||[]).push([[311],{4891:function(e,t,s){s.r(t),s.d(t,{default:function(){return je}});var o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"project"}},[e.settings&&e.project?s("Modal",{on:{close:function(t){e.settings=!1}}},[s("h2",{staticClass:"aligned spaced"},[e._v(" Project columns "),s("button",{staticClass:"red",on:{click:function(t){e.settings=!1}}},[e._v(" Close ")])]),s("ProjectColumnsVisualization")],1):e._e(),s("Header",{attrs:{project:e.project},on:{settings:function(t){e.settings=!e.settings},refresh:e.loadProject,deleteProject:e.deleteProject,backToProjects:e.backToProjects}}),s("transition",{attrs:{name:"fade"}},[e.project?s("div",{attrs:{id:"projectContent"}},[s("div",{attrs:{id:"selectionAndModels"}},[s("Selections",{attrs:{project:e.project,nbSelectedSamples:e.nbSelectedSamples},on:{selectionSelected:e.selectionSelected,selectionDeleted:e.selectionDeleted,setSelectionIntersection:function(t){return e.selectionIntersection=t},newSelection:e.loadProject}}),s("Models",{attrs:{project:e.project,nbEvaluatedSamples:e.nbEvaluatedSamples,nbSelectedSamples:e.nbSelectedSamples,nbResults:e.nbResults},on:{modelSelected:e.modelSelected,modelDeleted:e.modelDeleted,setCommonModelResults:function(t){return e.commonModelResults=t}}})],1),s("div",{staticClass:"card",staticStyle:{margin:"5px"},attrs:{id:"bot"}},[s("CachePanel",{attrs:{project:e.project}}),s("button",{attrs:{id:"startAnalysisBtn",disabled:!e.readyToAnalyze},on:{click:function(t){return e.startAnalysis(!1)},mousedown:function(t){return"button"in t&&1!==t.button?null:e.startAnalysis(!0)}}},[e._v(" Start analysis ")]),s("button",{attrs:{id:"startExplorationBtn",disabled:!e.readyToAnalyze},on:{click:function(t){return e.openExplorations(!1)},mousedown:function(t){return"button"in t&&1!==t.button?null:e.openExplorations(!0)}}},[e._v(" Explorations ")])],1)]):e._e()])],1)},l=[],a=(s(7658),function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{attrs:{id:"Header"}},[o("div",{attrs:{id:"left"}},[o("div",{attrs:{id:"logoAndName"}},[o("a",{on:{click:[function(t){return t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:e.$emit("backToProjects")},function(t){return t.ctrlKey?t.shiftKey||t.altKey||t.metaKey?null:e.$emit("backToProjects",!0):null}],mouseup:function(t){return"button"in t&&1!==t.button||t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:e.$emit("backToProjects",!0)}}},[o("img",{attrs:{src:s(5737),alt:"DebiAI",id:"debiaiLogo",height:"48"}})]),e.project?o("div",{attrs:{id:"projectName"}},[o("a",{on:{click:[function(t){return t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:e.$emit("backToProjects")},function(t){return t.ctrlKey?t.shiftKey||t.altKey||t.metaKey?null:e.$emit("backToProjects",!0):null}],mouseup:function(t){return"button"in t&&1!==t.button||t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:e.$emit("backToProjects",!0)}}},[e._v(" Projects ")]),e._v(" / "+e._s(e.project.name)+" ")]):e._e()]),e.project?o("div",{attrs:{id:"items"}},[void 0!==e.project.nbSamples&&null!==e.project.nbSamples?o("div",{staticClass:"item nbSamples",attrs:{title:"Number of samples"}},[o("inline-svg",{attrs:{src:s(2798)}}),e._v(" "+e._s(e.project.nbSamples)+" samples ")],1):o("div",{staticClass:"item nbSamples",attrs:{title:"Number of samples"}},[o("inline-svg",{attrs:{src:s(2798)}}),e._v(" ? ")],1),void 0!==e.project.nbSelections&&null!==e.project.nbSelections?o("div",{staticClass:"item nbSelections",attrs:{title:"Project selections"}},[o("inline-svg",{attrs:{src:s(7352)}}),e._v(" "+e._s(e.project.nbSelections)+" selections ")],1):o("div",{staticClass:"item nbSelections",attrs:{title:"Project selections"}},[o("inline-svg",{attrs:{src:s(7352)}}),e._v(" ? ")],1),void 0!==e.project.nbModels&&null!==e.project.nbModels?o("div",{staticClass:"item nbModel",attrs:{title:"Model added to the project"}},[o("inline-svg",{attrs:{src:s(1375)}}),e._v(" "+e._s(e.project.nbModels)+" models ")],1):o("div",{staticClass:"item nbModel",attrs:{title:"Model added to the project"}},[o("inline-svg",{attrs:{src:s(1375)}}),e._v(" ? ")],1)]):e._e()]),o("div",{attrs:{id:"right"}},[e.project&&(e.project.creationDate||e.project.updateDate)?o("div",{attrs:{id:"dates"}},[e.project.creationDate?o("span",{attrs:{title:e.$services.timeStampToDate(e.project.creationDate)}},[e._v(" Created "+e._s(e.$services.prettyTimeStamp(e.project.creationDate))+" ")]):e._e(),e.project.updateDate?o("span",{attrs:{title:e.$services.timeStampToDate(e.project.updateDate)}},[e._v(" Updated "+e._s(e.$services.prettyTimeStamp(e.project.updateDate))+" ")]):e._e()]):e._e(),o("div",{attrs:{id:"buttonsTop"}},[o("button",{attrs:{id:"settings"},on:{click:function(t){return e.$emit("settings")}}},[o("inline-svg",{attrs:{src:s(7364),width:"12",height:"12",fill:"white"}})],1),o("button",{staticClass:"warning",attrs:{id:"refresh"},on:{click:function(t){return e.$emit("refresh")}}},[o("inline-svg",{attrs:{src:s(9866),width:"10",height:"10"}}),e._v(" Refresh ")],1),e.$store.state.ProjectPage.dataProviderInfo&&e.$store.state.ProjectPage.dataProviderInfo.canDelete&&e.$store.state.ProjectPage.dataProviderInfo.canDelete.projects?o("button",{staticClass:"red",attrs:{id:"delete"},on:{click:function(t){return e.$emit("deleteProject")}}},[e._v(" Delete ")]):e._e()])])])}),n=[],i={name:"Header",props:{project:{type:Object}}},r=i,c=s(3736),d=(0,c.Z)(r,a,n,!1,null,"9099a5bc",null),u=d.exports,m=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"ProjectColumnsVisualization"}},[s("h3",[e._v("Data columns")]),s("div",{attrs:{id:"columns"}},e._l(Object.keys(e.dataColumnsPerGroup),(function(t,o){return s("div",{key:o,staticClass:"category"},[s("div",{staticClass:"categoryName"},[e._v(e._s(t)+":")]),e._l(Object.keys(e.dataColumnsPerGroup[t]),(function(o){return s("div",{key:o,staticClass:"group"},[o?s("div",[s("Collapsible",{staticStyle:{margin:"3px"},scopedSlots:e._u([{key:"header",fn:function(){return[e._v(" "+e._s(o)+" "),s("span",{staticClass:"nbItem"},[e._v(" "+e._s(e.dataColumnsPerGroup[t][o].length)+" ")])]},proxy:!0},{key:"body",fn:function(){return[s("div",{staticClass:"columns"},[s("Columns",{attrs:{columns:e.dataColumnsPerGroup[t][o]}})],1)]},proxy:!0}],null,!0)})],1):s("div",{staticClass:"group"},[s("Columns",{attrs:{columns:e.dataColumnsPerGroup[t][o]}})],1)])}))],2)})),0),e.projectColumns.length?e._e():s("div",[e._v("No columns")]),s("h3",[e._v("Results columns")]),e.projectResultsColumns.length?s("div",{attrs:{id:"results"}},e._l(Object.keys(e.resultsColumnsPerGroup.results),(function(t){return s("div",{key:t,staticClass:"group"},[t?s("div",[s("Collapsible",{staticStyle:{margin:"3px"},scopedSlots:e._u([{key:"header",fn:function(){return[e._v(" "+e._s(t)+" "),s("span",{staticClass:"nbItem"},[e._v(" "+e._s(e.resultsColumnsPerGroup.results[t].length)+" ")])]},proxy:!0},{key:"body",fn:function(){return[s("div",{staticClass:"columns"},[s("Columns",{attrs:{columns:e.resultsColumnsPerGroup.results[t]}})],1)]},proxy:!0}],null,!0)})],1):s("div",{staticClass:"group"},[s("Columns",{attrs:{columns:e.resultsColumnsPerGroup.results[t]}})],1)])})),0):s("div",[e._v("No results columns")])])},h=[],p=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"columns"},e._l(e.columns,(function(t){return s("div",{key:t.name,staticClass:"column"},[s("div",{staticClass:"columnName"},[e._v(" "+e._s(t.name)+" ")]),s("div",{staticClass:"columnType"},[e._v(" "+e._s(void 0!==t.type?t.type:"auto")+" ")])])})),0)},g=[],v={name:"Columns",components:{},props:{columns:{type:Array,required:!0}},data:()=>({}),created(){},methods:{},computed:{}},b=v,f=(0,c.Z)(b,p,g,!1,null,"35a6378b",null),y=f.exports,I={name:"ProjectColumnsVisualization",components:{Columns:y},data:()=>({projectColumns:[],projectResultsColumns:[]}),created(){this.projectColumns=this.$store.state.ProjectPage.projectColumns,this.projectColumns||(this.projectColumns=[]),this.projectResultsColumns=this.$store.state.ProjectPage.projectResultsColumns,this.projectResultsColumns||(this.projectResultsColumns=[])},methods:{groupCategoriesPerGroup(e){const t={};for(let s in e){const o={"":[]};for(let t of e[s]){const e=t.group;e?(o[e]||(o[e]=[]),o[e].push(t)):o[""].push(t)}t[s]=o}return t}},computed:{columnsPerCategory(){let e={};for(let t=0;t<this.projectColumns.length;t++){let s=this.projectColumns[t],o=s.category+"s";o=o.charAt(0).toUpperCase()+o.slice(1),o||(o="other"),e[o]||(e[o]=[]),e[o].push(s)}return e},dataColumnsPerGroup(){return this.groupCategoriesPerGroup(this.columnsPerCategory)},resultsColumnsPerGroup(){return this.groupCategoriesPerGroup({results:this.projectResultsColumns})}}},j=I,S=(0,c.Z)(j,m,h,!1,null,"50ceaae8",null),C=S.exports,P=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{attrs:{id:"models"}},[o("div",{attrs:{id:"modelsPanel"}},[o("div",{attrs:{id:"title"}},[o("h2",[o("inline-svg",{staticStyle:{"margin-right":"10px"},attrs:{src:s(1375),width:"25",height:"25"}}),e._v(" Models ")],1),o("span",{staticStyle:{display:"flex","align-items":"center"}},[o("button",{on:{click:e.selectAll}},[e._v("All")]),o("button",{staticStyle:{"margin-right":"5px"},on:{click:e.selectNone}},[e._v(" None ")]),o("input",{directives:[{name:"model",rawName:"v-model",value:e.searchBar,expression:"searchBar"}],staticClass:"search",attrs:{type:"text",placeholder:"Search a model"},domProps:{value:e.searchBar},on:{input:function(t){t.target.composing||(e.searchBar=t.target.value)}}})])]),e.project.models.length>0?o("div",{staticClass:"itemList",attrs:{id:"modelList"}},e._l(e.filteredModels,(function(t){return o("div",{key:t.id,class:"model item selectable "+(e.selectedModelIds.includes(t.id)?"selected":""),on:{click:function(s){return e.selectModel(t.id)}}},[o("div",{staticClass:"title"},[o("h3",{staticClass:"name"},[e._v(e._s(t.name))]),t.creationDate?o("span",{staticClass:"date",attrs:{title:e.$services.timeStampToDate(t.creationDate)}},[e._v(" Created "+e._s(e.$services.prettyTimeStamp(t.creationDate))+" ")]):o("span",{staticClass:"date"},[e._v(" No creation date ")])]),o("div",{staticClass:"allButtons"},[t.metadata&&Object.keys(t.metadata).length>0?o("DocumentationBlock",[o("h4",[e._v("Model Metadata")]),o("br"),o("div",{staticStyle:{"white-space":"pre-wrap"}},[o("span",{domProps:{innerHTML:e._s(e.$services.prettifyJSON(t.metadata))}})])]):e._e(),o("div",{staticClass:"sampleNumber",attrs:{title:"Number of samples for which we have model results "}},[o("inline-svg",{attrs:{src:s(2798),width:"20",height:"20"}}),e._v(e._s("nbResults"in t&&null!==t.nbResults?t.nbResults:"?")+" ")],1),e.$store.state.ProjectPage.dataProviderInfo&&e.$store.state.ProjectPage.dataProviderInfo.canDelete&&e.$store.state.ProjectPage.dataProviderInfo.canDelete.models?o("button",{staticClass:"red",on:{click:function(s){return e.deleteModel(t.id,s)}}},[e._v(" Delete ")]):e._e()],1)])})),0):o("div",{staticStyle:{"text-align":"center","padding-top":"20px"},attrs:{id:"Model"}},[e._v(" No models ")])]),o("transition",{attrs:{name:"fade"}},[e.selectedModelIds.length>0?o("div",{staticClass:"card",attrs:{id:"modelsControls"}},[o("transition",{attrs:{name:"fade"}},[e.selectedModelIds.length>1?o("div",{attrs:{id:"commonModelResults"}},[e._v(" Multiple model results selected : "),o("div",{staticClass:"dataGroup"},[e._v(" Union "),o("input",{directives:[{name:"model",rawName:"v-model",value:e.commonModelResults,expression:"commonModelResults"}],staticClass:"customCbx",staticStyle:{display:"none"},attrs:{type:"checkbox",id:"commonModelResultsToggle"},domProps:{checked:Array.isArray(e.commonModelResults)?e._i(e.commonModelResults,null)>-1:e.commonModelResults},on:{change:function(t){var s=e.commonModelResults,o=t.target,l=!!o.checked;if(Array.isArray(s)){var a=null,n=e._i(s,a);o.checked?n<0&&(e.commonModelResults=s.concat([a])):n>-1&&(e.commonModelResults=s.slice(0,n).concat(s.slice(n+1)))}else e.commonModelResults=l}}}),o("label",{staticClass:"toggle",attrs:{for:"commonModelResultsToggle"}},[o("span")]),e._v(" Intersection ")])]):e._e()]),o("div",{attrs:{id:"nbEvaluatedSamples"}},[e._v(" Number of results : "),o("div",{staticClass:"dataGroup"},[e._v(" "+e._s(null===e.nbResults?"?":e.nbResults)+" ")])])],1):e._e()])],1)},_=[],w={props:{project:{type:Object,required:!0},nbEvaluatedSamples:{type:Number},nbResults:{type:Number},nbSelectedSamples:{type:Number}},data:()=>({searchBar:"",selectedModelIds:[],commonModelResults:!0}),mounted(){},methods:{selectModel(e){this.selectedModelIds.includes(e)?this.selectedModelIds=this.selectedModelIds.filter((t=>t!==e)):this.selectedModelIds.push(e),this.$emit("modelSelected",this.selectedModelIds)},selectAll(){this.selectedModelIds=this.project.models.map((e=>e.id)),this.$emit("modelSelected",this.selectedModelIds)},selectNone(){this.selectedModelIds=[],this.$emit("modelSelected",this.selectedModelIds)},deleteModel(e,t){this.$backendDialog.delModel(e).then((()=>{this.$store.commit("sendMessage",{title:"success",msg:"Model deleted"}),this.selectedModelIds=this.selectedModelIds.filter((t=>t!==e)),this.$emit("modelSelected",this.selectedModelIds),this.$emit("modelDeleted",e)})).catch((e=>{console.log(e),this.$store.commit("sendMessage",{title:"error",msg:"Couldn't delete the model"})})),t.stopPropagation()}},computed:{filteredModels(){return null===this.project?[]:""===this.searchBar?this.project.models:this.project.models.filter((e=>e.name.toLowerCase().includes(this.searchBar.toLowerCase())))}},watch:{commonModelResults(){this.$emit("setCommonModelResults",this.commonModelResults)}}},R=w,M=(0,c.Z)(R,P,_,!1,null,"808b7302",null),$=M.exports,k=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{attrs:{id:"selections"}},[o("div",{attrs:{id:"selectionsPanel"}},[o("div",{attrs:{id:"title"}},[o("span",{staticClass:"aligned gapped"},[o("h2",[o("inline-svg",{staticStyle:{"margin-right":"10px"},attrs:{src:s(7352),width:"25",height:"25"}}),e._v(" Selections ")],1),o("DocumentationBlock",[e._v(" A "),o("b",[e._v(" selection ")]),e._v(" is a list of samples, it can be created from the analysis dashboard. "),o("br"),e._v(" Selections are used to start analysis on a specific subset of the data project, they can be extracted by the DebiAI python library. ")])],1),o("span",{staticClass:"aligned"},[o("button",{on:{click:e.selectAll}},[e._v("All")]),o("button",{staticStyle:{"margin-right":"5px"},on:{click:e.selectNone}},[e._v(" None ")]),o("input",{directives:[{name:"model",rawName:"v-model",value:e.searchBar,expression:"searchBar"}],staticClass:"search",attrs:{type:"text",placeholder:"Search a selection"},domProps:{value:e.searchBar},on:{input:function(t){t.target.composing||(e.searchBar=t.target.value)}}})])]),o("div",{staticClass:"itemList",attrs:{id:"selectionList"}},[o("div",{class:"selection item selectable "+(0==e.selectedSelectionIds.length?"selected":""),attrs:{id:"allData"},on:{click:e.selectNone}},[e._m(0),o("div",{staticClass:"sampleNumber",attrs:{title:"Selection sample number"}},[o("inline-svg",{attrs:{src:s(2798),height:"25"}}),e._v(e._s(null!==e.project.nbSamples?e.project.nbSamples:"?")+" ")],1)]),e._l(e.filteredSelections,(function(t){return o("Selection",{key:t.id,class:"item selectable "+(e.selectedSelectionIds.includes(t.id)?"selected":""),attrs:{selection:t},on:{selected:function(s){return e.selectSelection(t.id)},delete:function(s){return e.deleteSelection(t.id)},selectRequest:e.selectRequest}})})),0==e.project.selections.length?o("div",{staticStyle:{"text-align":"center","padding-top":"20px"}},[e._v(" No selections ")]):e._e()],2)]),o("transition",{attrs:{name:"fade"}},[o("div",{staticClass:"card",attrs:{id:"analysisControls"}},[o("transition",{attrs:{name:"fade"}},[e.selectedSelectionIds.length>1?o("div",{attrs:{id:"selectionIntersection"}},[e._v(" Multiple selection selected : "),o("div",{staticClass:"dataGroup",staticStyle:{"margin-right":"40px"}},[e._v(" Union "),o("input",{directives:[{name:"model",rawName:"v-model",value:e.selectionIntersection,expression:"selectionIntersection"}],staticClass:"customCbx",staticStyle:{display:"none"},attrs:{type:"checkbox",id:"selectionIntersectionToggle"},domProps:{checked:Array.isArray(e.selectionIntersection)?e._i(e.selectionIntersection,null)>-1:e.selectionIntersection},on:{change:function(t){var s=e.selectionIntersection,o=t.target,l=!!o.checked;if(Array.isArray(s)){var a=null,n=e._i(s,a);o.checked?n<0&&(e.selectionIntersection=s.concat([a])):n>-1&&(e.selectionIntersection=s.slice(0,n).concat(s.slice(n+1)))}else e.selectionIntersection=l}}}),o("label",{staticClass:"toggle",attrs:{for:"selectionIntersectionToggle"}},[o("span")]),e._v(" Intersection ")])]):e._e()]),o("div",{attrs:{id:"nbSelectedSamples"}},[o("span",{staticStyle:{padding:"0px 5px"}},[e._v(" "+e._s(e.nbSelectedSamples)+" ")]),o("inline-svg",{attrs:{src:s(2798),width:"20",height:"20"}}),e.project.nbSamples?o("span",{staticStyle:{padding:"0 5px 0 2px","font-weight":"normal"},attrs:{title:100*e.nbSelectedSamples/e.project.nbSamples+"%"}},[e._v(" ("+e._s(Math.ceil(100*e.nbSelectedSamples/e.project.nbSamples))+"%) ")]):e._e(),e._v(" Selected samples ")],1)],1)])],1)},D=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"title"},[s("h3",{staticClass:"name"},[e._v("All data")])])}],q=s(249),x={components:{Selection:q.Z},props:{project:{type:Object,required:!0},nbSelectedSamples:{type:Number,default:0}},data:()=>({searchBar:"",selectedSelectionIds:[],selectionIntersection:!0,selectionCreation:!1,selectedRequestId:null}),mounted(){},methods:{selectSelection(e){this.selectedSelectionIds.includes(e)?this.selectedSelectionIds=this.selectedSelectionIds.filter((t=>t!==e)):this.selectedSelectionIds.push(e),this.$emit("selectionSelected",this.selectedSelectionIds)},selectAll(){this.selectedSelectionIds=this.project.selections.map((e=>e.id)),this.$emit("selectionSelected",this.selectedSelectionIds)},selectNone(){this.selectedSelectionIds=[],this.$emit("selectionSelected",this.selectedSelectionIds)},deleteSelection(e){this.$backendDialog.delSelection(e).then((()=>{this.$store.commit("sendMessage",{title:"success",msg:"Selection deleted"}),this.selectedSelectionIds=this.selectedSelectionIds.filter((t=>t!==e)),this.$emit("selectionSelected",this.selectedSelectionIds),this.$emit("selectionDeleted",e)})).catch((e=>{console.log(e),this.$store.commit("sendMessage",{title:"error",msg:"Couldn't delete the selection"})}))},selectRequest(e){this.selectedRequestId=e}},computed:{filteredSelections(){return this.project&&this.project.selections?""===this.searchBar?this.project.selections:this.project.selections.filter((e=>e.name.toLowerCase().includes(this.searchBar.toLowerCase()))):[]}},watch:{selectionIntersection(){this.$emit("setSelectionIntersection",this.selectionIntersection)}}},L=x,N=(0,c.Z)(L,k,D,!1,null,"0d599804",null),Z=N.exports,E=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{attrs:{id:"CachePanel"}},[o("h3",[o("inline-svg",{attrs:{src:s(2798),width:"20",height:"20"}}),o("span",[e._v(" Cache ")]),o("documentation-block",{attrs:{top:""}},[o("h4",[e._v("What is the cache?")]),o("p",[e._v(" The cache allows to avoid requesting the server for data that has already been requested. ")]),o("h4",[e._v("How does it work?")]),o("p",[e._v(" When you request data from the server, the data is stored in your browser's cache. "),o("br"),e._v(" If you request the same data again, the cache will be used instead of requesting the server. ")]),o("p",[e._v(" The cache is based on the project update date, if the project update date changes, the cache will be cleared. ")])])],1),e.updateDate?o("div",{attrs:{id:"content"}},[o("div",{attrs:{id:"useCache"}},[e._v(" Enable project data cache: "),o("input",{directives:[{name:"model",rawName:"v-model",value:e.useCache,expression:"useCache"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.useCache)?e._i(e.useCache,null)>-1:e.useCache},on:{change:function(t){var s=e.useCache,o=t.target,l=!!o.checked;if(Array.isArray(s)){var a=null,n=e._i(s,a);o.checked?n<0&&(e.useCache=s.concat([a])):n>-1&&(e.useCache=s.slice(0,n).concat(s.slice(n+1)))}else e.useCache=l}}})]),o("div",{attrs:{id:"nbCached"}},[e._v("Project cached items: "+e._s(e.nbCacheItems))]),o("div",{attrs:{id:"buttons"}},[o("button",{attrs:{id:"clearCache",disabled:e.loading},on:{click:e.clearCache}},[e._v(" Clear cache ")]),o("button",{staticClass:"warning",attrs:{title:"Refresh cache info"},on:{click:e.getNbCacheItems}},[o("inline-svg",{attrs:{src:s(9866),width:"15",height:"15"}})],1)])]):o("p",{staticClass:"warning"},[e._v(" The project has no update date. "),o("br"),e._v(" The cache will not be used. "),o("documentation-block",{attrs:{top:""}},[o("h4",[e._v("Why?")]),o("p",[e._v(" The cache is based on the project update date. "),o("br"),e._v(" If we don't know when the project was updated, we can't know if the cache is up to date. If the project has no update date, the cache will not be used. ")])])],1)])},A=[],T=s(8135);const B=1;async function K(e){const t=T.Z.state.ProjectPage.projectId,s=T.Z.state.ProjectPage.dataProviderId,o=`${s}___${t}`;return new Promise(((t,s)=>{let l=window.indexedDB.open(o,B);l.onerror=e=>{console.log("Error opening db",e),s("Error")},l.onsuccess=s=>{let o=s.target.result.transaction("data","readwrite");const l=o.objectStore("data");let a=l.get("timestamp");a.onsuccess=()=>{let o=a.result;if(o&&o.timestamp&&o.timestamp===e)t(s.target.result);else{console.log("Resetting the project database");let o=s.target.result.transaction("samples","readwrite");const l=o.objectStore("samples");let a=l.clear();a.onsuccess=()=>{console.log("Sample store cleared");let o=s.target.result.transaction("results","readwrite");const l=o.objectStore("results");let a=l.clear();a.onsuccess=()=>{console.log("results store cleared");let o=s.target.result.transaction("data","readwrite");const l=o.objectStore("data");let a=l.clear();a.onsuccess=()=>{console.log("data store cleared"),l.put({id:"timestamp",timestamp:e}),t(s.target.result)}}}}}},l.onupgradeneeded=t=>{console.log("Init cache database");let s=t.target.result;s.createObjectStore("samples",{keyPath:"sampleId"}),s.createObjectStore("results",{keyPath:["sampleId","modelId"]});let o=s.createObjectStore("data",{keyPath:"id"});o.put({id:"timestamp",timestamp:e})}}))}async function G(){const e=T.Z.state.ProjectPage.projectId,t=T.Z.state.ProjectPage.dataProviderId,s=`${t}___${e}`;return new Promise(((e,t)=>{let o=window.indexedDB.deleteDatabase(s);o.onerror=e=>{console.log("Error deleting db",e),t("Error")},o.onsuccess=t=>{e()}}))}async function O(e,t){try{let s=await K(e);return console.time("Saving data to the cache"),new Promise((e=>{let o=s.transaction("samples","readwrite");o.oncomplete=()=>{console.timeEnd("Saving data to the cache"),e()},o.onerror=t=>{console.timeEnd("Saving data to the cache"),console.log("Error"),console.log(t),e()};let l=o.objectStore("samples");Object.entries(t).forEach((([e,t])=>l.put({sampleId:e.toString(),data:t})))}))}catch(s){console.warn("Error while saving samples to cache")}}async function F(e,t){try{let s=await K(e);return new Promise((e=>{let o=s.transaction("samples","readonly"),l=o.objectStore("samples"),a={},n=t.length;console.time("Loading data from cache"),t.forEach(((t,s)=>{let o=l.get(t.toString());o.onsuccess=()=>{o.result&&(a[t]=o.result.data),s==n-1&&(console.timeEnd("Loading data from cache"),e(a))},o.onerror=t=>{console.timeEnd("Loading data from cache"),console.log("Error"),console.log(t),e(a)}}))}))}catch(s){return console.warn("Error while loading samples from cache"),{}}}async function z(e){try{let t=await K(e);return new Promise((e=>{let s=t.transaction("samples","readonly"),o=s.objectStore("samples");const l=o.count();l.onsuccess=()=>{e(l.result)},l.onerror=t=>{console.log("Error"),console.log(t),e(0)}}))}catch(t){return console.warn("Error while loading samples from cache"),null}}var H={saveSamples:O,resetDb:G,getSamplesByIds:F,getNbSamples:z},U={props:{project:{type:Object,require:!0}},data:()=>({useCache:!0,nbCacheItems:null,updateDate:null,loading:!1}),mounted(){this.project.updateDate&&(this.getNbCacheItems(),"false"===localStorage.getItem("useCache")&&(this.useCache=!1))},methods:{getNbCacheItems(){this.nbCacheItems=null,this.updateDate=this.project.updateDate,H.getNbSamples(this.updateDate).then((e=>{this.nbCacheItems=e}))},clearCache(){this.loading=!0;const e=this.$services.uuid();this.$store.commit("startRequest",{name:"Clearing the project cache",code:e}),H.resetDb().then((()=>{this.nbCacheItems=0,this.$store.commit("sendMessage",{title:"success",msg:"Cache cleared"})})).catch((e=>{console.log(e),this.$store.commit("sendMessage",{title:"error",msg:"Error while clearing cache"})})).finally((()=>{this.$store.commit("endRequest",e),this.loading=!1}))}},computed:{},watch:{useCache:{handler:function(e){localStorage.setItem("useCache",e),this.$store.commit("setUseCache",e)}}}},V=U,W=(0,c.Z)(V,E,A,!1,null,"0cd0571b",null),J=W.exports,Q=s(3304);const Y=s(7200),X=s(112).Z;let ee={};function te(){ee={id:null,canceled:!1,requestCodes:{analysisStarting:null,projectSamplesIdList:null,modelResults:null}}}const se=[{blName:"inputs",singleName:"input"},{blName:"groundTruth",singleName:"ground truth"},{blName:"contexts",singleName:"context"},{blName:"others",singleName:"other"},{blName:"features",singleName:"features"},{blName:"annotations",singleName:"annotations"}];async function oe(){try{const e=T.Z.state.ProjectPage.dataProviderInfo,t={maxIdLimit:e?.maxSampleIdByRequest||1e4,maxDataLimit:e?.maxSampleDataByRequest||2e3,maxResultLimit:e?.maxResultByRequest||5e3};return t}catch(e){return console.log("Error while getting data provider limit, using default values"),console.log(e),{maxIdLimit:1e4,maxDataLimit:2e3,maxResultLimit:5e3}}}async function le(e,t=[],s=!1,o=[],l=!1){if(ee.canceled)return;const a=e.dataProvider.maxIdLimit,n=e.nbSamples;if(0===n)return[];if(null!==n&&n<=a||t.length>0||o.length>0){const e=await X.getIdList({analysis:{id:ee.id,start:!0,end:!0},selectionIds:t,selectionIntersection:s,modelIds:o,commonResults:l});return e.samples}if(null===n){let e=[],t=0;console.warn("Project samples number is not known, loading samples ID list by chunks");let s=Q.Z.startRequest("Step 1/2: Loading the data ID list");ee.requestCodes.projectSamplesIdList=s;try{console.time("getProjectSamplesIdList");while(1){const o=t*a,l=(t+1)*a-1,n={id:ee.id,start:!1,end:!1};0===t&&(n.start=!0);const i=await X.getIdList({analysis:n,from:o,to:l});if(0===i.samples.length){console.log("No samples found while loading project samples ID list");break}if(e=e.concat(i.samples),console.log("Current samples ID list length: ",e.length),i.samples.length<a){console.log("Last samples found while loading project samples ID list",i.samples.length,"<",a);break}if(ee.canceled)break;Q.Z.updateRequestQuantity(s,e.length),t++}console.timeEnd("getProjectSamplesIdList"),Q.Z.endRequest(s)}catch(i){throw console.timeEnd("getProjectSamplesIdList"),Q.Z.endRequest(s),i}return console.log("Request done, ",e.length," samples found"),e}{let e=Math.ceil(n/a),t=[];console.log("Splitting ID list request in ",e," requests");let s=Q.Z.startProgressRequest("Step 1/2: Loading the data ID list");ee.requestCodes.projectSamplesIdList=s;try{console.time("getProjectSamplesIdList");for(let o=0;o<e;o++){const l=o*a,i=Math.min((o+1)*a,n)-1,r={id:ee.id,start:!1,end:!1};0===o&&(r.start=!0),o===e-1&&(r.end=!0);const c=await Y.default.getProjectIdList(r,l,i);if(0===c.length)throw"No samples found while loading project samples ID list from "+l+" to "+i;if(c.length!==i-l+1)throw"Wrong number of samples while loading project samples ID list from "+l+" to "+i+", got "+c.length+" instead of "+(i-l+1);if(t=t.concat(c),Q.Z.updateRequestProgress(s,(o+1)/e),ee.canceled)break}console.timeEnd("getProjectSamplesIdList"),Q.Z.endRequest(s)}catch(i){throw console.timeEnd("getProjectSamplesIdList"),Q.Z.endRequest(s),i}console.log("Request done, ",t.length," samples found over ",n," samples requested");let o=[...new Set(t)];return o.length!==t.length&&console.warn("Samples ID list is not unique, ",t.length-o.length," duplicates found over ",t.length," samples"),t}}async function ae({considerResults:e}){let t=await Y.default.getProject();void 0===t.nbSamples&&(t.nbSamples=null);var s={timestamp:t.updateDate,nbSamples:t.nbSamples,labels:["Data ID"],categories:["other"],type:["auto"],groups:[null]};t.columns.forEach((e=>{s.labels.push(e.name),s.categories.push(e.category),s.type.push(e.type),s.groups.push(e.group)})),e&&"resultStructure"in t&&(s.labels.push("model"),s.categories.push("results"),s.type.push("auto"),s.groups.push(null),t.resultStructure.forEach((e=>{s.labels.push(e.name),s.categories.push("results"),s.type.push(e.type),s.groups.push(e.group)})));const o=T.Z.state.ProjectPage.enableCache;return o||(s.timestamp=null),s}async function ne(e,t){if(ee.canceled)return;const s=e.dataProvider.maxDataLimit;let o=0,l=t.length,a=Q.Z.startProgressRequest("Loading the project data");console.time("Loading the project data");let n=[],i=[];try{while(o<l){let r=t.slice(o,o+s);if(e.timestamp){let t=await H.getSamplesByIds(e.timestamp,r);n=[...n,...Object.values(t)],i=[...i,...Object.keys(t)],r=r.filter((e=>!(e in t)))}if(r.length){console.log(r.length+" samples to download");const t={id:ee.id,start:!1,end:!1};0===o&&(t.start=!0),o+r.length===l&&(t.end=!0);const s=await Y.default.getBlocksFromSampleIds(r,t),a=s.data;for(let e in a)a[e].unshift(e);n=[...n,...Object.values(a)],i=[...i,...Object.keys(a)],e.timestamp&&H.saveSamples(e.timestamp,a)}if(o+=s,Q.Z.updateRequestProgress(a,o/l),ee.canceled)break}}finally{Q.Z.endRequest(a),console.timeEnd("Loading the project data")}return{dataArray:n,sampleIdList:i}}async function ie(e,t,s){const o=e.dataProvider.maxResultLimit;let l=0,a=Q.Z.startProgressRequest(t);ee.requestCodes.modelResults=a;let n={};try{let e=s.length;while(l<e){let i=s.slice(l,l+o),r=await Y.default.getModelResults(t,i);if(n=Object.assign({},n,r),l+=o,Q.Z.updateRequestProgress(a,l/e),ee.canceled)break}Q.Z.updateRequestProgress(a,1)}finally{Q.Z.endRequest(a)}return n}async function re(e,t){let s=await ae({considerResults:!1}),o=await oe();s["dataProvider"]=o;let l=await le(s,e,t);if(ee.canceled)return;const{dataArray:a,sampleIdList:n}=await ne(s,l);return{metaData:s,array:[s.labels,...a],sampleIdList:n}}async function ce(e,t,s,o){let l=await ae({considerResults:!0}),a=await oe();l["dataProvider"]=a;let n=await le(l,e,t,s,o);const{dataArray:i,sampleIdList:r}=await ne(l,n);let c=Q.Z.startProgressRequest("Loading the model results");try{let e=[],t=[];for(let o=0;o<s.length;o++){if(ee.canceled)break;const a=s[o];let d=await ie(l,a,n);const u=[],m=[];r.forEach(((e,t)=>{e in d&&(u.push([...i[t],a,...d[e]]),m.push(e))})),e=[...e,...u],t=[...t,...m],Q.Z.updateRequestProgress(c,(o+1)/s.length)}return{metaData:l,array:[l.labels,...e],sampleIdList:t}}catch(d){throw console.error(d),d}finally{Q.Z.endRequest(c)}}async function de(e,t){let s=Q.Z.startProgressRequest("Preparing the analysis");console.time("Preparing the analysis");let o={labels:[],nbLines:0,nbColumns:0,columns:new Array(t.labels.length).fill(null),categories:[...se.map((e=>e.singleName)),"results"]};o.labels=e[0],o.nbLines=e.length-1,o.nbColumns=e[0].length;for(const[l,a]of o.labels.entries()){let e=o.labels.findIndex(((e,t)=>a==e&&l!=t)),t=2;while(e>=0)o.labels[e]=o.labels[e]+"_"+t,e=o.labels.findIndex(((e,t)=>a==e&&l!=t))}for await(const[l,a]of o.labels.entries()){const n=[];for(let t=1;t<o.nbLines+1;t++)n.push(e[t][l]);const i=t.categories[l],r=t.type[l],c=t.groups[l];o.columns[l]={index:l,label:a,values:n,category:i,type:r,group:c},Q.Z.updateRequestProgress(s,(l+1)/o.nbColumns),console.timeLog("Preparing the analysis","Column "+a+" "+(l+1)+" / "+o.nbColumns)}return Q.Z.endRequest(s),console.timeEnd("Preparing the analysis"),o}async function ue({selectionIds:e=null,selectionIntersection:t=!1,modelIds:s=null,commonModelResults:o=!1}){if(he())throw new Error("Analysis already running");te();let l,a,n=Q.Z.startRequest("The analysis is starting",me);ee.requestCodes.analysisStarting=n,ee.id=Q.Z.uuid();try{if(a=s&&s.length>0?await ce(e,t,s,o):await re(e,t),!ee.canceled){let e=a.metaData,t=a.array,s=a.sampleIdList;l=await de(t,e),l.sampleIdList=s}}catch(i){throw console.error(i),te(),i}finally{Q.Z.endRequest(n)}if(!ee.canceled)return te(),l;te()}function me(){console.log("cancelCallback"),ee.canceled=!0,Q.Z.endRequest(ee.requestCodes.analysisStarting),Q.Z.endRequest(ee.requestCodes.projectSamplesIdList),Q.Z.endRequest(ee.requestCodes.modelResults)}function he(){return null!=ee.id&&!ee.canceled}var pe={loadProjectSamples:ue,cancelAnalysis:me,isAnalysisLoading:he},ge=s(112),ve=s(6737),be=s.n(ve),fe={name:"Project",components:{Header:u,ProjectColumnsVisualization:C,Models:$,Selections:Z,CachePanel:J},data:()=>({dataProviderId:null,projectId:null,project:null,loading:!1,settings:!1,selectedSelectionsIds:[],selectionIntersection:!0,nbSelectedSamples:0,selectedModelIds:[],commonModelResults:!0,nbEvaluatedSamples:0,nbResults:0}),created(){let e=this.$route.params.dataProviderId?this.$route.params.dataProviderId:this.$route.query.dataProviderId,t=this.$route.params.projectId?this.$route.params.projectId:this.$route.query.projectId,s=this.$route.query.startAnalysis;e&&t?(this.dataProviderId=e,this.projectId=t,this.$store.commit("setDataProviderId",e),this.$store.commit("setProjectId",t),this.$backendDialog.getSingleDataInfo().then((e=>{this.$store.commit("setDataProviderInfo",e)})),this.loadProject().then((()=>{if(s){console.log("Start analysis");let s=this.$route.query.selectionIds,o=this.$route.query.selectionIntersection,l=this.$route.query.modelIds,a=this.$route.query.commonModelResults;s&&(s=s.split(".")),l&&(l=l.split(".")),o=!0===o,a=!0===a,this.loadData({dataProviderId:e,projectId:t,selectionIds:s,selectionIntersection:o,modelIds:l,commonModelResults:a})}}))):(console.log("No project ID or no data provider ID"),this.$router.push("/"))},methods:{async loadProject(){return this.project=null,this.$backendDialog.getProject().then((e=>{this.project=e,this.nbSelectedSamples=this.project.nbSamples,this.project.selections=this.project.selections.sort(((e,t)=>t.updateDate-e.updateDate)),this.project.models=this.project.models.sort(((e,t)=>t.updateDate-e.updateDate)),this.$store.commit("setProjectColumns",this.project.columns),this.$store.commit("setProjectResultsColumns",this.project.resultStructure),this.$store.commit("setProjectName",this.project.name),this.project.name?document.title=this.project.name:document.title=this.project.id})).catch((e=>{e.response&&500===e.response.status?this.$store.commit("sendMessage",{title:"error",msg:"Internal server error while loading project"}):e.response&&404===e.response.status?this.$store.commit("sendMessage",{title:"error",msg:"Project not found"}):this.$store.commit("sendMessage",{title:"error",msg:"Error while loading project"}),console.log(e),this.$router.push("/")}))},selectionSelected(e){this.selectedSelectionsIds=e,this.updateNbSamples()},modelSelected(e){this.selectedModelIds=e,this.updateNbSamples()},updateNbSamples(){if(0===this.selectedSelections.length&&0===this.selectedModels.length)return this.nbSelectedSamples=this.project.nbSamples,this.nbEvaluatedSamples=0,void(this.nbResults=0);const e={analysis:{id:this.$services.uuid(),start:!0,end:!0},selectionIds:this.selectedSelections.map((e=>e.id)),selectionIntersection:this.selectionIntersection,modelIds:this.selectedModels.map((e=>e.id)),commonResults:this.commonModelResults};this.loading=!0,ge.Z.getIdList(e).finally((()=>this.loading=!1)).then((e=>{this.nbSelectedSamples=e.nbFromSelection,this.nbEvaluatedSamples=e.nbSamples,this.nbResults=e.nbFromModels})).catch((e=>{console.log(e),this.$store.commit("sendMessage",{title:"error",msg:"Something went wrong while getting the samples list"}),this.loadProject()}))},startAnalysis(e){if(e){let e=this.$router.resolve({path:"/dataprovider/"+this.dataProviderId+"/project/"+this.projectId,query:{selectionIds:this.selectedSelectionsIds,selectionIntersection:this.selectionIntersection,modelIds:this.selectedModelIds,commonModelResults:this.commonModelResults,startAnalysis:!0}});window.open(e.href,"_blank")}else this.loadData({dataProviderId:this.dataProviderId,projectId:this.projectId,selectionIds:this.selectedSelectionsIds,selectionIntersection:this.selectionIntersection,modelIds:this.selectedModelIds,commonModelResults:this.commonModelResults})},loadData({dataProviderId:e,projectId:t,selectionIds:s=[],selectionIntersection:o=!1,modelIds:l=[],commonModelResults:a=!1}){console.time("Loading data"),this.loading=!0,pe.loadProjectSamples({selectionIds:s,selectionIntersection:o,modelIds:l,commonModelResults:a}).then((n=>{n?(this.$store.commit("setSelectionsIds",s),this.$store.commit("setColoredColumnIndex",0),this.$store.commit("clearAllFilters"),s&&s.length>0&&(s=s.reduce(((e,t)=>t+"."+e))),l&&l.length>0&&(l=l.reduce(((e,t)=>t+"."+e))),console.timeEnd("Loading data"),this.$router.push({name:"dataAnalysis",query:{dataProviderId:e,projectId:t,selectionIds:s,selectionIntersection:o,modelIds:l,commonModelResults:a},params:{data:n}})):this.$store.commit("sendMessage",{title:"info",msg:"Analysis canceled"})})).finally((()=>this.loading=!1)).catch((e=>{console.log(e.response.status),e.response&&500===e.response.status?this.$store.commit("sendMessage",{title:"error",msg:"Internal server error while loading data"}):e.response&&404===e.response.status?this.$store.commit("sendMessage",{title:"error",msg:"Data not found"}):this.$store.commit("sendMessage",{title:"error",msg:"Error while loading data"}),this.loadProject()}))},deleteProject(){be()({title:"Delete the project ?",text:"Do you really want to delete the project ? There is no way back.",buttons:!0,icon:"warning",dangerMode:!0}).then((e=>{e&&this.$backendDialog.deleteProject().then((()=>{this.$store.commit("sendMessage",{title:"success",msg:"Project deleted"}),this.$router.push("/")})).catch((e=>{console.log(e),this.$store.commit("sendMessage",{title:"error",msg:"Could not delete the project"})}))}))},selectionDeleted(e){this.project.selections=this.project.selections.filter((t=>t.id!==e))},modelDeleted(e){this.project.models=this.project.models.filter((t=>t.id!==e))},backToProjects(e=!1){if(e){const e=this.$router.resolve({name:"projects"});window.open(e.href,"_blank")}else pe.isAnalysisLoading()?be()({title:"Cancel the analysis?",text:"Do you really want to cancel the analysis and go back to the projects list?",buttons:{cancel:"No",validate:"Yes"},icon:"warning",dangerMode:!0}).then((e=>{e&&(pe.cancelAnalysis(),this.$router.push("/"))})):this.$router.push("/")},openExplorations(e){if(e){const e=this.$router.resolve({path:"/dataprovider/"+this.dataProviderId+"/project/"+this.projectId,name:"explorations"});window.open(e.href,"_blank")}else this.$router.push({name:"explorations"})}},computed:{readyToAnalyze(){return!this.disabled&&!this.loading&&0!==this.nbSelectedSamples&&!(this.selectedModelIds.length>0&&0===this.nbEvaluatedSamples)},selectedSelections(){return this.selectedSelectionsIds.map((e=>this.project.selections.find((t=>e===t.id))))},selectedModels(){return this.selectedModelIds.map((e=>this.project.models.find((t=>e===t.id))))}},watch:{selectionIntersection(){this.updateNbSamples()},commonModelResults(){this.updateNbSamples()}},beforeDestroy(){pe.isAnalysisLoading()&&pe.cancelAnalysis();try{be().close()}catch(e){}}},ye=fe,Ie=(0,c.Z)(ye,o,l,!1,null,"7208b2ce",null),je=Ie.exports},112:function(e,t,s){var o=s(7200),l=s(3304);async function a(e){const t=l.Z.startRequest("Getting samples ID list");let s=[],a=new Set,n=0,i=0;if((!e.selectionIds||0===e.selectionIds.length)&&(!e.modelIds||0===e.modelIds.length))try{s=void 0!==e.from&&void 0!==e.to?await o["default"].getProjectIdList(e.analysis,e.from,e.to):await o["default"].getProjectIdList(e.analysis),n=s.length}catch(r){throw l.Z.endRequest(t),r}if(e.selectionIds&&e.selectionIds.length>0){const i=l.Z.startProgressRequest("Getting selections ID list"),r=e.selectionIntersection;try{let t=0;for(const a of e.selectionIds){t++,l.Z.updateRequestProgress(i,t/e.selectionIds.length);const c=await o["default"].getSelectionIdList(a);if(0===s.length)s=c;else if(r){const e=new Set(c);if(s=s.filter((t=>e.has(t))),0===s.length){n=0;break}}else s=[...new Set([...s,...c])]}}catch(c){throw l.Z.endRequest(t),c}finally{l.Z.endRequest(i)}a=new Set(s),s=[...a],n=s.length}if(e.modelIds&&e.modelIds.length>0){if(e.selectionIds&&e.selectionIds.length>0&&0===s.length)return i=null,l.Z.endRequest(t),{samples:[],nbSamples:0,nbFromSelection:0,nbFromModels:0};const r=l.Z.startProgressRequest("Getting models ID list"),d=e.commonResults;let u=[];try{let t=0;for(const s of e.modelIds){t++,l.Z.updateRequestProgress(r,t/e.modelIds.length);let c=await o["default"].getModelResultsIdList(s);if(e.selectionIds&&e.selectionIds.length>0?c=c.filter((e=>a.has(e))):n+=c.length,0===u.length)u=c,d||(i+=c.length);else if(d){const e=new Set(c);if(u=u.filter((t=>e.has(t))),0===u.length){i=0;break}}else i+=c.length,u=[...new Set([...u,...c])]}d&&(i=u.length*e.modelIds.length),s=u}catch(c){throw l.Z.endRequest(t),c}finally{l.Z.endRequest(r)}}return l.Z.endRequest(t),{samples:s,nbSamples:s.length,nbFromSelection:n,nbFromModels:i}}t["Z"]={getIdList:a}}}]);
//# sourceMappingURL=311.351e2347.js.map