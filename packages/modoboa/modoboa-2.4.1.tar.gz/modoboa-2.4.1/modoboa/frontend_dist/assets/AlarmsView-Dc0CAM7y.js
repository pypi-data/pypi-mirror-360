import{d as F}from"./index-CvDWe0Ox.js";import{_ as v,i as E,b as U,l as G,g,c as k,w as a,a as s,e as q,f as h,z as $,k as n,t as m,j as x,F as w,o as d}from"./index-6uM3C9QJ.js";import{_ as S}from"./MenuItems-BKLaU8d3.js";import{V as L}from"./VMenu-CS4-l2Pu.js";import{V as M,d as H}from"./index-BTn2TCUq.js";import{V as N}from"./VChip-DH7R5Ijd.js";import{V as O,a as J}from"./VToolbar-Bn743GAp.js";import{V as K}from"./VTextField-DI1vrMFe.js";import{V as Q}from"./forwardRefs-DzkmOl4h.js";import{V as W}from"./VDataTableServer-_q5yX1uN.js";import{c as X}from"./VCard-UdW0_Uwo.js";import"./VProgressCircular-l7s493OQ.js";import"./tag-7q_Qn7dl.js";import"./VAvatar-BgULcTRt.js";import"./ssrBoot-BNifTZr0.js";import"./VDataTable-BMUJtiNY.js";import"./VSelect-C2sbdVot.js";import"./VCheckboxBtn-CGxH_5Qi.js";import"./VSelectionControl-CgTvwJaW.js";import"./VTable-Dgv3UJ8N.js";import"./filter-D9eXvGXt.js";const V="alarms",A={getAll(i){return v.get(`${V}/`,{params:i})},switchStatus(i,e){return v.patch(`${V}/${i}/switch/`,e)},delete(i){return v.delete(`${V}/${i}/`)},bulkDelete(i){return v.delete(`${V}/bulk_delete/`,{params:{ids:i}})}},Y=1,Z=2,y={ALARM_OPENED:Y,ALARM_CLOSED:Z},ee={class:"text-right"},te={__name:"AlarmList",setup(i){const{$gettext:e}=U(),u=G(),C=g([]),b=g(!1),p=g(""),f=g([]),D=g(0),R=[{title:e("Triggered"),key:"created"},{title:e("Status"),key:"status"},{title:e("Domain"),key:"domain.name",sortable:!1},{title:e("Mailbox"),key:"mailbox",sortable:!1},{title:e("Message"),key:"title"},{title:e("Actions"),key:"actions",sortable:!1,align:"right"}];function T(){const l=[];return f.value.length>0&&l.push({label:e("Delete"),icon:"mdi-delete-outline",onClick:j,color:"red"}),l.push({label:e("Reload"),icon:"mdi-reload",onClick:r}),l}function z(l){const o=[];return o.push({label:e("Delete"),icon:"mdi-delete-outline",onClick:I,color:"red"}),l.status===y.ALARM_OPENED?o.push({label:e("Close alarm"),icon:"mdi-check",onClick:B,color:"green"}):o.push({label:e("Reopen alarm"),icon:"mdi-alert-circle-outline",onClick:P,color:"orange"}),o}function r({page:l,itemsPerPage:o,sortBy:t}){const _={page:l||1,page_size:o||10};t&&t.length&&(_.ordering=t.map(c=>c.order!=="asc"?`-${c.key}`:c.key).join(",")),p.value!==""&&(_.search=p.value),b.value=!0,A.getAll(_).then(c=>{C.value=c.data.results,D.value=c.data.count,b.value=!1})}async function I(l,o=!0){A.delete(l.id).then(()=>{o&&(u.displayNotification({msg:e("Alarm deleted")}),r({}))})}async function j(){await A.bulkDelete(f.value.map(l=>l.id)),u.displayNotification({msg:e("Alarms deleted")}),f.value=[],r({})}async function B(l){A.switchStatus(l.id,{status:y.ALARM_CLOSED}).then(()=>{u.displayNotification({msg:e("Alarm closed")}),r({})})}async function P(l){A.switchStatus(l.id,{status:y.ALARM_OPENED}).then(()=>{u.displayNotification({msg:e("Alarm re-opened")}),r({})})}return r=F(r,500),(l,o)=>(d(),k(X,{class:"mt-6"},{default:a(()=>[s(W,{modelValue:f.value,"onUpdate:modelValue":o[1]||(o[1]=t=>f.value=t),headers:R,items:C.value,search:p.value,"item-value":"id","items-length":D.value,loading:b.value,elevation:"0","show-select":"","onUpdate:options":r},{top:a(()=>[s(O,{color:"white",flat:""},{default:a(()=>[s(K,{modelValue:p.value,"onUpdate:modelValue":o[0]||(o[0]=t=>p.value=t),"prepend-inner-icon":"mdi-magnify",placeholder:"Search",density:"compact",variant:"outlined","hide-details":"",flat:"","single-line":"",class:"flex-grow-0 w-33 mr-4"},null,8,["modelValue"]),s(L,{location:"bottom"},{activator:a(({props:t})=>[s(M,$(t,{size:"small"}),{default:a(()=>[n(m(h(e)("Actions"))+" ",1),s(H,{right:""},{default:a(()=>o[2]||(o[2]=[n("mdi-chevron-down")])),_:1,__:[2]})]),_:2},1040)]),default:a(()=>[s(Q,{density:"compact"},{default:a(()=>[s(h(S),{items:T()},null,8,["items"])]),_:1})]),_:1})]),_:1})]),"item.status":a(({item:t})=>[t.status===1?(d(),k(N,{key:0,color:"warning",size:"small"},{default:a(()=>[n(m(h(e)("Opened")),1)]),_:1})):(d(),k(N,{key:1,color:"info",size:"small"},{default:a(()=>[n(m(h(e)("Closed")),1)]),_:1}))]),"item.mailbox":a(({item:t})=>[t.mailbox?(d(),x(w,{key:0},[n(m(t.mailbox.address)+"@"+m(t.domain.name),1)],64)):(d(),x(w,{key:1},[n(" / ")],64))]),"item.created":a(({item:t})=>[n(m(l.$date(t.created)),1)]),"item.actions":a(({item:t})=>[q("div",ee,[s(L,{location:"bottom"},{activator:a(({props:_})=>[s(M,$({icon:"mdi-dots-horizontal"},_,{variant:"text"}),null,16)]),default:a(()=>[s(h(S),{items:z(t),obj:t},null,8,["items","obj"])]),_:2},1024)])]),_:2},1032,["modelValue","items","search","items-length","loading"])]),_:1}))}},ae=E(te,[["__scopeId","data-v-63744498"]]),le={__name:"AlarmsView",setup(i){return(e,u)=>(d(),x(w,null,[s(O,{flat:""},{default:a(()=>[s(J,null,{default:a(()=>[n(m(e.$gettext("Opened alarms")),1)]),_:1})]),_:1}),s(ae)],64))}},we=E(le,[["__scopeId","data-v-d7e4ea18"]]);export{we as default};
