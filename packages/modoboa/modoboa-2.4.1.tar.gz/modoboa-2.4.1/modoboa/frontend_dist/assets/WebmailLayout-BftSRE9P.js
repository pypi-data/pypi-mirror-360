import{i as oe,aX as E,aY as ne,K as G,l as j,g as r,J as z,r as ie,j as _,o as m,F as D,D as se,G as Q,e as N,c as O,n as T,a,f as V,t as B,m as P,b as W,h as F,w as f,aZ as K,p as re}from"./index-6uM3C9QJ.js";import{_ as ue,V as me,a as de}from"./ConnectedLayout-C0KKRFEy.js";import{_ as ce}from"./ConfirmDialog-Ark6TqOm.js";import{a as C}from"./webmail-CURzuE4B.js";import{d as Y,V as L,e as pe,o as ve}from"./index-BTn2TCUq.js";import{V as H}from"./VSpacer-tY9Tuje3.js";import{V as fe,r as be}from"./VForm-BM98r94C.js";import{a as xe,b as ge,c as ye}from"./VCard-UdW0_Uwo.js";import{V as Me}from"./VTextField-DI1vrMFe.js";import{V as _e}from"./VDialog-HV-J7ggg.js";import{V as Ve}from"./VMenu-CS4-l2Pu.js";import{V as he,a as R}from"./forwardRefs-DzkmOl4h.js";import"./VContainer-6TaCDL-y.js";/* empty css              */import"./tag-7q_Qn7dl.js";import"./VApp-BmRCleZk.js";import"./layout-DRQ0y7TH.js";import"./ssrBoot-BNifTZr0.js";import"./global.store-BvbCbkx6.js";import"./layout.store-CVQ6UwuK.js";import"./VProgressCircular-l7s493OQ.js";import"./VRow-B8i6Vivu.js";import"./VSheet-CpJnecez.js";import"./VAvatar-BgULcTRt.js";import"./VToolbar-Bn743GAp.js";const Ce=["onClick","onMouseover","onMouseleave"],we={key:0,class:"font-weight-bold"},ke={key:1},Ue={key:0,class:"font-weight-bold"},$e={key:1},Be={__name:"MailboxList",props:E({mailboxes:{type:Array,default:null},lightMode:{type:Boolean,default:!1},compact:{type:Boolean,default:!1},unseenCounters:{type:Boolean,default:!0},allowUnselect:{type:Boolean,default:!1}},{modelValue:{},modelModifiers:{}}),emits:E(["update:modelValue"],["update:modelValue"]),setup(S,{emit:x}){const l=S,n=ne(S,"modelValue"),i=x,h=G(),s=j(),k={inbox:"mdi-inbox",draft:"mdi-file",junk:"mdi-fire",sent:"mdi-email-fast-outline",trash:"mdi-trash-can-outline",normal:"mdi-folder-outline"},d=r(null),g=r({}),p=r({});function y(e){return e.label.split("/").pop()}function c(e){return d.value===null&&(d.value=e.unseen),d.value}function u(e,w){g.value[e.name]=w}function o(e){return n.value===e.name?"bg-primary-lighten-1":l.lightMode?g.value[e.name]?"bg-primary":"bg-white":g.value[e.name]?"bg-primary-lighten-1":"bg-primary"}function M(e){return p.value[e.name]}function I(e){p.value[e.name]||(p.value[e.name]=!1),p.value[e.name]=!p.value[e.name],p.value[e.name]&&!e.sub.length&&C.getUserMailboxes(e.name).then(w=>{e.sub=w.data.mailboxes})}function X(e){l.allowUnselect&&e===n.value?i("update:modelValue",null):i("update:modelValue",e)}return z(()=>s.mbCounterKey,()=>{C.getUserMailboxUnseen(h.query.mailbox).then(e=>{d.value=e.data.counter})}),(e,w)=>{const q=ie("MailboxList",!0);return m(),_("div",null,[(m(!0),_(D,null,se(l.mailboxes,t=>(m(),_("div",{key:t.name,class:Q(["pl-3 text-body-2",{"py-1":!l.compact}])},[N("div",{class:Q([o(t),"d-flex mailbox pa-1 align-center"]),onClick:U=>X(t.name),onMouseover:U=>u(t,!0),onMouseleave:U=>u(t,!1)},[a(Y,{icon:k[t.type],class:"mr-4"},null,8,["icon"]),t.name===V(h).query.mailbox?(m(),_(D,{key:0},[d.value>0?(m(),_("span",we,B(y(t))+" ("+B(c(t))+") ",1)):(m(),_("span",ke,B(y(t)),1))],64)):(m(),_(D,{key:1},[t.unseen>0?(m(),_("span",Ue,B(y(t))+" ("+B(t.unseen)+") ",1)):(m(),_("span",$e,B(y(t)),1))],64)),a(H),t.sub?(m(),O(L,{key:2,icon:M(t)?"mdi-minus":"mdi-plus",size:"xsmall",variant:"flat",color:"transparent",onClick:P(U=>I(t),["stop"])},null,8,["icon","onClick"])):T("",!0)],42,Ce),M(t)&&t.sub&&t.sub.length?(m(),O(q,{key:0,modelValue:n.value,"onUpdate:modelValue":w[0]||(w[0]=U=>n.value=U),mailboxes:t.sub,class:"mt-1","light-mode":l.lightMode,compact:l.compact},null,8,["modelValue","mailboxes","light-mode","compact"])):T("",!0)],2))),128))])}}},J=oe(Be,[["__scopeId","data-v-62d5beb0"]]),Ne={class:"mb-2 rounded-lg"},Le={__name:"MailboxForm",props:{userMailboxes:Array,mailbox:{type:String,default:null},hdelimiter:{type:String,default:null}},emits:["close","mailboxRenamed"],setup(S,{emit:x}){const l=S,n=x,{$gettext:i}=W(),{displayNotification:h}=j(),s=r({}),k=r(),d=r(!1),g=F(()=>l.mailbox?i("Edit mailbox"):i("Create new mailbox")),p=F(()=>l.mailbox?i("Update"):i("Create")),y=()=>{s.value={},n("close")},c=async()=>{const{valid:u}=await k.value.validate();if(u){d.value=!0;try{const o={...s.value};l.mailbox?(o.oldname=l.mailbox,await C.renameUserMailbox(o),h({msg:i("Mailbox renamed")}),n("mailboxRenamed",`${o.parent_mailbox}${l.hdelimiter}${o.name}`)):(await C.createUserMailbox(o),h({msg:i("Mailbox created")})),y()}finally{d.value=!1}}};return z(()=>l.mailbox,u=>{if(u){const o=l.mailbox.split(l.hdelimiter);s.value.name=o.slice(-1)[0],s.value.parent_mailbox=o.slice(0,-1).join(l.hdelimiter)}else s.value={}},{immediate:!0}),(u,o)=>(m(),O(ye,{title:g.value},{default:f(()=>[a(xe,null,{default:f(()=>[a(fe,{ref_key:"formRef",ref:k},{default:f(()=>[a(Me,{modelValue:s.value.name,"onUpdate:modelValue":o[0]||(o[0]=M=>s.value.name=M),label:V(i)("Name"),variant:"outlined",density:"compact",rules:[V(be).required]},null,8,["modelValue","label","rules"]),N("div",Ne,[N("h4",null,B(V(i)("Parent mailbox")),1),a(J,{modelValue:s.value.parent_mailbox,"onUpdate:modelValue":o[1]||(o[1]=M=>s.value.parent_mailbox=M),"active-mailbox":l.parent,mailboxes:l.userMailboxes,"light-mode":"",compact:"","unseen-counters":!1,"allow-unselect":""},null,8,["modelValue","active-mailbox","mailboxes"])])]),_:1},512)]),_:1}),a(ge,null,{default:f(()=>[a(H),a(L,{text:V(i)("Close"),variant:"flat",loading:d.value,onClick:y},null,8,["text","loading"]),a(L,{text:p.value,variant:"tonal",color:"primary",loading:d.value,onClick:c},null,8,["text","loading"])]),_:1})]),_:1},8,["title"]))}},Se={class:"d-flex align-center"},qe={class:"d-flex justify-center mb-4"},Fe={class:"border-t-sm d-flex align-center bg-grey"},ia={__name:"WebmailLayout",async setup(S){let x,l;const{$gettext:n}=W(),i=G(),h=re(),s=j(),k=r(),d=r(!0),g=r(!1),p=r(null),y=r(null),c=r(null),u=r(i.query.mailbox||"INBOX"),o=r(!1),M=r([]),I=F(()=>["INBOX"].includes(i.query.mailbox||"INBOX")),X=F(()=>c.value.usage<50?"info":c.value.usage<80?"warning":"error"),e=F(()=>`${c.value.current} / ${c.value.limit} (${c.value.usage}%)`);function w(b){h.push({name:"MailboxView",query:{mailbox:b}}),C.getUserMailboxQuota(b).then(v=>{c.value=v.data})}const q=async()=>{const b=await C.getUserMailboxes();M.value=b.data.mailboxes,y.value=b.data.hdelimiter},t=()=>{h.push({name:"ComposeEmailView"})},U=()=>{o.value=!1,p.value=null,q()},Z=()=>{o.value=!0},ee=()=>{p.value=u.value,o.value=!0},A=b=>{u.value=b,h.push({name:"MailboxView",query:{mailbox:b}})},ae=async()=>{await C.compressUserMailbox({name:u.value}),s.displayNotification({msg:n("Mailbox compressed")})},le=async()=>{await k.value.open(n("Warning"),n("Delete this mailbox?"),{color:"warning",agreeLabel:n("Yes"),cancelLabel:n("No")})&&(await C.deleteUserMailbox({name:u.value}),s.displayNotification({msg:n("Mailbox deleted")}),A("INBOX"))};z(()=>s.dataKey,()=>{q()}),[x,l]=K(()=>q()),await x,l();const te=([x,l]=K(()=>C.getUserMailboxQuota(i.query.mailbox||"INBOX")),x=await x,l(),x);return c.value=te.data,(b,v)=>(m(),_(D,null,[a(ue,null,{navbar:f(()=>[a(me,{modelValue:d.value,"onUpdate:modelValue":v[2]||(v[2]=$=>d.value=$),rail:g.value,permanent:"",color:"primary",app:""},{prepend:f(()=>[N("div",Se,[a(ve,{src:de,"max-width":"190",class:"logo"}),a(L,{icon:g.value?"mdi-chevron-right":"mdi-chevron-left",variant:"text",onClick:v[0]||(v[0]=P($=>g.value=!g.value,["stop"]))},null,8,["icon"])]),N("div",qe,[a(L,{text:V(n)("Compose"),color:"secondary",variant:"flat","prepend-icon":"mdi-pencil",onClick:t},null,8,["text"])])]),append:f(()=>[N("div",Fe,[a(L,{class:"ml-2",variant:"text",icon:"",size:"small"},{default:f(()=>[a(Y,{icon:"mdi-cog"}),a(Ve,{activator:"parent"},{default:f(()=>[a(he,{density:"compact"},{default:f(()=>[a(R,{title:V(n)("Create a new mailbox"),"prepend-icon":"mdi-plus",onClick:Z},null,8,["title"]),a(R,{title:V(n)("Edit this mailbox"),"prepend-icon":"mdi-pencil",disabled:I.value,onClick:ee},null,8,["title","disabled"]),a(R,{title:V(n)("Delete this mailbox"),"prepend-icon":"mdi-trash-can",disabled:I.value,onClick:le},null,8,["title","disabled"]),a(R,{title:V(n)("Compress this mailbox"),"prepend-icon":"mdi-folder-zip-outline",onClick:ae},null,8,["title"])]),_:1})]),_:1})]),_:1}),c.value?(m(),O(pe,{key:0,color:X.value,"model-value":c.value.usage,title:e.value},null,8,["color","model-value","title"])):T("",!0)])]),default:f(()=>[a(J,{modelValue:u.value,"onUpdate:modelValue":[v[1]||(v[1]=$=>u.value=$),w],mailboxes:M.value,class:"mr-2"},null,8,["modelValue","mailboxes"])]),_:1},8,["modelValue","rail"])]),_:1}),a(_e,{modelValue:o.value,"onUpdate:modelValue":v[4]||(v[4]=$=>o.value=$),"max-width":"800"},{default:f(()=>[a(Le,{"user-mailboxes":M.value,mailbox:p.value,hdelimiter:y.value,onMailboxRenamed:A,onClose:v[3]||(v[3]=$=>U())},null,8,["user-mailboxes","mailbox","hdelimiter"])]),_:1},8,["modelValue"]),a(ce,{ref_key:"confirm",ref:k},null,512)],64))}};export{ia as default};
