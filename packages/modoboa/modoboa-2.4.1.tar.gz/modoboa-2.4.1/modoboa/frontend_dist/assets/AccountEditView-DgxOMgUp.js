import{b as D,u as J,K,p as z,g as c,h as T,d as H,L as M,J as W,c as d,j as p,o,a,e as v,w as e,n as k,f as m,k as f,t as r,F as P,i as X}from"./index-6uM3C9QJ.js";import{b as Y,a as Z,A as ee,_ as ae}from"./AccountAliasForm-C5Lezi72.js";import{_ as le}from"./ResourcesForm-CMV4XftI.js";import{L as te}from"./LoadingData-cK4U155J.js";import{p as oe}from"./parameters-BG0eKo1T.js";import{u as se}from"./permissions-Dxxy3XiM.js";import{f as V,d as N,V as j}from"./index-BTn2TCUq.js";import{V as g,c as b,a as x,b as ue}from"./VExpansionPanels-CtQbBNmZ.js";import{V as _,a as n}from"./VRow-B8i6Vivu.js";import{V as re,a as ne}from"./VToolbar-Bn743GAp.js";import"./ChoiceField-BE5A2NOX.js";import"./VAlert-B27KCrh1.js";import"./VProgressCircular-l7s493OQ.js";import"./tag-7q_Qn7dl.js";import"./VForm-BM98r94C.js";import"./VTextField-DI1vrMFe.js";import"./forwardRefs-DzkmOl4h.js";import"./ssrBoot-BNifTZr0.js";import"./VAvatar-BgULcTRt.js";import"./AccountPasswordSubForm-lQIx0VeZ.js";import"./VSwitch-CS2VqXpn.js";import"./VSelectionControl-CgTvwJaW.js";import"./EmailField-DoOHEhV4.js";import"./domains.store-BRdtIDtL.js";import"./domains-vJA4hvK9.js";import"./VChip-DH7R5Ijd.js";import"./VContainer-6TaCDL-y.js";/* empty css              */const ie={key:1},de={key:0},me={key:0},fe={class:"mr-2"},ce={class:"mr-2"},_e={key:0},ve={class:"mr-2"},pe={class:"mr-2"},ke={class:"mr-2"},ye={key:0},Ve={class:"mr-2"},ge={key:0},be={class:"mr-2"},xe={class:"mr-2"},Fe={class:"mt-4 d-flex justify-end"},we={__name:"AccountEditForm",setup(q){const{$gettext:i}=D(),R=J(),F=K(),G=z(),{canSetRole:S}=se(),l=c({pk:F.params.id}),w=T(()=>l.value.username&&l.value.username.indexOf("@")!==-1),$=T(()=>{const t=C.value.params&&C.value.params.enable_admin_limits&&l.value.role!=="SimpleUsers"&&l.value.role!=="SuperAdmins";return t===void 0?!1:t}),C=c({}),h=c(0),y=c(!1),A=c(!1),E=c(),B=c(),I=c(),L=c(),U=c(),O=T(()=>{const t={roleForm:E,generalForm:B};return w.value&&(t.aliasForm=L,t.mailboxForm=I),$.value&&(t.resourcesForm=U),t});async function Q(){A.value=!1,h.value=[];for(const[t,s]of Object.entries(O.value))if(s.value!=null){const{valid:u}=await s.value.vFormRef.validate();u||(A.value=!0,h.value.push(t))}if(!A.value){y.value=!0;try{const t={...l.value};w.value?t.mailbox.full_address=t.username:delete t.mailbox.full_address,t.new_password&&(t.password=t.new_password,delete t.new_password,delete t.password_confirmation),$.value&&U.value!==null&&(t.resources=U.value.getPayload()),t.aliases===null&&delete t.aliases,S.value||(l.value.pk===R.authUser.pk?t.role=R.authUser.role:t.role="SimpleUsers"),await M.patch(l.value.pk,t),G.push({name:"AccountDetail",params:{id:F.params.id}})}finally{y.value=!1}}}return H(()=>{M.get(F.params.id).then(t=>{l.value=t.data,y.value=!1}),S.value&&oe.getGlobalApplication("limits").then(t=>{C.value=t.data})}),W(l,()=>{delete l.value.domains,l.value.mailbox===null&&delete l.value.mailbox},{deep:!0}),(t,s)=>y.value?(o(),d(te,{key:0})):(o(),p("div",ie,[a(ue,{modelValue:h.value,"onUpdate:modelValue":s[5]||(s[5]=u=>h.value=u),multiple:A.value},{default:e(()=>[m(S)?(o(),d(g,{key:0,eager:"",value:"roleForm"},{default:e(()=>[a(b,null,{default:e(({expanded:u})=>[a(_,{"no-gutters":""},{default:e(()=>[a(n,{cols:"4"},{default:e(()=>[f(r(m(i)("Role")),1)]),_:1}),a(n,{cols:"8",class:"text-medium-emphasis"},{default:e(()=>[a(V,{"leave-absolute":""},{default:e(()=>[u?(o(),p("span",de)):(o(),d(_,{key:1,"no-gutters":"",style:{width:"100%"}},{default:e(()=>[E.value?(o(),d(n,{key:0,cols:"6"},{default:e(()=>[f(r(E.value.roleLabel),1)]),_:1})):k("",!0)]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),a(x,null,{default:e(()=>[a(Y,{ref_key:"roleForm",ref:E,modelValue:l.value,"onUpdate:modelValue":s[0]||(s[0]=u=>l.value=u)},null,8,["modelValue"])]),_:1})]),_:1})):k("",!0),a(g,{eager:"",value:"generalForm"},{default:e(()=>[a(b,null,{default:e(({expanded:u})=>[a(_,{"no-gutters":""},{default:e(()=>[a(n,{cols:"4"},{default:e(()=>[f(r(m(i)("Identification")),1)]),_:1}),a(n,{cols:"8",class:""},{default:e(()=>[a(V,{"leave-absolute":""},{default:e(()=>[u?(o(),p("span",me)):(o(),d(_,{key:1,"no-gutters":"",style:{width:"100%"}},{default:e(()=>[a(n,{cols:"6"},{default:e(()=>[v("div",fe,r(m(i)("Username:"))+" "+r(l.value.username),1)]),_:1}),a(n,{cols:"6"},{default:e(()=>[v("div",ce,[f(r(m(i)("Enabled"))+" ",1),l.value.is_active?(o(),d(N,{key:0,color:"success"},{default:e(()=>s[7]||(s[7]=[f("mdi-check-circle-outline")])),_:1,__:[7]})):(o(),d(N,{key:1},{default:e(()=>s[8]||(s[8]=[f("mdi-close-circle-outline")])),_:1,__:[8]}))])]),_:1})]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),a(x,null,{default:e(()=>[a(Z,{ref_key:"generalForm",ref:B,modelValue:l.value,"onUpdate:modelValue":s[1]||(s[1]=u=>l.value=u),editing:""},null,8,["modelValue"])]),_:1})]),_:1}),w.value?(o(),d(g,{key:1,eager:"",value:"mailboxForm"},{default:e(()=>[a(b,null,{default:e(({expanded:u})=>[a(_,{"no-gutters":""},{default:e(()=>[a(n,{cols:"4"},{default:e(()=>[f(r(m(i)("Mailbox")),1)]),_:1}),a(n,{cols:"8",class:""},{default:e(()=>[a(V,{"leave-absolute":""},{default:e(()=>[u?(o(),p("span",_e)):(o(),d(_,{key:1,"no-gutters":"",style:{width:"100%"}},{default:e(()=>[l.value.mailbox?(o(),p(P,{key:0},[l.value.mailbox.use_domain_quota?(o(),d(n,{key:0,cols:"6"},{default:e(()=>[v("div",ve,r(m(i)("Quota: "))+" "+r(m(i)("domain's default value")),1)]),_:1})):(o(),d(n,{key:1,cols:"6"},{default:e(()=>[v("div",pe,r(m(i)("Quota: "))+" "+r(l.value.mailbox.quota),1)]),_:1})),a(n,{cols:"6"},{default:e(()=>[v("div",ke,[f(r(m(i)("Send only"))+" ",1),l.value.mailbox.is_send_only?(o(),d(N,{key:0,color:"success"},{default:e(()=>s[9]||(s[9]=[f("mdi-check-circle-outline")])),_:1,__:[9]})):(o(),d(N,{key:1},{default:e(()=>s[10]||(s[10]=[f("mdi-close-circle-outline")])),_:1,__:[10]}))])]),_:1})],64)):k("",!0)]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),a(x,null,{default:e(()=>[a(ee,{ref_key:"mailboxForm",ref:I,modelValue:l.value,"onUpdate:modelValue":s[2]||(s[2]=u=>l.value=u)},null,8,["modelValue"])]),_:1})]),_:1})):k("",!0),w.value?(o(),d(g,{key:2,eager:"",value:"aliasForm"},{default:e(()=>[a(b,null,{default:e(({expanded:u})=>[a(_,{"no-gutters":""},{default:e(()=>[a(n,{cols:"4"},{default:e(()=>[f(r(m(i)("Alias")),1)]),_:1}),a(n,{cols:"8",class:""},{default:e(()=>[a(V,{"leave-absolute":""},{default:e(()=>[u?(o(),p("span",ye)):(o(),d(_,{key:1,"no-gutters":"",style:{width:"100%"}},{default:e(()=>[l.value.aliases?(o(),d(n,{key:0,cols:"6"},{default:e(()=>[v("div",Ve,r(m(i)("Number of associated alias:"))+" "+r(l.value.aliases.length),1)]),_:1})):k("",!0)]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),a(x,null,{default:e(()=>[a(ae,{ref_key:"aliasForm",ref:L,modelValue:l.value,"onUpdate:modelValue":s[3]||(s[3]=u=>l.value=u)},null,8,["modelValue"])]),_:1})]),_:1})):k("",!0),$.value?(o(),d(g,{key:3,eager:"",value:"resourcesForm"},{default:e(()=>[a(b,null,{default:e(({expanded:u})=>[a(_,{"no-gutters":""},{default:e(()=>[a(n,{cols:"4"},{default:e(()=>[f(r(m(i)("Resources")),1)]),_:1}),a(n,{cols:"8",class:""},{default:e(()=>[a(V,{"leave-absolute":""},{default:e(()=>[u?(o(),p("span",ge)):(o(),d(_,{key:1,"no-gutters":"",style:{width:"100%"}},{default:e(()=>[l.value.resources!=null&&l.value.resources.length==2?(o(),p(P,{key:0},[a(n,{cols:"6"},{default:e(()=>[v("div",be,r(m(i)("Number of allowed mailboxes:"))+" "+r(l.value.resources[0].max_value),1)]),_:1}),a(n,{cols:"6"},{default:e(()=>[v("div",xe,r(m(i)("Number of allowed mailbox aliases:"))+" "+r(l.value.resources[1].max_value),1)]),_:1})],64)):k("",!0)]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),a(x,null,{default:e(()=>[a(le,{ref_key:"resourcesForm",ref:U,modelValue:l.value.resources,"onUpdate:modelValue":s[4]||(s[4]=u=>l.value.resources=u)},null,8,["modelValue"])]),_:1})]),_:1})):k("",!0)]),_:1},8,["modelValue","multiple"]),v("div",Fe,[a(j,{loading:y.value,variant:"outlined",onClick:s[6]||(s[6]=u=>t.$router.go(-1))},{default:e(()=>[f(r(m(i)("Cancel")),1)]),_:1},8,["loading"]),a(j,{class:"ml-4",color:"primary darken-1",variant:"outlined",loading:y.value,onClick:Q},{default:e(()=>[f(r(m(i)("Save")),1)]),_:1},8,["loading"])])]))}},he={__name:"AccountEditView",setup(q){const{$gettext:i}=D();return(R,F)=>(o(),p(P,null,[a(re,{flat:""},{default:e(()=>[a(ne,null,{default:e(()=>[f(r(m(i)("Edit account")),1)]),_:1})]),_:1}),a(we)],64))}},ea=X(he,[["__scopeId","data-v-4019c7f8"]]);export{ea as default};
