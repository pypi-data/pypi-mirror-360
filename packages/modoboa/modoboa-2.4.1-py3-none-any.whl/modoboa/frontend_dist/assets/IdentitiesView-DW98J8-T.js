import{_ as B,b as j,p as le,g as d,d as ue,r as de,c as h,o as g,w as t,a,n as G,k as w,z as W,j as J,F as oe,D as me,G as ce,t as x,E as pe,f as _,L as O,l as ie,h as T,e as R,i as fe}from"./index-6uM3C9QJ.js";import{_ as K}from"./MenuItems-BKLaU8d3.js";import{_ as X}from"./ConfirmDialog-Ark6TqOm.js";import{a as Y}from"./aliases-rv809tSQ.js";import{V as ve}from"./VDataTable-BMUJtiNY.js";import{d as Z,V as D}from"./index-BTn2TCUq.js";import{V as Q}from"./VMenu-CS4-l2Pu.js";import{V as ye}from"./VChip-DH7R5Ijd.js";import{V as ne,a as _e}from"./VToolbar-Bn743GAp.js";import{V as Ve}from"./VTextField-DI1vrMFe.js";import{V as se,a as ee,b as te}from"./forwardRefs-DzkmOl4h.js";import{V as be}from"./VSpacer-tY9Tuje3.js";import{V as ke}from"./VCheckbox-D-aBRRBQ.js";import{c as ge}from"./VCard-UdW0_Uwo.js";import{_ as xe,a as we}from"./AliasRecipientForm-Cjn3-qvh.js";import{_ as re}from"./CreationForm-DA_iycQ_.js";import{_ as Ce,A as Ae,a as $e,b as he}from"./AccountAliasForm-C5Lezi72.js";import{u as Se}from"./permissions-Dxxy3XiM.js";import{a as L,V as ae}from"./VRow-B8i6Vivu.js";import{u as Fe}from"./domains.store-BRdtIDtL.js";import{_ as Ie,i as Ee}from"./importExport-57vjfPxB.js";import{V as P}from"./VDialog-HV-J7ggg.js";import{V as Ue}from"./VSwitch-CS2VqXpn.js";import"./tag-7q_Qn7dl.js";import"./VProgressCircular-l7s493OQ.js";import"./VSelect-C2sbdVot.js";import"./VCheckboxBtn-CGxH_5Qi.js";import"./VSelectionControl-CgTvwJaW.js";import"./VAvatar-BgULcTRt.js";import"./VTable-Dgv3UJ8N.js";import"./filter-D9eXvGXt.js";import"./ssrBoot-BNifTZr0.js";/* empty css              */import"./EmailField-DoOHEhV4.js";import"./VForm-BM98r94C.js";import"./domains-vJA4hvK9.js";import"./VTextarea-CZcksjj6.js";import"./VWindowItem-Bepzjqqx.js";import"./VContainer-6TaCDL-y.js";import"./VSheet-CpJnecez.js";import"./ChoiceField-BE5A2NOX.js";import"./VAlert-B27KCrh1.js";import"./AccountPasswordSubForm-lQIx0VeZ.js";import"./VFileInput-Dp1IK_eF.js";const q="identities",H={getAll(){return B.get(`${q}/`)},exportAll(){return B.get(`/${q}/export/`)},importFromCSV(N){return B.post(`/${q}/import/`,N,{headers:{"Content-Type":"multipart/form-data"}})}},Re={__name:"IdentityList",setup(N,{expose:y}){const{$gettext:e,$pgettext:E}=j(),U=le(),C=d([{title:e("Name"),key:"identity"},{title:E("female","Enabled"),key:"enabled",width:"5%"},{title:e("Fullname/recipient"),key:"name_or_rcpt"},{title:e("Tags"),key:"tags"},{title:e("Actions"),key:"actions",sortable:!1,align:"end"}]),b=d([]),p=d(!1),A=d(""),V=d([]),o=d(!1),u=d(),k=d();async function l(){p.value=!0;try{const n=await H.getAll();b.value=n.data,V.value=[]}finally{p.value=!1}}function s(n){const c=[];return n.type==="account"?(n.possible_actions.forEach(S=>{c.push({label:S.label,icon:S.icon,onClick:()=>{S.type,l()}})}),c.push({label:e("Edit"),icon:"mdi-circle-edit-outline",onClick:I}),c.push({label:e("Delete"),icon:"mdi-delete-outline",onClick:z,color:"red"})):n.type==="alias"&&(c.push({label:e("Edit"),icon:"mdi-circle-edit-outline",onClick:M}),c.push({label:e("Delete"),icon:"mdi-delete-outline",onClick:$,color:"red"})),c}function F(){const n=[];return V.value.length>0&&n.push({label:e("Delete"),icon:"mdi-delete-outline",onClick:v,color:"red"}),n}function I(n){U.push({name:"AccountEdit",params:{id:n.pk}})}async function z(n){if(await k.value.open(e("Warning"),e("Are you sure you want to delete this identity ?"),{color:"error",agreeLabel:e("Yes"),cancelLabel:e("No")})){p.value=!1;try{await O.delete(n.pk,{keepdir:o.value}),l()}finally{p.value=!1}}}function M(){}function v(){}async function $(n){if(await u.value.open(e("Warning"),e("Are you sure you want to delete this alias?"),{color:"error",agreeLabel:e("Yes"),cancelLabel:e("No")})){p.value=!1;try{await Y.delete(n.pk),l()}finally{p.value=!1}}}return ue(()=>{l()}),y({fetchIdentities:l}),(n,c)=>{const S=de("router-link");return g(),h(ge,{class:"mt-6"},{default:t(()=>[a(ve,{modelValue:V.value,"onUpdate:modelValue":c[1]||(c[1]=r=>V.value=r),headers:C.value,items:b.value,search:A.value,loading:p.value,"item-value":"identity",class:"elevation-0","show-select":""},{top:t(()=>[a(ne,{flat:"",color:"white"},{default:t(()=>[a(Ve,{modelValue:A.value,"onUpdate:modelValue":c[0]||(c[0]=r=>A.value=r),"prepend-inner-icon":"mdi-magnify",placeholder:_(e)("Search"),variant:"outlined","hide-details":"","single-line":"",flat:"",density:"compact",class:"flex-grow-0 w-33 mr-4"},null,8,["modelValue","placeholder"]),pe(n.$slots,"extraActions"),a(Q,{location:"bottom"},{activator:t(({props:r})=>[a(D,W({"append-icon":"mdi-chevron-down"},r,{size:"small",variant:"flat"}),{default:t(()=>[w(x(_(e)("Actions")),1)]),_:2},1040)]),default:t(()=>[a(se,{density:"compact"},{default:t(()=>[a(K,{items:F()},null,8,["items"])]),_:1})]),_:1}),a(D,{variant:"text",icon:"mdi-reload",onClick:l}),a(be)]),_:3})]),"item.identity":t(({item:r})=>[r.type==="account"?(g(),h(S,{key:0,to:{name:"AccountDetail",params:{id:r.pk}}},{default:t(()=>[w(x(r.identity),1)]),_:2},1032,["to"])):(g(),h(S,{key:1,to:{name:"AliasDetail",params:{id:r.pk}}},{default:t(()=>[w(x(r.identity),1)]),_:2},1032,["to"]))]),"item.enabled":t(({item:r})=>[a(Z,{color:r.enabled?"success":"error",icon:r.enabled?"mdi-check-circle":"mdi-close-circle",variant:"flat"},null,8,["color","icon"])]),"item.tags":t(({item:r})=>[(g(!0),J(oe,null,me(r.tags,(i,m)=>(g(),h(ye,{key:i.name,color:i.type!=="idt"?"primary":"default",class:ce(m>0?"ml-2":""),size:"small"},{default:t(()=>[w(x(i.label),1)]),_:2},1032,["color","class"]))),128))]),"item.actions":t(({item:r})=>[r.possible_actions!==void 0&&r.possible_actions.length!==0?(g(),h(Z,{key:0,size:"large",color:"blue"},{default:t(()=>c[3]||(c[3]=[w("mdi-circle-small")])),_:1,__:[3]})):G("",!0),a(Q,{location:"bottom"},{activator:t(({props:i})=>[a(D,W(i,{size:"small",icon:"mdi-dots-horizontal",variant:"text"}),null,16)]),default:t(()=>[a(K,{items:s(r),obj:r},null,8,["items","obj"])]),_:2},1024)]),_:2},1032,["modelValue","headers","items","search","loading"]),a(X,{ref_key:"confirmAlias",ref:u},null,512),a(X,{ref_key:"confirmAccount",ref:k},{default:t(()=>[a(ke,{modelValue:o.value,"onUpdate:modelValue":c[2]||(c[2]=r=>o.value=r),label:_(e)("Do not delete account folder"),"hide-details":""},null,8,["modelValue","label"])]),_:1},512)]),_:3})}}},De={__name:"AliasCreationForm",emits:["close","created"],setup(N,{emit:y}){const{$gettext:e}=j(),E=ie(),U=le(),C=y,b=d(),p=d(),A=d(),V={general:p,recipients:A},o=T(()=>{const v=[{title:e("General"),items:[{key:e("Random address"),value:u.value.random,type:"yesno"},{key:e("Address"),value:u.value.address}]}];return u.value.expire_at!==void 0&&v[0].items.push({key:e("Expire at"),value:u.value.expire_at}),u.value.description!==void 0&&v[0].items.push({key:e("Description"),value:u.value.description}),v.push({title:e("Recipients"),items:[{key:e("Recipients"),value:u.value.recipients.join(", ")}]}),v}),u=d(s()),k=d([{name:"general",title:e("General")},{name:"recipients",title:e("Recipients")}]);function l(){u.value=s(),C("close")}function s(){return{random:!1,enabled:!0,recipients:[]}}function F(v){return V.step[v.name]}function I(v){return V[v.name].value.vFormRef}function z(){const v={...u.value};v.recipients.length===0&&delete v.recipients;const $=Y.validate(v);return $.catch(n=>{n.response.status===409&&n.response.data.id!==void 0&&(E.displayNotification({msg:e("Alias already exists, redirecting to edit page"),type:"warning"}),U.push({name:"AliasEdit",params:{id:n.response.data.id}}))}),$}async function M(){u.value.domain!==void 0&&delete u.value.domain;try{await Y.create(u.value),C("created"),l()}finally{b.value.working=!1}}return(v,$)=>(g(),h(re,{ref_key:"form",ref:b,title:_(e)("New alias"),steps:k.value,"form-getter":F,"get-v-form-ref":I,"validate-object":z,"summary-sections":o.value,onClose:l,onCreate:M},{"form.general":t(()=>[a(we,{ref_key:"general",ref:p,modelValue:u.value,"onUpdate:modelValue":$[0]||($[0]=n=>u.value=n)},null,8,["modelValue"])]),"form.recipients":t(()=>[a(xe,{ref_key:"recipients",ref:A,modelValue:u.value.recipients,"onUpdate:modelValue":$[1]||($[1]=n=>u.value.recipients=n)},null,8,["modelValue"])]),_:2},1032,["title","steps","summary-sections"]))}},Le={class:"grey--text"},Ne={__name:"AccountCreationForm",emits:["close","created"],setup(N,{emit:y}){const{$gettext:e}=j(),{canSetRole:E}=Se(),U=ie(),C=Fe(),b=y,p=T(()=>o.value.role!=="SuperAdmins"&&o.value.username&&o.value.username.indexOf("@")!==-1),A=T(()=>{const i=[{title:e("Role"),items:[{key:e("Role"),value:o.value.role}]},{title:e("Identification"),items:[{key:e("Username"),value:o.value.username},{key:e("First name"),value:o.value.first_name},{key:e("Last name"),value:o.value.last_name},{name:"random_password",key:e("Random password"),value:o.value.random_password,type:"yesno"},{key:e("Enabled"),value:o.value.is_active,type:"yesno"}]}];return p.value?i.concat([{title:e("Mailbox"),items:[{key:e("Email"),value:o.value.mailbox.full_address},{key:e("Quota"),value:o.value.mailbox.use_domain_quota?e("Domain default value"):o.value.mailbox.quota},{key:e("Message sending limit"),value:o.value.mailbox.message_limit},{key:e("Send only account"),value:o.value.mailbox.is_send_only,type:"yesno"}]},{title:e("Aliases"),items:[{key:e("Aliases"),value:o.value.aliases,type:"list"}]}]):i}),V=T(()=>{const i=[];return E.value&&i.push({name:"role",title:e("Role")}),i.push({name:"identification",title:e("Identification")}),p.value?i.concat([{name:"mailbox",title:e("Mailbox")},{name:"aliases",title:e("Aliases")}]):i}),o=d({aliases:[],is_active:!0,role:"SimpleUsers",mailbox:{use_domain_quota:!0},random_password:!1}),u=d(),k=d(),l=d(),s=d(),F=d(),I={role:k,identification:l,mailbox:s,aliases:F};function z(){navigator.clipboard.writeText(o.value.new_password).then(()=>{U.displayNotification({msg:e("Password copied to clipboard")})})}function M(i){return I.step[i.name]}function v(i){return I[i.name].value.vFormRef}function $(i,m){const f=V.value[i-1].name;I[f].value.formErrors&&(I[f].value.formErrors.value=m)}function n(i){const m={...i};return m.role==="SuperAdmins"&&m.username&&m.username.indexOf("@")===-1&&delete m.mailbox,m.mailbox&&m.mailbox.message_limit===""&&(m.mailbox.message_limit=null),m}function c(){const i=n({...o.value});return O.validate(i)}function S(){b("close")}async function r(){const i=n({...o.value});i.password=i.new_password,delete i.new_password,delete i.password_confirmation;try{await O.create(i),b("created"),S()}finally{u.value.working=!1}}return C.getDomains(),(i,m)=>(g(),h(re,{ref_key:"form",ref:u,title:_(e)("New account"),steps:V.value,"form-getter":M,"get-v-form-ref":v,"validate-object":c,"summary-sections":A.value,onClose:S,onCreate:r,onValidationError:$},{"form.role":t(()=>[a(he,{ref_key:"role",ref:k,modelValue:o.value,"onUpdate:modelValue":m[0]||(m[0]=f=>o.value=f)},null,8,["modelValue"])]),"form.identification":t(()=>[a($e,{ref_key:"identification",ref:l,modelValue:o.value,"onUpdate:modelValue":m[1]||(m[1]=f=>o.value=f)},null,8,["modelValue"])]),"form.mailbox":t(()=>[a(Ae,{ref_key:"mailbox",ref:s,modelValue:o.value,"onUpdate:modelValue":m[2]||(m[2]=f=>o.value=f)},null,8,["modelValue"])]),"form.aliases":t(()=>[a(Ce,{ref_key:"aliases",ref:F,modelValue:o.value,"onUpdate:modelValue":m[3]||(m[3]=f=>o.value=f)},null,8,["modelValue"])]),"item.random_password":t(({item:f})=>[f.value?(g(),h(L,{key:0,cols:"12",class:"highligth text-white"},{default:t(()=>[a(ae,null,{default:t(()=>[a(L,null,{default:t(()=>[R("span",null,x(f.key),1)]),_:2},1024),f.type==="yesno"?(g(),h(L,{key:0,class:"text-right"},{default:t(()=>[w(x(i.$yesno(f.value)),1)]),_:2},1024)):G("",!0)]),_:2},1024),a(ae,null,{default:t(()=>[a(L,{class:"text-right py-1"},{default:t(()=>[a(D,{"append-icon":"mdi-clipboard-multiple-outline",color:"white",variant:"text",title:_(e)("Copy to clipboard"),onClick:z},{default:t(()=>[w(x(o.value.new_password),1)]),_:1},8,["title"])]),_:1})]),_:1})]),_:2},1024)):(g(),J(oe,{key:1},[a(L,null,{default:t(()=>[R("span",Le,x(f.key),1)]),_:2},1024),f.type==="yesno"?(g(),h(L,{key:0,class:"text-right"},{default:t(()=>[w(x(i.$yesno(f.value)),1)]),_:2},1024)):G("",!0)],64))]),_:2},1032,["title","steps","summary-sections"]))}},ze={__name:"IdentitiesView",setup(N){const{$gettext:y,$pgettext:e}=j(),{importContent:E,exportContent:U}=Ee(),C=d(!1),b=d(!1),p=d(!1),A=d(),V=d();function o(){H.exportAll().then(k=>{U(k.data,"identities",y)})}function u(k,l){k.append("crypt_passwords",l.crypt_passwords),E(H,k,A,y)}return(k,l)=>(g(),J("div",null,[a(ne,{flat:""},{default:t(()=>[a(_e,null,{default:t(()=>[w(x(_(y)("Identities")),1)]),_:1})]),_:1}),a(Re,{ref_key:"idList",ref:V},{extraActions:t(()=>[a(Q,{"offset-y":""},{activator:t(({props:s})=>[a(D,W({color:"primary",variant:"outlined"},s,{"prepend-icon":"mdi-plus",class:"mr-4"}),{default:t(()=>[w(x(_(e)("male","New")),1)]),_:2},1040)]),default:t(()=>[a(se,{density:"compact"},{default:t(()=>[a(ee,{onClick:l[0]||(l[0]=s=>C.value=!0)},{default:t(()=>[a(te,null,{default:t(()=>[w(x(_(y)("Account")),1)]),_:1})]),_:1}),a(ee,{onClick:l[1]||(l[1]=s=>b.value=!0)},{default:t(()=>[a(te,null,{default:t(()=>[w(x(_(y)("Alias")),1)]),_:1})]),_:1})]),_:1})]),_:1}),a(D,{class:"mr-2",title:_(y)("Import accounts and aliases from CSV file"),variant:"flat",icon:"mdi-file-import-outline",onClick:l[2]||(l[2]=s=>p.value=!0)},null,8,["title"]),a(D,{class:"mr-2",title:_(y)("Export accounts and aliases to CSV"),icon:"mdi-file-export-outline",variant:"flat",onClick:o},null,8,["title"])]),_:1},512),a(P,{modelValue:b.value,"onUpdate:modelValue":l[5]||(l[5]=s=>b.value=s),fullscreen:"",scrollable:"","z-index":"10"},{default:t(()=>[a(De,{onCreated:l[3]||(l[3]=s=>V.value.fetchIdentities()),onClose:l[4]||(l[4]=s=>b.value=!1)})]),_:1},8,["modelValue"]),a(P,{modelValue:C.value,"onUpdate:modelValue":l[8]||(l[8]=s=>C.value=s),fullscreen:"",scrollable:"","z-index":"10"},{default:t(()=>[a(Ne,{onCreated:l[6]||(l[6]=s=>V.value.fetchIdentities()),onClose:l[7]||(l[7]=s=>C.value=!1)})]),_:1},8,["modelValue"]),a(P,{modelValue:p.value,"onUpdate:modelValue":l[10]||(l[10]=s=>p.value=s),persistent:"","max-width":"800px"},{default:t(()=>[a(_(Ie),{ref_key:"importForm",ref:A,title:_(y)("Import identities"),onSubmit:u,onClose:l[9]||(l[9]=s=>p.value=!1)},{help:t(()=>l[11]||(l[11]=[R("ul",null,[R("li",null,[R("em",null,"account; loginname; password; first name; last name; enabled; group; address; quota; [, domain, ...]")]),R("li",null,[R("em",null,"alias; address; enabled; recipient; [more recipients; ...]")])],-1)])),extraFields:t(({form:s})=>[a(Ue,{modelValue:s.crypt_passwords,"onUpdate:modelValue":F=>s.crypt_passwords=F,label:_(y)("Crypt passwords"),color:"primary",density:"compact",hint:_(y)("Check this option if passwords contained in your file are not crypted"),"persistent-hint":""},null,8,["modelValue","onUpdate:modelValue","label","hint"])]),_:1},8,["title"])]),_:1},8,["modelValue"])]))}},St=fe(ze,[["__scopeId","data-v-2549d1b3"]]);export{St as default};
