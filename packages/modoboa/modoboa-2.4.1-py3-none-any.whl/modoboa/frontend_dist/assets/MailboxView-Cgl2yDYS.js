import{q as te,s as le,am as se,v as oe,h as O,a6 as ne,e as d,z as ie,A as re,G as X,i as ue,b as de,l as ce,g as h,K as me,d as ve,$ as pe,J,j as _,a as s,c as v,w as b,n as $,ba as ge,f,t as m,F as q,D as fe,p as ke,o as r}from"./index-6uM3C9QJ.js";import{a as x}from"./webmail-CURzuE4B.js";import{V as he}from"./VToolbar-Bn743GAp.js";import{V as F}from"./VCheckbox-D-aBRRBQ.js";import{V as be}from"./VTextField-DI1vrMFe.js";import{q as xe,r as ye,V as y,d as A}from"./index-BTn2TCUq.js";import{V as _e}from"./VMenu-CS4-l2Pu.js";import{V as Ve,a as B}from"./forwardRefs-DzkmOl4h.js";import{V as U}from"./VSpacer-tY9Tuje3.js";import{c as D,a as Ce}from"./VCard-UdW0_Uwo.js";import{u as we}from"./VProgressCircular-l7s493OQ.js";import{b as Se,u as Me,c as $e}from"./tag-7q_Qn7dl.js";import{V as Be}from"./VAlert-B27KCrh1.js";import"./VCheckboxBtn-CGxH_5Qi.js";import"./VSelectionControl-CgTvwJaW.js";import"./ssrBoot-BNifTZr0.js";import"./VAvatar-BgULcTRt.js";/* empty css              */const Le={actions:"button@2",article:"heading, paragraph",avatar:"avatar",button:"button",card:"image, heading","card-avatar":"image, list-item-avatar",chip:"chip","date-picker":"list-item, heading, divider, date-picker-options, date-picker-days, actions","date-picker-options":"text, avatar@2","date-picker-days":"avatar@28",divider:"divider",heading:"heading",image:"image","list-item":"text","list-item-avatar":"avatar, text","list-item-two-line":"sentences","list-item-avatar-two-line":"avatar, sentences","list-item-three-line":"paragraph","list-item-avatar-three-line":"avatar, paragraph",ossein:"ossein",paragraph:"text@3",sentences:"text@2",subtitle:"text",table:"table-heading, table-thead, table-tbody, table-tfoot","table-heading":"chip, text","table-thead":"heading@6","table-tbody":"table-row-divider@6","table-row-divider":"table-row, divider","table-row":"text@6","table-tfoot":"text@2, avatar@2",text:"text"};function Ae(a){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return d("div",{class:X(["v-skeleton-loader__bone",`v-skeleton-loader__${a}`])},[o])}function R(a){const[o,e]=a.split("@");return Array.from({length:e}).map(()=>z(o))}function z(a){let o=[];if(!a)return o;const e=Le[a];if(a!==e){if(a.includes(","))return K(a);if(a.includes("@"))return R(a);e.includes(",")?o=K(e):e.includes("@")?o=R(e):e&&o.push(z(e))}return[Ae(a,o)]}function K(a){return a.replace(/\s/g,"").split(",").map(z)}const ze=le({boilerplate:Boolean,color:String,loading:Boolean,loadingText:{type:String,default:"$vuetify.loading"},type:{type:[String,Array],default:"ossein"},...$e(),...ye(),...re()},"VSkeletonLoader"),Ee=te()({name:"VSkeletonLoader",props:ze(),setup(a,o){let{slots:e}=o;const{backgroundColorClasses:V,backgroundColorStyles:M}=we(()=>a.color),{dimensionStyles:E}=Se(a),{elevationClasses:I}=xe(a),{themeClasses:p}=se(a),{t:i}=oe(),C=O(()=>z(ne(a.type).join(",")));return Me(()=>{var n;const g=!e.default||a.loading,w=a.boilerplate||!g?{}:{ariaLive:"polite",ariaLabel:i(a.loadingText),role:"alert"};return d("div",ie({class:["v-skeleton-loader",{"v-skeleton-loader--boilerplate":a.boilerplate},p.value,V.value,I.value],style:[M.value,g?E.value:{}]},w),[g?C.value:(n=e.default)==null?void 0:n.call(e)])}),{}}}),Ie={key:2,class:"d-flex align-center"},Ne={class:"text-caption mr-2"},Te={key:1,class:"emails position-absolute top-0 bottom-0 w-100 overflow-y-auto"},Je=["onClick"],Pe={class:"mt-1 text-grey"},je=["title"],qe={key:1},Fe={class:"text-right"},Ue={class:"mt-1"},De={class:"text-grey"},Re={__name:"EmailList",props:{mailbox:{type:String,default:"INBOX"}},setup(a){const o=a,{$gettext:e}=de(),{displayNotification:V,reloadMailboxCounters:M}=ce(),E=ke(),I=me(),p=h(!1),i=h({}),C=h(1),g=h(""),w=h(!1),n=h([]),c=h(!1);let P=null;const S=O(()=>I.query.mailbox||"INBOX"),G=u=>{E.push({name:"EmailView",query:{mailbox:o.mailbox,mailid:u}})},k=()=>{i.value={},p.value=!0,x.getMailboxEmails(o.mailbox,{page:C.value,search:g.value}).then(u=>{i.value=u.data,p.value=!1}).catch(()=>{p.value=!1})},N=()=>{k()},W=()=>{g.value&&k()},H=u=>{u?n.value=i.value.results.map(t=>t.imapid):n.value=[]},Q=()=>{n.value.length&&(c.value=!0,x.deleteSelection(S.value,n.value).then(()=>{c.value=!1,V({msg:e("Message(s) deleted")}),k(),M()}))},Y=()=>{n.value.length&&(c.value=!0,x.markSelectionAsJunk(S.value,n.value).then(()=>{c.value=!1,V({msg:e("Message(s) marked as junk")}),N()}))},Z=()=>{n.value.length&&(c.value=!0,x.markSelectionAsNotJunk(S.value,n.value).then(()=>{c.value=!1,V({msg:e("Message(s) marked as not junk")}),N()}))},L=u=>{n.value.length&&(c.value=!0,x.flagSelection(S.value,n.value,u).then(()=>{c.value=!1,n.value=[],V({msg:e("Message(s) flagged")}),k(),M()}))},ee=()=>{p.value=!0,x.emptyUserMailbox(S.value).then(()=>{i.value={},p.value=!1,M()})},ae=async u=>{const t=u.flagged?"unflagged":"flagged";await x.flagSelection(S.value,[u.imapid],t),u.flagged=t==="flagged"};return ve(()=>{P=setInterval(N,300*1e3)}),pe(()=>{clearInterval(P)}),J(()=>o.mailbox,()=>{k()},{immediate:!0}),J(n,()=>{n.value.length?w.value=!0:w.value=!1}),J(C,()=>{k()}),(u,t)=>{var j;return r(),_(q,null,[s(D,{class:"mt-6 mb-2 mx-1"},{default:b(()=>[s(he,{color:"white",flat:""},{default:b(()=>[s(F,{modelValue:w.value,"onUpdate:modelValue":[t[0]||(t[0]=l=>w.value=l),H],class:"mr-4","hide-details":""},null,8,["modelValue"]),s(be,{modelValue:g.value,"onUpdate:modelValue":t[1]||(t[1]=l=>g.value=l),"prepend-inner-icon":"mdi-magnify",placeholder:f(e)("Search in messages"),variant:"outlined","single-line":"",flat:"","hide-details":"",density:"compact",class:"flex-grow-0 w-33 mr-4",clearable:"","onClick:clear":k,onKeyup:ge(W,["enter"])},null,8,["modelValue","placeholder"]),s(y,{class:"ml-2",color:"error",variant:"tonal",icon:"mdi-trash-can",size:"small",loading:c.value,onClick:Q},null,8,["loading"]),u.$route.params.mailbox!=="Junk"?(r(),v(y,{key:0,class:"ml-2",color:"warning",variant:"tonal",icon:"mdi-fire",size:"small",loading:c.value,onClick:Y},null,8,["loading"])):(r(),v(y,{key:1,class:"ml-2",color:"success",variant:"tonal",icon:"mdi-thumb-up",size:"small",loading:c.value,onClick:Z},null,8,["loading"])),s(y,{class:"ml-2",variant:"tonal",icon:"",size:"small"},{default:b(()=>[s(A,{icon:"mdi-cog"}),s(_e,{activator:"parent"},{default:b(()=>[s(Ve,{density:"compact"},{default:b(()=>[s(B,{title:f(e)("Mark as read"),"prepend-icon":"mdi-eye",onClick:t[2]||(t[2]=()=>L("read"))},null,8,["title"]),s(B,{title:f(e)("Mark as unread"),"prepend-icon":"mdi-eye-outline",onClick:t[3]||(t[3]=()=>L("unread"))},null,8,["title"]),s(B,{title:f(e)("Mark as followed"),"prepend-icon":"mdi-star",onClick:t[4]||(t[4]=()=>L("flagged"))},null,8,["title"]),s(B,{title:f(e)("Mark as unfollowed"),"prepend-icon":"mdi-star-outline",onClick:t[5]||(t[5]=()=>L("unflagged"))},null,8,["title"]),u.$route.params.mailbox!=="Trash"?(r(),v(B,{key:0,title:f(e)("Empty mailbox"),"prepend-icon":"mdi-trash-can",onClick:ee},null,8,["title"])):$("",!0)]),_:1})]),_:1})]),_:1}),s(U),i.value.results?(r(),_("div",Ie,[d("div",Ne,m(i.value.first_index)+"-"+m(i.value.last_index)+" "+m(f(e)("on"))+" "+m(i.value.count),1),d("div",null,[s(y,{icon:"mdi-chevron-left",size:"x-small",disabled:i.value.prev_page===null,onClick:t[6]||(t[6]=l=>C.value=i.value.prev_page)},null,8,["disabled"]),s(y,{icon:"mdi-chevron-right",size:"x-small",disabled:i.value.next_page===null,onClick:t[7]||(t[7]=l=>C.value=i.value.next_page)},null,8,["disabled"])])])):$("",!0)]),_:1})]),_:1}),p.value?(r(),v(Ee,{key:0,type:"card@2"})):(r(),_("div",Te,[(j=i.value.results)!=null&&j.length?(r(!0),_(q,{key:0},fe(i.value.results,l=>(r(),v(D,{key:l.imapid,density:"compact",class:"mb-2 mx-1"},{default:b(()=>[s(Ce,{class:X(["d-flex align-center",{"font-weight-bold":l.style==="unseen"}])},{default:b(()=>[s(F,{modelValue:n.value,"onUpdate:modelValue":t[8]||(t[8]=T=>n.value=T),value:l.imapid,"hide-details":""},null,8,["modelValue","value"]),s(y,{icon:l.flagged?"mdi-star":"mdi-star-outline",variant:"flat",onClick:T=>ae(l)},null,8,["icon","onClick"]),d("div",{class:"ml-4 clickable",onClick:T=>G(l.imapid)},[d("div",null,m(l.subject),1),d("div",Pe,[l.from_address.name?(r(),_("span",{key:0,title:l.from_address.address},m(l.from_address.name),9,je)):(r(),_("span",qe,m(l.from_address.address),1))])],8,Je),s(U),d("div",Fe,[d("div",null,m(l.date),1),d("div",Ue,[l.answered?(r(),v(A,{key:0,icon:"mdi-reply-outline"})):$("",!0),l.forwarded?(r(),v(A,{key:1,icon:"mdi-share-outline"})):$("",!0),l.attachments?(r(),v(A,{key:2,icon:"mdi-paperclip"})):$("",!0),d("span",De,m(u.$filesize(l.size)),1)])])]),_:2},1032,["class"])]),_:2},1024))),128)):(r(),v(Be,{key:1,class:"mt-4",type:"info",text:f(e)("No message yet in this mailbox"),variant:"tonal"},null,8,["text"]))]))],64)}}},Ke=ue(Re,[["__scopeId","data-v-0050ed0f"]]),Oe={class:"position-relative h-100"},Xe={class:"text-h5 ml-4"},ma={__name:"MailboxView",setup(a){return(o,e)=>(r(),_("div",Oe,[d("div",Xe,m(o.$gettext("Webmail")),1),s(Ke,{mailbox:o.$route.query.mailbox||"INBOX"},null,8,["mailbox"])]))}};export{ma as default};
