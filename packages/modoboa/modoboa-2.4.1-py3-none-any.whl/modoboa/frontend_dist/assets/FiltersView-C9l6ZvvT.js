import{b as ne,l as ie,g as v,c as _,o as f,w as p,a as t,f as o,af as k,q as fe,s as ve,z as J,ag as Ue,h as ae,P as Ae,ah as Re,I as se,Q as Ne,e as I,F as T,J as K,j as R,n as j,t as G,D as ee,K as $e,p as Ie,k as te}from"./index-6uM3C9QJ.js";import{V as re,r as D}from"./VForm-BM98r94C.js";import{a as pe,b as Ve,c as ye}from"./VCard-UdW0_Uwo.js";import{V as Q,a as ue,m as Pe,b as Oe}from"./VTextField-DI1vrMFe.js";import{V as be}from"./VSwitch-CS2VqXpn.js";import{c as ge}from"./forwardRefs-DzkmOl4h.js";import{V as Fe}from"./VSpacer-tY9Tuje3.js";import{V as S,d as De}from"./index-BTn2TCUq.js";import{V as oe,m as Te,a as je,b as qe}from"./VSelectionControl-CgTvwJaW.js";import{u as ke}from"./tag-7q_Qn7dl.js";import{V as z}from"./VSelect-C2sbdVot.js";import{V as Be}from"./VCheckbox-D-aBRRBQ.js";import{_ as de}from"./MenuItems-BKLaU8d3.js";import{V as Ee}from"./VToolbar-Bn743GAp.js";import{V as Ge}from"./VDataTable-BMUJtiNY.js";import{V as me}from"./VDialog-HV-J7ggg.js";import{V as Le}from"./VAutocomplete-CmWiskVY.js";import{V as ce}from"./VMenu-CS4-l2Pu.js";import{V as Me}from"./VTextarea-CZcksjj6.js";import"./VAvatar-BgULcTRt.js";import"./VProgressCircular-l7s493OQ.js";import"./ssrBoot-BNifTZr0.js";/* empty css              */import"./VCheckboxBtn-CGxH_5Qi.js";import"./VChip-DH7R5Ijd.js";import"./VTable-Dgv3UJ8N.js";import"./filter-D9eXvGXt.js";const Je={__name:"FilterSetForm",emits:["close"],setup(V,{emit:U}){const{$gettext:m}=ne(),g=U,i=ie(),l=v({}),h=v(),y=v(!1);function a(){h.value.reset(),l.value={},g("close")}async function A(){const{valid:r}=await h.value.validate();if(r){y.value=!0;try{await k.createFilterSet(l.value),i.displayNotification({msg:m("Filter set created")}),a()}finally{y.value=!1}}}return(r,w)=>(f(),_(ye,{title:o(m)("Create a new filter set")},{default:p(()=>[t(pe,null,{default:p(()=>[t(re,{ref_key:"formRef",ref:h},{default:p(()=>[t(Q,{modelValue:l.value.name,"onUpdate:modelValue":w[0]||(w[0]=C=>l.value.name=C),label:o(m)("Name"),variant:"outlined",rules:[o(D).required]},null,8,["modelValue","label","rules"]),t(be,{label:o(m)("Active"),modelValue:l.value.active,"onUpdate:modelValue":w[1]||(w[1]=C=>l.value.active=C),color:"primary"},null,8,["label","modelValue"])]),_:1},512)]),_:1}),t(ge),t(Ve,null,{default:p(()=>[t(Fe),t(S,{text:o(m)("Cancel"),variant:"plain",onClick:a},null,8,["text"]),t(S,{color:"primary",text:o(m)("Create"),onClick:A},null,8,["text"])]),_:1})]),_:1},8,["title"]))}},ze=ve({...Te({falseIcon:"$radioOff",trueIcon:"$radioOn"})},"VRadio"),le=fe()({name:"VRadio",props:ze(),setup(V,U){let{slots:m}=U;return ke(()=>{const g=oe.filterProps(V);return t(oe,J(g,{class:["v-radio",V.class],style:V.style,type:"radio"}),m)}),{}}}),Ke=ve({height:{type:[Number,String],default:"auto"},...Pe(),...Ne(je(),["multiple"]),trueIcon:{type:se,default:"$radioOn"},falseIcon:{type:se,default:"$radioOff"},type:{type:String,default:"radio"}},"VRadioGroup"),Qe=fe()({name:"VRadioGroup",inheritAttrs:!1,props:Ke(),emits:{"update:modelValue":V=>!0},setup(V,U){let{attrs:m,slots:g}=U;const i=Ue(),l=ae(()=>V.id||`radio-group-${i}`),h=Ae(V,"modelValue");return ke(()=>{const[y,a]=Re(m),A=ue.filterProps(V),r=oe.filterProps(V),w=g.label?g.label({label:V.label,props:{for:l.value}}):V.label;return t(ue,J({class:["v-radio-group",V.class],style:V.style},y,A,{modelValue:h.value,"onUpdate:modelValue":C=>h.value=C,id:l.value}),{...g,default:C=>{let{id:N,messagesId:P,isDisabled:$,isReadonly:x}=C;return I(T,null,[w&&t(Oe,{id:N.value},{default:()=>[w]}),t(qe,J(r,{id:N.value,"aria-describedby":P.value,defaultsTarget:"VRadio",trueIcon:V.trueIcon,falseIcon:V.falseIcon,type:V.type,disabled:$.value,readonly:x.value,"aria-labelledby":w?N.value:void 0,multiple:!1},a,{modelValue:h.value,"onUpdate:modelValue":L=>h.value=L}),g)])}})}),{}}}),He={class:"bg-grey-lighten-4 rounded pa-3"},We={class:"mt-4 bg-grey-lighten-4 rounded pa-3"},Xe={class:"mx-2 d-flex flex-column flex-grow-1"},Ye={__name:"FilterForm",props:{filterSet:{type:String,default:null},filter:{type:Object,required:!1,default:null}},emits:["close"],setup(V,{emit:U}){const m=V,g=U,i=ie(),{$gettext:l}=ne(),h=v({}),y=v([]),a=v([]),A=v(),r=v(x()),w=v(!1),C=ae(()=>m.filter?l("Edit filter"):l("New filter")),N=ae(()=>m.filter?l("Update"):l("Create"));let P;K(()=>m.filter,c=>{c?(r.value=JSON.parse(JSON.stringify(c)),P=c.name):r.value=x()},{immediate:!0});function $(){g("close"),r.value=x()}function x(){return{match_type:"anyof",conditions:[{}],actions:[{args:{}}]}}function L(c){for(const b of y.value)if(b.name===c)return b.operators;return[]}function H(c){for(const b of y.value)if(b.name===r.value.conditions[c].name){for(const s of b.operators)if(s.name===r.value.conditions[c].operator)return s.type==="string"?"text":"number"}}function W(c){for(const b of a.value)if(b.name===c)return b.args;return[]}function X(){r.value.conditions.push({name:y.value[0].name,operator:y.value[0].operators[0].name})}function M(c){r.value.conditions.splice(c,1)}function O(){r.value.actions.push({name:a.value[0].name,args:{}})}function Y(c){r.value.actions.splice(c,1)}async function Z(){const{valid:c}=await A.value.validate();if(!c)return;w.value=!0;let b;const s=JSON.parse(JSON.stringify(r.value));for(const F of s.actions)for(const[d,E]of Object.entries(F.args))typeof E=="boolean"&&!E&&delete F.args[d];try{m.filter?(await k.updateFilter(m.filterSet,P,s),b=l("Filter updated")):(await k.createFilter(m.filterSet,s),b=l("Filter added"))}catch(F){F.response.status===400&&F.response.data&&(h.value=F.response.data);return}finally{w.value=!1}i.displayNotification({msg:b}),$()}return k.getFilterConditionTemplates().then(c=>{y.value=c.data,m.filter||(r.value.conditions[0].name=y.value[0].name,r.value.conditions[0].operator=y.value[0].operators[0].name)}),k.getFilterActionTemplates().then(c=>{a.value=c.data,m.filter||(r.value.actions[0].name=a.value[0].name)}),(c,b)=>(f(),_(ye,{title:C.value},{default:p(()=>[t(pe,null,{default:p(()=>[t(re,{ref_key:"formRef",ref:A},{default:p(()=>[t(Q,{modelValue:r.value.name,"onUpdate:modelValue":b[0]||(b[0]=s=>r.value.name=s),label:o(l)("Name"),variant:"outlined",density:"compact",rules:[o(D).required],"error-messages":h.value.name?h.value.name:[]},null,8,["modelValue","label","rules","error-messages"]),I("div",He,[I("h4",null,G(o(l)("Conditions")),1),t(Qe,{modelValue:r.value.match_type,"onUpdate:modelValue":b[1]||(b[1]=s=>r.value.match_type=s),color:"primary",inline:""},{default:p(()=>[t(le,{label:o(l)("All of the following"),value:"allof"},null,8,["label"]),t(le,{label:o(l)("Any of the following"),value:"anyof"},null,8,["label"]),t(le,{label:o(l)("All messages"),value:"all"},null,8,["label"])]),_:1},8,["modelValue"]),r.value.match_type!=="all"?(f(!0),R(T,{key:0},ee(r.value.conditions,(s,F)=>(f(),R("div",{key:`condition-${F}`,class:"d-flex align-start"},[t(z,{modelValue:s.name,"onUpdate:modelValue":d=>s.name=d,label:o(l)("Choose a header"),items:y.value,"item-title":"label","item-value":"name",variant:"outlined",density:"compact",rules:[o(D).required]},null,8,["modelValue","onUpdate:modelValue","label","items","rules"]),t(z,{modelValue:s.operator,"onUpdate:modelValue":d=>s.operator=d,label:o(l)("Choose an operator"),items:L(s.name),"item-title":"label","item-value":"name",variant:"outlined",class:"ml-2",density:"compact",rules:[o(D).required]},null,8,["modelValue","onUpdate:modelValue","label","items","rules"]),t(Q,{modelValue:s.value,"onUpdate:modelValue":d=>s.value=d,label:o(l)("Value"),variant:"outlined",class:"ml-2",density:"compact",type:H(F),rules:[o(D).required]},null,8,["modelValue","onUpdate:modelValue","label","type","rules"]),F===0?(f(),_(S,{key:0,icon:"mdi-plus",variant:"text",title:o(l)("Add condition"),color:"primary",onClick:X},null,8,["title"])):(f(),_(S,{key:1,icon:"mdi-trash-can",variant:"text",title:o(l)("Remove condition"),color:"error",onClick:d=>M(F)},null,8,["title","onClick"]))]))),128)):j("",!0)]),I("div",We,[I("h4",null,G(o(l)("Actions")),1),(f(!0),R(T,null,ee(r.value.actions,(s,F)=>(f(),R("div",{key:`action-${F}`,class:"d-flex align-start mt-2"},[t(z,{modelValue:s.name,"onUpdate:modelValue":d=>s.name=d,label:o(l)("Choose an action"),items:a.value,"item-title":"label","item-value":"name",variant:"outlined",density:"compact",class:"flex-grow-0"},null,8,["modelValue","onUpdate:modelValue","label","items"]),I("div",Xe,[(f(!0),R(T,null,ee(W(s.name),(d,E)=>(f(),R(T,{key:`arg-${F}-${E}`},[d.type==="list"?(f(),_(z,{key:0,modelValue:s.args[d.name],"onUpdate:modelValue":q=>s.args[d.name]=q,items:d.choices,"item-title":"label",density:"compact",variant:"outlined",rules:[o(D).required]},null,8,["modelValue","onUpdate:modelValue","items","rules"])):j("",!0),d.type==="string"?(f(),_(Q,{key:1,modelValue:s.args[d.name],"onUpdate:modelValue":q=>s.args[d.name]=q,density:"compact",variant:"outlined",rules:[o(D).required]},null,8,["modelValue","onUpdate:modelValue","rules"])):j("",!0),d.type==="boolean"?(f(),_(Be,{key:2,modelValue:s.args[d.name],"onUpdate:modelValue":q=>s.args[d.name]=q,label:d.label,color:"primary",value:d.value,density:"compact"},null,8,["modelValue","onUpdate:modelValue","label","value"])):j("",!0)],64))),128))]),F===0?(f(),_(S,{key:0,icon:"mdi-plus",variant:"text",title:o(l)("Add action"),color:"primary",onClick:O},null,8,["title"])):(f(),_(S,{key:1,icon:"mdi-trash-can",variant:"text",title:o(l)("Remove action"),color:"error",onClick:d=>Y(F)},null,8,["title","onClick"]))]))),128))])]),_:1},512)]),_:1}),t(ge),t(Ve,null,{default:p(()=>[t(Fe),t(S,{text:o(l)("Cancel"),variant:"elevated",onClick:$},null,8,["text"]),t(S,{color:"primary",variant:"elevated",text:N.value,loading:w.value,onClick:Z},null,8,["text","loading"])]),_:1})]),_:1},8,["title"]))}},Ze={class:"pa-4"},et={class:"text-h6 font-weight-regular mb-4"},tt={key:0,class:"bg-white mt-4 pa-2"},lt={class:"d-flex align-center"},Rt={__name:"FiltersView",setup(V){const U=Ie(),m=$e(),g=ie(),{$gettext:i}=ne(),l=v([]),h=v([]),y=v(""),a=v(),A=v(!1),r=v([]),w=v(),C=v(!1),N=v(!1),P=v(null),$=v(!1),x=v(!1),L=[{title:i("Name"),key:"name"},{title:i("Active"),key:"enabled"},{title:"",key:"filter_actions",align:"end"}];K(a,e=>{e?(O(e.name),m.params.filterset!==e.name&&U.push({name:"AccountFilters",params:{filterset:e.name}})):U.push({name:"AccountFilters"})}),K(C,e=>{e?k.downloadFilterSet(a.value.name).then(n=>{y.value=n.data}):O(a.value.name)}),K(y,()=>{r.value.length&&(r.value=[])});function H(e){let n=e.name;return e.active?n+=" ("+i("active")+")":n+=" ("+i("inactive")+")",n}function W(){$.value=!1,M()}function X(){x.value=!1,P.value=null,O(a.value.name)}function M(){k.getFilterSets().then(e=>{if(e.data.length>0&&e.data[0].active&&e.data[0].name===null?l.value=e.data.slice(1):l.value=e.data,!a.value&&m.params.filterset){for(const n of l.value)if(n.name===m.params.filterset){a.value=n;break}}})}function O(e){A.value=!0,k.getFilters(e).then(n=>{h.value=n.data,A.value=!1}).catch(n=>{n.response.status===518&&(C.value=!0,g.displayNotification({msg:i("Failed to display template. Using raw mode"),type:"warning"}))})}function Y(e){P.value=e,x.value=!0}function Z(e){k.enableFilter(a.value.name,e.name).then(()=>{e.enabled=!0,g.displayNotification({msg:i("Filter enabled")})})}function c(e){k.disableFilter(a.value.name,e.name).then(()=>{e.enabled=!1,g.displayNotification({msg:i("Filter disabled")})})}function b(e){k.deleteFilter(a.value.name,e.name).then(()=>{g.displayNotification({msg:i("Filter removed")}),O(a.value.name)})}async function s(e){await k.moveFilterDown(a.value.name,e.name),O(a.value.name)}async function F(e){await k.moveFilterUp(a.value.name,e.name),O(a.value.name)}async function d(e){await k.activateFilterSet(e.name),g.displayNotification({msg:i("Filter set activated")})}async function E(e){await k.deleteFilterSet(e.name),g.displayNotification({msg:i("Filter set removed")}),a.value=null,M()}async function q(){const{valid:e}=await w.value.validate();if(!e)return;const n={content:y.value};N.value=!0;try{await k.saveFilterSet(a.value.name,n),g.displayNotification({msg:i("Filter set updated")})}catch(u){u.response.status===400&&u.response.data.content&&(r.value=u.response.data.content)}finally{N.value=!1}}async function he(e){const n=await k.downloadFilterSet(e.name),u=new Blob([n.data],{type:"text/plain"}),B=document.createElement("a");B.href=URL.createObjectURL(u),B.download=`${e.name}.txt`,B.click(),URL.revokeObjectURL(B.href)}const we=[{label:i("Edit"),icon:"mdi-circle-edit-outline",onClick:Y},{label:i("Delete"),icon:"mdi-delete-outline",onClick:b,color:"red"}];function Ce(e,n){const u=[...we];return e.enabled?u.push({label:i("Disable"),icon:"mdi-stop",color:"red",onClick:c}):u.push({label:i("Enable"),icon:"mdi-check",color:"success",onClick:Z}),n!==h.value.length-1&&u.push({label:i("Move down"),icon:"mdi-arrow-down",onClick:s}),n!==0&&u.push({label:i("Move up"),icon:"mdi-arrow-up",onClick:F}),u}const Se=[{label:i("Download filter set"),icon:"mdi-download",onClick:he},{label:i("Delete filter set"),color:"error",icon:"mdi-trash-can",onClick:E}];function _e(){const e=[];return a.value.active||e.push({label:i("Activate filter set"),color:"success",icon:"mdi-check",onClick:d}),e.concat(Se)}return M(),(e,n)=>(f(),R(T,null,[I("div",Ze,[I("div",et,G(o(i)("Message filters")),1),t(Ee,{color:"white",flat:""},{default:p(()=>[t(Le,{modelValue:a.value,"onUpdate:modelValue":n[0]||(n[0]=u=>a.value=u),label:o(i)("Select a filter set"),items:l.value,"item-title":H,"return-object":"",variant:"outlined","hide-details":"",class:"flex-grow-0",style:{width:"200px"},density:"compact"},null,8,["modelValue","label","items"]),t(S,{color:"primary",icon:"mdi-plus",size:"small",class:"mx-4",title:o(i)("Add filter set"),onClick:n[1]||(n[1]=u=>$.value=!0)},null,8,["title"]),a.value?(f(),_(ce,{key:0},{activator:p(({props:u})=>[t(S,J({icon:"mdi-dots-vertical"},u,{size:"small",color:"default"}),null,16)]),default:p(()=>[t(de,{items:_e(),obj:a.value},null,8,["items","obj"])]),_:1})):j("",!0),a.value?(f(),_(be,{key:1,modelValue:C.value,"onUpdate:modelValue":n[2]||(n[2]=u=>C.value=u),label:o(i)("Raw mode"),color:"primary",class:"ml-4","hide-details":""},null,8,["modelValue","label"])):j("",!0)]),_:1}),a.value?(f(),R("div",tt,[C.value?(f(),R(T,{key:1},[t(re,{ref_key:"rawFormRef",ref:w},{default:p(()=>[t(Me,{modelValue:y.value,"onUpdate:modelValue":n[4]||(n[4]=u=>y.value=u),variant:"outlined","auto-grow":"",rules:[o(D).required],"error-messages":r.value},null,8,["modelValue","rules","error-messages"])]),_:1},512),t(S,{color:"success",loading:N.value,class:"mt-2",onClick:q},{default:p(()=>[te(G(o(i)("Save")),1)]),_:1},8,["loading"])],64)):(f(),R(T,{key:0},[I("div",lt,[t(S,{color:"primary",title:o(i)("Add new filter"),class:"mx-auto",onClick:n[3]||(n[3]=u=>x.value=!0)},{default:p(()=>[t(De,{icon:"mdi-plus"}),te(" "+G(o(i)("Add")),1)]),_:1},8,["title"])]),t(Ge,{headers:L,items:h.value,loading:A.value},{"item.enabled":p(({item:u})=>[te(G(e.$yesno(u.enabled)),1)]),"item.filter_actions":p(({index:u,item:B})=>[t(ce,{"offset-y":""},{activator:p(({props:xe})=>[t(S,J({icon:"mdi-dots-horizontal",variant:"text"},xe),null,16)]),default:p(()=>[t(de,{items:Ce(B,u),obj:B},null,8,["items","obj"])]),_:2},1024)]),_:2},1032,["items","loading"])],64))])):j("",!0)]),t(me,{modelValue:$.value,"onUpdate:modelValue":n[5]||(n[5]=u=>$.value=u),"max-width":"600"},{default:p(()=>[t(Je,{onClose:W})]),_:1},8,["modelValue"]),t(me,{modelValue:x.value,"onUpdate:modelValue":n[6]||(n[6]=u=>x.value=u),"max-width":"800"},{default:p(()=>[a.value?(f(),_(Ye,{key:0,"filter-set":a.value.name,filter:P.value,onClose:X},null,8,["filter-set","filter"])):j("",!0)]),_:1},8,["modelValue"])],64))}};export{Rt as default};
