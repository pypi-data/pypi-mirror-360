[package]
name = "treadmill_sdk"
version = "0.1.5"
edition = "2021"
description = "BrainCo Treadmill SDK"
repository = "https://github.com/BrainCoTech/treadmill-sdk"
authors = ["BrainCo"]
license = ""
publish = false

[badges]
maintenance = { status = "actively-developed" }

[lib]
# crate-type = ["cdylib"]
crate-type = ["staticlib", "cdylib", "rlib"] # 生成静态库（适用于 iOS）
# crate-type = ["cdylib", "rlib"] # run example need rlib
# crate-type = ["rlib"] # run example need rlib

[package.metadata.pyo3]
generate-type-hints = true # 自动生成 .pyi

[profile.release]
lto = true
strip = true

[features]
default = ["treadmill-cbindgen", "examples"] #, "python"]

cbindgen = ["tokio/rt-multi-thread", "tracing-log"]
# ble-cbindgen = ["cbindgen", "ble"]
# encrypt-cbindgen = ["cbindgen"]
treadmill-cbindgen = ["cbindgen", "treadmill"]

serial = ["dep:tokio-serial"]

tracing-log = []
desktop = ["dep:machine-uid", "dep:zip"]
examples = [
  "desktop",
  "tracing-log",
  "tokio/rt-multi-thread",
  "cbindgen",
  "serial",
]

python = ["desktop", "dep:pyo3", "dep:pyo3-async-runtimes", "dep:pyo3-log", "dep:pyo3-stub-gen"]

sci = ["dep:sci-rs", "dep:rustfft", "dep:nalgebra"]
treadmill = []

[dependencies]
byteorder = "1.5.0"
chrono = "0.4.38"
crc16 = "0.4.0"
futures = "0.3.30"
lazy_static = "1.5.0"
strum = "0.26.3"
strum_macros = "0.26.4"
thiserror = "2.0.3"
# Only features sync,macros,io-util,rt,time are supported on wasm
tokio = { version = "1.39.3", default-features = false, features = [
  "sync",
  "macros",
  "io-util",
  "rt",
  "time",
] }
tokio-stream = { version = "0.1.17", features = ["sync"] }
tokio-serial = { version = "5.4.5", default-features = false, optional = true }

tracing = "0.1.40"
tracing-subscriber = "0.3.18"
pin-project = "1.1.5"
serde_json = "1.0.128"
serde_derive = "1.0.210"
serde = { version = "1.0.210", features = ["derive"] }
prost = "0.13.1"
pbjson = "0.7.0"
pbjson-types = "0.7.0"
log = "0.4.22"
env_filter = "0.1.2"
cfg-if = "1.0.0"
once_cell = "1.20.2"
futures-util = "0.3.31"
anyhow = "1.0.89"

zip = { version = "2.2.0", optional = true }
machine-uid = { version = "0.5.3", optional = true }

sci-rs = { version = "0.4.1", optional = true, features = ["std"] }
rustfft = { version = "6.2.0", optional = true }
nalgebra = { version = "0.33.2", optional = true }
num-traits = "0.2.19"
rand = "0.8.5"
crc32fast = "1.4.2"
crc = "3.2.1"
hex = "0.4.3"
tflite = { version = "0.9.8", optional = true }
uuid = "1.11.0"
async-trait = "0.1.85"
ring = "0.17.11"
# cbc = "0.1.2"
# aes = "0.8.4"
# cipher = "0.4.4"
# jni = "0.21.1"

pyo3 = { version = "^0.25.0", features = [
  "extension-module",
  "auto-initialize",
  "abi3-py38",
], optional = true }
pyo3-async-runtimes = { version = "^0.25.0", features = [
  "attributes",
  # "async-std-runtime",
  "tokio-runtime",
], optional = true }
pyo3-log = { version = "^0.12.0", optional = true }
pyo3-stub-gen = { version = "^0.10.0", optional = true }
parking_lot = "0.12.4"
nom = "8.0.0"
zerocopy = { version = "0.8.25", features = ["derive"] }

[target.'cfg(target_os = "android")'.dependencies]
android_logger = "0.15.0"
# jni = "0.21.1"
# jni = "0.19.0"
# jni-utils = "0.1.1"

[build-dependencies]
cfg-if = "1.0.0"
prost-build = "0.13.1"
pbjson-build = "0.7.0"
# cc = "1.2.7"
bindgen = "0.69.5"
cbindgen = "0.26.0"
csbindgen = "1.9.3"

[[example]]
name = "enc-aes-gcm"
path = "examples/encrypt/enc-aes-gcm.rs"

[[example]]
name = "test_mock_data"
path = "examples/encrypt/test_mock_data.rs"

[[example]]
name = "test_crc"
path = "examples/encrypt/test_crc.rs"

[[example]]
name = "test_dfu"
path = "examples/encrypt/test_dfu.rs"
