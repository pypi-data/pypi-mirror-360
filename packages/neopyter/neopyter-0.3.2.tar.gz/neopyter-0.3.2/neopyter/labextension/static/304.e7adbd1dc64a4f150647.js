"use strict";(self.webpackChunkneopyter=self.webpackChunkneopyter||[]).push([[304],{6304:(e,t,o)=>{o.r(t),o.d(t,{default:()=>H});var n=o(3904),r=o(6771),s=o(4805),a=o(6341),i=o(4197),l=o(6249);const c=new l.LabIcon({name:"neopyter:status-page",svgstr:'<svg t="1704342603868" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1462" width="200" height="200"><path d="M512.416 409.472a239.914667 239.914667 0 1 1 0 479.786667 239.914667 239.914667 0 0 1 0-479.786667zM6.645333 371.925333l128.853334 152.490667a27.264 27.264 0 0 0 38.954666 2.901333c208.426667-186.837333 468.053333-186.837333 675.84 0a27.392 27.392 0 0 0 39.082667-2.901333l128.256-152.490667a27.562667 27.562667 0 0 0-3.2-38.656c-302.933333-264.704-702.378667-264.704-1005.013333 0a27.733333 27.733333 0 0 0-2.773334 38.656z" p-id="1463"></path></svg>\n'});var d,u;!function(e){e.direct="direct",e.proxy="proxy"}(d||(d={})),function(e){e.info="info",e.warn="warn",e.debug="debug",e.error="error"}(u||(u={}));let p=console.info.bind(window.console),h=console.debug.bind(window.console),f=console.warn.bind(window.console);const g=console.error.bind(window.console),m={info:p,warn:f,debug:h,error:g,setLevel:function(e){e===u.info?p=console.info.bind(window.console):(p=()=>{},e===u.debug?h=console.debug.bind(window.console):(h=()=>{},f=e===u.warn?console.warn.bind(window.console):()=>{}))}};var y=o(9963),b=o(8539),v=o(8647),w=o.n(v),k=o(5569),S=o(3345),C=o.n(S),x=o(8708),E=o(5955),R=o(8231);function $(e,t){let o;try{o=e()}catch(e){return}return{getItem:e=>{var n;const r=e=>null===e?null:JSON.parse(e,null==t?void 0:t.reviver),s=null!=(n=o.getItem(e))?n:null;return s instanceof Promise?s.then(r):r(s)},setItem:(e,n)=>o.setItem(e,JSON.stringify(n,null==t?void 0:t.replacer)),removeItem:e=>o.removeItem(e)}}const I=e=>t=>{try{const o=e(t);return o instanceof Promise?o:{then:e=>I(e)(o),catch(e){return this}}}catch(e){return{then(e){return this},catch:t=>I(t)(e)}}};class M extends Error{constructor(e){super(e),this.name="RPCError"}}var N=o(4214);const O="https://github.com/msgpack-rpc/msgpack-rpc/blob/master/spec.md";var P;!function(e){e[e.Request=0]="Request",e[e.Response=1]="Response",e[e.Notification=2]="Notification"}(P||(P={}));class _{constructor(e){this.dispatcher=e}start(e,...t){this.transport=new e(this,...t)}async dispatchMethod(e,t){if(!this.dispatcher[e.method]){const o=new M(`Method not found ${e.method}`);throw e.type===P.Request&&t&&t({type:P.Response,msgid:e.msgid,error:o,result:void 0}),o}try{const o=await this.dispatcher[e.method](...e.params);e.type===P.Request&&t&&t({type:P.Response,msgid:e.msgid,result:o})}catch(o){m.error(o),e.type===P.Request&&t&&t({type:P.Response,msgid:e.msgid,error:o})}finally{m.info(`rpc request: call [${e.method}] with arguments [${e.params}]`)}}}class z{constructor(e){this.server=e}async onRequest(e){await this.server.dispatchMethod(e,e=>{this.sendData(function(e){return e.type===P.Request?(0,N.encode)([e.type,e.msgid,e.method,e.params]):e.type===P.Response?(0,N.encode)([e.type,e.msgid,e.error?e.error.toString():void 0,e.result]):(0,N.encode)([e.type,e.method,e.params])}(e))})}async onNotify(e){this.server.dispatchMethod(e)}}class T extends z{constructor(e,t,o){super(e),this.url=t,this.autoRetry=o,this.start()}async start(){try{this.websocket=new WebSocket(this.url),this.websocket.binaryType="arraybuffer",this.readableStream=new ReadableStream({start:e=>{this.websocket.addEventListener("open",e=>{this.onOpen(e)}),this.websocket.addEventListener("message",t=>{const o=function(e){const t=atob(e);return Uint8Array.from(t,e=>e.codePointAt(0))}(t.data);e.enqueue(o)}),this.websocket.addEventListener("error",e=>{throw this.onError(e),e}),this.websocket.addEventListener("close",t=>{this.onClose(t),e.close()})}});for await(const e of async function*(e){const t=(0,N.decodeMultiStream)(e);for await(const e of t){if(!Array.isArray(e)||4!==e.length&&3!==e.length)throw new M(`Invalid msgpack-rpc message: ${JSON.stringify(e)}, please reference ${O}`);const t=e[0];if(0!==t&&1!==t&&2!==t)throw new M(`Invalid msgpack-rpc message: ${JSON.stringify(e)}, please reference ${O}`);t===P.Request?yield{type:P.Request,msgid:e[1],method:e[2],params:e[3]}:t===P.Response?yield{type:P.Response,msgid:e[1],error:e[2],result:e[3]}:yield{type:P.Notification,method:e[1],params:e[2]}}}(this.readableStream))m.info(e),this.onRead(e)}catch(e){throw m.error(e),this.checkRetry(),e}}async onRead(e){switch(e.type){case P.Request:await this.onRequest(e);break;case P.Notification:await this.onNotify(e);break;default:throw new M(`unknown message: ${e}`)}}sendData(e){this.websocket.send(function(e){const t=String.fromCodePoint(...e);return btoa(t)}(e))}onOpen(e){m.info(`connection websocket ${this.websocket.url}`)}onError(e){m.error("websocket error",e)}onClose(e){m.info(`disconnect websocket: ${this.websocket.url}`,e),this.websocket.close(),this.websocket=void 0,this.readableStream=void 0,this.checkRetry()}checkRetry(){this.autoRetry&&void 0===this.websocket&&(m.info("reconnect websocket server after 1s"),setTimeout(()=>{this.autoRetry&&void 0===this.websocket?this.start():m.error("check reconnect repeat")},1e3))}}const q=e=>e.charAt(0).toUpperCase()+e.slice(1),A=(0,R.create)()((F=(e,t)=>({mode:"direct",ip:"127.0.0.1",port:9001,loglevel:u.error}),"getStorage"in(U={name:"neopyter-setting"})||"serialize"in U||"deserialize"in U?(console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),((e,t)=>(o,n,r)=>{let s={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},a=!1;const i=new Set,l=new Set;let c;try{c=s.getStorage()}catch(e){}if(!c)return e((...e)=>{console.warn(`[zustand persist middleware] Unable to update item '${s.name}', the given storage is currently unavailable.`),o(...e)},n,r);const d=I(s.serialize),u=()=>{const e=s.partialize({...n()});let t;const o=d({state:e,version:s.version}).then(e=>c.setItem(s.name,e)).catch(e=>{t=e});if(t)throw t;return o},p=r.setState;r.setState=(e,t)=>{p(e,t),u()};const h=e((...e)=>{o(...e),u()},n,r);let f;const g=()=>{var e;if(!c)return;a=!1,i.forEach(e=>e(n()));const t=(null==(e=s.onRehydrateStorage)?void 0:e.call(s,n()))||void 0;return I(c.getItem.bind(c))(s.name).then(e=>{if(e)return s.deserialize(e)}).then(e=>{if(e){if("number"!=typeof e.version||e.version===s.version)return e.state;if(s.migrate)return s.migrate(e.state,e.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}}).then(e=>{var t;return f=s.merge(e,null!=(t=n())?t:h),o(f,!0),u()}).then(()=>{null==t||t(f,void 0),a=!0,l.forEach(e=>e(f))}).catch(e=>{null==t||t(void 0,e)})};return r.persist={setOptions:e=>{s={...s,...e},e.getStorage&&(c=e.getStorage())},clearStorage:()=>{null==c||c.removeItem(s.name)},getOptions:()=>s,rehydrate:()=>g(),hasHydrated:()=>a,onHydrate:e=>(i.add(e),()=>{i.delete(e)}),onFinishHydration:e=>(l.add(e),()=>{l.delete(e)})},g(),f||h})(F,U)):((e,t)=>(o,n,r)=>{let s={storage:$(()=>localStorage),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},a=!1;const i=new Set,l=new Set;let c=s.storage;if(!c)return e((...e)=>{console.warn(`[zustand persist middleware] Unable to update item '${s.name}', the given storage is currently unavailable.`),o(...e)},n,r);const d=()=>{const e=s.partialize({...n()});return c.setItem(s.name,{state:e,version:s.version})},u=r.setState;r.setState=(e,t)=>{u(e,t),d()};const p=e((...e)=>{o(...e),d()},n,r);let h;r.getInitialState=()=>p;const f=()=>{var e,t;if(!c)return;a=!1,i.forEach(e=>{var t;return e(null!=(t=n())?t:p)});const r=(null==(t=s.onRehydrateStorage)?void 0:t.call(s,null!=(e=n())?e:p))||void 0;return I(c.getItem.bind(c))(s.name).then(e=>{if(e){if("number"!=typeof e.version||e.version===s.version)return[!1,e.state];if(s.migrate)return[!0,s.migrate(e.state,e.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}return[!1,void 0]}).then(e=>{var t;const[r,a]=e;if(h=s.merge(a,null!=(t=n())?t:p),o(h,!0),r)return d()}).then(()=>{null==r||r(h,void 0),h=n(),a=!0,l.forEach(e=>e(h))}).catch(e=>{null==r||r(void 0,e)})};return r.persist={setOptions:e=>{s={...s,...e},e.storage&&(c=e.storage)},clearStorage:()=>{null==c||c.removeItem(s.name)},getOptions:()=>s,rehydrate:()=>f(),hasHydrated:()=>a,onHydrate:e=>(i.add(e),()=>{i.delete(e)}),onFinishHydration:e=>(l.add(e),()=>{l.delete(e)})},s.skipHydration||f(),h||p})(F,U))),j={notifyJupyterServer:async()=>{const e=JSON.stringify(J.getState());m.info("notify jupyter server, send:",e);const t=E.ServerConnection.makeSettings(),o=t.baseUrl,n=x.URLExt.join(o,"neopyter","update_settings"),r=await E.ServerConnection.makeRequest(n,{method:"POST",body:e},t);m.info("notify jupyter server, receive:",await r.json())},startConnection:async e=>{m.info("start connecting..");const t=new _(e),{mode:o,ip:n,port:r}=J.getState();if(m.info(`current mode: ${o}`),await J.notifyJupyterServer(),"proxy"===o){const e=E.ServerConnection.makeSettings(),o=x.URLExt.join(e.wsUrl,"neopyter","channel");console.info(`neopyter connect to:${o}`),t.start(T,o,!1)}else{const e=`ws://${n}:${r}`;console.info(`neopyter connect to:${e}`),t.start(T,e,!0)}},updateSettings:async e=>{A.setState(e),J.notifyJupyterServer()}},J=function(e,t){const o=e;for(const e of Object.keys(t)){const n=o;if(n[e])throw new Error(`The key ${e} already exists in store`);n[e]=t[e]}return o}(function(e){const t=e,o=t;for(const e of Object.keys(t.getState())){const n=`set${q(e)}`;if(o[n])throw new Error(`exists same key [${n}] in ${t}`);o[n]=o=>{"function"==typeof o?t.setState(t=>Object.fromEntries([[e,o(t[e])]])):t.setState(Object.fromEntries([[e,o]]))}}return t}(function(e){const t=e,o=t;for(const e of Object.keys(t.getState())){const n=`use${q(e)}`;if(o[n])throw new Error(`exists same key [${n}] in ${t}`);o[n]=()=>t(t=>t[e])}return t}(A)),j),L=(0,b.withTheme)(y.Theme);var F,U;function W(){const[e,t]=(0,S.useState)(void 0),n=J();(0,S.useEffect)(()=>((async()=>{const e=await o.e(186).then(o.t.bind(o,9186,19));t(e)})(),m.setLevel(J.getState().loglevel),J.subscribe(({loglevel:e})=>m.setLevel(e))),[]);const r=(0,S.useCallback)(async({formData:e})=>{m.info("save settings: ",JSON.stringify(e)),J.updateSettings(e)},[]);return C().createElement(C().Fragment,null,e?C().createElement(L,{schema:e,validator:w(),formData:n,onSubmit:r},C().createElement(k.Tooltip,{title:"Please reload web page after saved"},C().createElement(k.Button,{type:"primary",htmlType:"submit",style:{left:"50%",position:"relative"}},"Save"))):void 0)}class B extends l.SidePanel{constructor(){super(),this.id="neopyter-status-sidepanel";const e=l.ReactWidget.create(C().createElement(W,null));e.title.label="Neopyter Settings",this.content.addWidget(e)}}function D(e){var t,o;const n=e;return{label:n.label,type:null!==(t=n.type)&&void 0!==t?t:null===(o=n.options)||void 0===o?void 0:o.type,insertText:n.insertText,document:n.documentation,deprecated:n.deprecated,source:null==n?void 0:n.source,sortText:null==n?void 0:n.sortText}}const H=[{id:"neopyter:labplugin",description:"A JupyterLab extension.",autoStart:!0,requires:[n.ILabShell,s.IDocumentManager,n.ILayoutRestorer,r.ICompletionProviderManager],activate:(e,t,n,r,s)=>{console.log("JupyterLab extension neopyter is activated!");const l=s,d=l.getProviders(),u=new B;u.title.caption="Neopyter",u.title.icon=c,e.shell.add(u,"right"),r&&r.add(u,"@neopyter/graphsidebar");const p=e=>{var o;let r;e&&(r=n.findWidget(e));let s=null==r?void 0:r.content;if(!s){const e=t.currentWidget;(null==e?void 0:e.isUntitled)&&(r=e,s=r.content)}const a=null===(o=null==s?void 0:s.model)||void 0===o?void 0:o.sharedModel;if(!r||!a||!s)throw new Error(`Don't open ${e} and current don't select untitled ipynb`);return{notebookPanel:r,notebook:s,sharedModel:a}},h=(e,t)=>{const{notebook:o,sharedModel:n}=p(e),r=n.getCell(t);return{notebook:o,sharedNotebookModel:n,sharedModel:r}},f={getVersion:async()=>(await o.e(330).then(o.t.bind(o,8330,19))).version,echo:e=>`hello: ${e}`,executeCommand:async(t,o)=>{await e.commands.execute(t,o)}},g={getCurrentNotebook:()=>{const e=t.currentWidget;if(e){const t=n.contextForWidget(e);return null==t?void 0:t.localPath}},isFileOpen:e=>!!n.findWidget(e),isFileExist:async e=>{try{return!!await n.services.contents.get(e)}catch(e){return!1}},createNew:(e,t,o)=>n.createNew(e,t,o),openFile:e=>!!n.open(e),openOrReveal:e=>!!n.openOrReveal(e),activateNotebook:e=>{const{notebookPanel:o}=p(e);t.activateById(o.id),o.activate();const n=e=>{const t=new FocusEvent("focus",{bubbles:!0,cancelable:!0,view:window});e.click(),e.dispatchEvent(t),e.focus(),function(e){const t="onfocusin"in e?"focusin":"focus",o="onfocusin"in e;let n;"createEvent"in document?(n=document.createEvent("Event"),n.initEvent(t,o,!0)):"Event"in window&&(n=new Event(t,{bubbles:o,cancelable:!0})),e.focus(),e.dispatchEvent(n)}(e)},r=t._dockPanel;for(const e of r.tabBars()){const t=e.titles.findIndex(e=>e.owner===o);if(t>=0){n(e.contentNode.children[t]);break}}n(o.node)},closeFile:async e=>await n.closeFile(e),selectAbove:()=>{const{notebook:e}=p();e&&a.NotebookActions.selectBelow(e)},selectBelow:()=>{const{notebook:e}=p();e&&a.NotebookActions.selectBelow(e)}},y={getCellNum:e=>p(e).sharedModel.cells.length,setCellNum:(e,t)=>{const{notebook:o,sharedModel:n}=p(e),r=n.cells.length;if(t>r)n.insertCells(r,i.range(0,t-r).map(()=>({cell_type:o.notebookConfig.defaultCell,metadata:"code"===o.notebookConfig.defaultCell?{trusted:!0}:{}})));else for(;t<n.cells.length;)n.deleteCell(n.cells.length-1)},getCell:(e,t)=>{const{sharedModel:o}=h(e,t);return o.toJSON()},deleteCell:(e,t)=>p(e).sharedModel.deleteCell(t),insertCell:(e,t)=>{const{notebook:o,sharedModel:n}=p(e);return n.insertCell(t,{cell_type:o.notebookConfig.defaultCell,metadata:"code"===o.notebookConfig.defaultCell?{trusted:!0}:{}})},activateCell:(e,t)=>{const{notebook:o}=p(e);o.activeCellIndex=t},scrollToItem:(e,t,o,n)=>{const{notebook:r}=p(e);r.scrollToItem(t,o,n)},fullSync:(e,t)=>{const{notebook:o,sharedModel:n}=p(e);for(t.forEach((e,t)=>{const r=n.getCell(t);r?void 0===e.cell_type||r.cell_type===e.cell_type?r.setSource(e.source):(n.deleteCell(t),n.insertCell(t,{cell_type:e.cell_type,source:e.source,metadata:r.getMetadata()})):n.insertCell(t,{cell_type:e.cell_type,source:e.source,metadata:"code"===o.notebookConfig.defaultCell?{trusted:!0}:{}})});t.length<n.cells.length;)n.deleteCell(n.cells.length-1)},partialSync:(e,t,o,n)=>{const{notebook:r,sharedModel:s}=p(e);for(m.info(`partialSync: current cell num:${s.cells.length}, from:${t}(include), to:${o}(include), update to cell num:${n.length}`),n.forEach((e,n)=>{const a=n+t,i=s.getCell(a);a<=o&&i?void 0===e.cell_type||i.cell_type===e.cell_type?i.setSource(e.source):(s.deleteCell(a),s.insertCell(a,{cell_type:e.cell_type,source:e.source,metadata:i.getMetadata()})):s.insertCell(a,{cell_type:e.cell_type,source:e.source,metadata:"code"===r.notebookConfig.defaultCell?{trusted:!0}:{}})});o-t+1>n.length;)s.deleteCell(o),o-=1},save:async e=>{const{notebookPanel:t}=p(e),o=n.contextForWidget(t);return await(null==o?void 0:o.save())},runSelectedCell:async t=>await e.commands.execute("notebook:run-cell"),runAllAbove:async t=>await e.commands.execute("notebook:run-all-above"),runAllBelow:async t=>await e.commands.execute("notebook:run-all-below"),runAll:async t=>await e.commands.execute("notebook:run-all-cells"),restartKernel:async e=>{const{notebookPanel:t}=p(e);return await t.sessionContext.restartKernel()},restartRunAll:async t=>{const{notebookPanel:o}=p(t);return await o.sessionContext.restartKernel(),await e.commands.execute("notebook:run-all-cells")},setMode:(e,t)=>{const{notebookPanel:o}=p(e);o.content.mode=t},complete:async(e,{source:t,offset:o,cellIndex:n})=>{const{notebookPanel:r,notebook:s}=p(e);n>=s.widgets.length&&console.warn("complete cellIndex not exists in notebook");const a=s.widgets[n],i=[];for(const[e,n]of d)try{const e=await n.fetch({text:t,offset:o},{widget:r,editor:null==a?void 0:a.editor,session:r.sessionContext.session});i.push(...e.items.map(e=>({...D(e),source:n.identifier})))}catch(t){m.error(`Completer [${e}] error, please your other jupyterlab extensions:`,t)}return m.info(i),i},reconciliatorComplete:async(e,{source:t,offset:o,cellIndex:n,trigger:r})=>{const{notebookPanel:s,notebook:a}=p(e);if(console.log(l),console.log(s.id,a.id),n>=a.widgets.length)return m.error(`Cell ${n} out of notebook range`),[];try{const e=await(async(e,t)=>{const o=l._panelHandlers.get(s.id);return await o._reconciliator.fetch(e,t)})({text:t,offset:o},r);return e?(m.info("complete return",{source:t,offset:o,trigger:r},e.items),e.items.map(D)):(m.info("complete return null: ",{source:t,offset:o,trigger:r}),[])}catch(e){m.error("complete failed:",e)}return[]},kernelComplete:async(e,t,o)=>{const{notebookPanel:n}=p(e),r=d.get("CompletionProvider:kernel"),s=(await r.fetch({text:t,offset:o},{widget:n,session:n.sessionContext.session})).items.map(D);return m.info(s),s}},b={setCellSource:(e,t,o)=>{const{sharedModel:n}=h(e,t);n.setSource(o)},setCellType:(e,t,o)=>{const{sharedNotebookModel:n,sharedModel:r}=h(e,t);r.cell_type!==o&&(n.deleteCell(t),n.insertCell(t,{cell_type:o,source:r.getSource(),metadata:r.getMetadata()}))}};Object.assign(f,g),Object.assign(f,y),Object.assign(f,b),J.startConnection(f)}}]}}]);