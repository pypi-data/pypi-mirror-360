import{r,b as J}from"./index.Dmsp2dPx.js";import{s as Q,i as F,a as U,b as Z,T as ee,C as te,m as re}from"./index.DkDMkGP_.js";import"./FormClearHelper.X_JAWIDE.js";import"./withFullScreenWrapper.Dgyv-A2q.js";import"./Toolbar.Vgf9NeBF.js";import"./checkbox.CHzUs1FT.js";import"./mergeWith.CAjjDs4h.js";import"./sprintf.D7DtBTRn.js";import"./createDownloadLinkElement.DZMwyjvU.js";import"./toConsumableArray.CbOloveN.js";import"./possibleConstructorReturn.Bv3kil8b.js";import"./createSuper.DtVUSUG3.js";import"./FileDownload.esm.b9aAtFUL.js";const ie=()=>t=>t.targetX,ne=()=>t=>t.targetY,se=()=>t=>t.targetWidth,ae=()=>t=>t.targetHeight,oe=()=>t=>t.targetY+10,de=()=>t=>Math.max(0,(t.targetHeight-28)/2),le=Q("div")({name:"DataGridOverlayEditorStyle",class:"gdg-d19meir1",propsAsIs:!1,vars:{"d19meir1-0":[ne(),"px"],"d19meir1-1":[ie(),"px"],"d19meir1-2":[se(),"px"],"d19meir1-3":[ae(),"px"],"d19meir1-4":[oe(),"px"],"d19meir1-5":[de(),"px"]}});function ue(){const[t,s]=r.useState();return[t??void 0,s]}function ce(){const[t,s]=ue(),[n,y]=r.useState(0),[g,v]=r.useState(!0);r.useLayoutEffect(()=>{if(t===void 0||!("IntersectionObserver"in window))return;const a=new IntersectionObserver(o=>{o.length!==0&&v(o[0].isIntersecting)},{threshold:1});return a.observe(t),()=>a.disconnect()},[t]),r.useEffect(()=>{if(g||t===void 0)return;let a;const o=()=>{const{right:k}=t.getBoundingClientRect();y(p=>Math.min(p+window.innerWidth-k-10,0)),a=requestAnimationFrame(o)};return a=requestAnimationFrame(o),()=>{a!==void 0&&cancelAnimationFrame(a)}},[t,g]);const S=r.useMemo(()=>({transform:`translateX(${n}px)`}),[n]);return{ref:s,style:S}}const ke=t=>{const{target:s,content:n,onFinishEditing:y,forceEditMode:g,initialValue:v,imageEditorOverride:S,markdownDivCreateNode:a,highlight:o,className:k,theme:p,id:W,cell:h,bloom:c,validateCell:d,getCellRenderer:P,provideEditor:E,isOutsideClick:X,customEventTarget:A}=t,[l,K]=r.useState(g?n:void 0),R=r.useRef(l??n);R.current=l??n;const[C,D]=r.useState(()=>d===void 0?!0:!(F(n)&&(d==null?void 0:d(h,n,R.current))===!1)),f=r.useCallback((e,i)=>{y(C?e:void 0,i)},[C,y]),Y=r.useCallback(e=>{if(d!==void 0&&e!==void 0&&F(e)){const i=d(h,e,R.current);i===!1?D(!1):(typeof i=="object"&&(e=i),D(!0))}K(e)},[h,d]),b=r.useRef(!1),m=r.useRef(void 0),j=r.useCallback(()=>{f(l,[0,0]),b.current=!0},[l,f]),L=r.useCallback((e,i)=>{f(e,i??m.current??[0,0]),b.current=!0},[f]),q=r.useCallback(async e=>{let i=!1;e.key==="Escape"?(e.stopPropagation(),e.preventDefault(),m.current=[0,0]):e.key==="Enter"&&!e.shiftKey?(e.stopPropagation(),e.preventDefault(),m.current=[0,1],i=!0):e.key==="Tab"&&(e.stopPropagation(),e.preventDefault(),m.current=[e.shiftKey?-1:1,0],i=!0),window.setTimeout(()=>{!b.current&&m.current!==void 0&&(f(i?l:void 0,m.current),b.current=!0)},0)},[f,l]),I=l??n,[u,B]=r.useMemo(()=>{var O,H;if(U(n))return[];const e={...n,location:h},i=E==null?void 0:E(e);return i!==void 0?[i,!1]:[(H=(O=P(n))==null?void 0:O.provideEditor)==null?void 0:H.call(O,e),!1]},[h,n,P,E]),{ref:$,style:z}=ce();let T=!0,M,_=!0,x;if(u!==void 0){T=u.disablePadding!==!0,_=u.disableStyling!==!0;const e=Z(u);e&&(x=u.styleOverride);const i=e?u.editor:u;M=r.createElement(i,{isHighlighted:o,onChange:Y,value:I,initialValue:v,onFinishedEditing:L,validatedSelection:F(I)?I.selectionRange:void 0,forceEditMode:g,target:s,imageEditorOverride:S,markdownDivCreateNode:a,isValid:C,theme:p})}x={...x,...z};const N=document.getElementById("portal");if(N===null)return console.error('Cannot open Data Grid overlay editor, because portal not found.  Please add `<div id="portal" />` as the last child of your `<body>`.'),null;let w=_?"gdg-style":"gdg-unstyle";C||(w+=" gdg-invalid"),T&&(w+=" gdg-pad");const V=(c==null?void 0:c[0])??1,G=(c==null?void 0:c[1])??1;return J.createPortal(r.createElement(ee.Provider,{value:p},r.createElement(te,{style:re(p),className:k,onClickOutside:j,isOutsideClick:X,customEventTarget:A},r.createElement(le,{ref:$,id:W,className:w,style:x,as:B===!0?"label":void 0,targetX:s.x-V,targetY:s.y-G,targetWidth:s.width+V*2,targetHeight:s.height+G*2},r.createElement("div",{className:"gdg-clip-region",onKeyDown:q},M)))),N)};export{ke as default};
