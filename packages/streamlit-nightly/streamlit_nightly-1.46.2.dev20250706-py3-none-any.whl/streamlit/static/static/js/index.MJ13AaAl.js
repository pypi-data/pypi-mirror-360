import{r as i,E as Z,_ as tt,s as g,B as mt,z as W,j as n,ba as et,bv as yt,C as F,bq as ot,b5 as nt,bp as T,a$ as Ct,bJ as It,bH as Q,bk as bt,bK as v,bt as vt,F as at,aQ as xt,bh as St,bL as wt,M as $,bm as Ft,bl as Et}from"./index.Dmsp2dPx.js";import{g as Ut,C as zt,I as Tt,F as N,E as Ht,a as Bt,s as Dt,u as Lt,b as Rt}from"./FileHelper.CZ-fo3AT.js";import{I as $t}from"./InputInstructions.DRcWCO4-.js";import{i as kt}from"./inputUtils.CQWz5UKz.js";import{E as Mt}from"./ErrorOutline.esm.Dl5aYA7P.js";import{U as rt}from"./UploadFileInfo.C-jY39rj.js";import{T as Vt}from"./textarea.mjUutfC5.js";import"./base-input.DVejzOG3.js";var it=i.forwardRef(function(t,e){var s={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return i.createElement(Z,tt({iconAttrs:s,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},t,{ref:e}),i.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),i.createElement("path",{d:"M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5a2.5 2.5 0 015 0v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5a2.5 2.5 0 005 0V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"}))});it.displayName="AttachFile";var st=i.forwardRef(function(t,e){var s={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return i.createElement(Z,tt({iconAttrs:s,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},t,{ref:e}),i.createElement("rect",{width:24,height:24,fill:"none"}),i.createElement("path",{d:"M3 5.51v3.71c0 .46.31.86.76.97L11 12l-7.24 1.81c-.45.11-.76.51-.76.97v3.71c0 .72.73 1.2 1.39.92l15.42-6.49c.82-.34.82-1.5 0-1.84L4.39 4.58C3.73 4.31 3 4.79 3 5.51z"}))});st.displayName="Send";const Nt=g("div",{target:"e1togvvn0"})("border:none;position:relative;display:flex;"),Wt=g("div",{target:"e1togvvn1"})(({theme:t,extended:e})=>({border:`${t.sizes.borderWidth} solid`,borderColor:t.colors.widgetBorderColor??t.colors.transparent,borderRadius:t.radii.chatInput,backgroundColor:t.colors.secondaryBg,position:"relative",flexGrow:1,display:"flex",alignItems:"center",paddingLeft:t.spacing.lg,maxHeight:e?"none":t.sizes.minElementHeight,gap:t.spacing.sm,overflow:"hidden",":focus-within":{borderColor:t.colors.primary}})),At=g("button",{target:"e1togvvn2"})(({theme:t,disabled:e,extended:s})=>{const p=mt(t),[f,u]=p?[t.colors.gray60,t.colors.gray80]:[t.colors.gray80,t.colors.gray40];return{border:"none",backgroundColor:t.colors.transparent,borderTopRightRadius:s?"0":t.radii.chatInput,borderTopLeftRadius:s?t.radii.default:"0",borderBottomRightRadius:t.radii.chatInput,display:"inline-flex",alignItems:"center",justifyContent:"center",lineHeight:t.lineHeights.none,margin:t.spacing.none,padding:t.spacing.sm,color:e?f:u,pointerEvents:"auto","&:focus":{outline:"none"},":focus":{outline:"none"},"&:focus-visible":{backgroundColor:p?t.colors.gray10:t.colors.gray90},"&:hover":{color:t.colors.primary},"&:disabled, &:disabled:hover, &:disabled:active":{backgroundColor:t.colors.transparent,borderColor:t.colors.transparent,color:t.colors.gray,cursor:"not-allowed"}}}),Pt=g("div",{target:"e1togvvn3"})(({theme:t})=>({display:"flex",alignItems:"flex-end",height:"100%",position:"absolute",right:0,marginBottom:`-${t.sizes.borderWidth}`,pointerEvents:"none"})),Kt=g("div",{target:"e1togvvn4"})(({theme:t})=>({position:"absolute",bottom:"0px",right:`calc(${t.iconSizes.xl} + 2 * ${t.spacing.sm} + ${t.spacing.sm})`})),Ot=g("div",{target:"e15560op0"})(({theme:t,height:e})=>({backgroundColor:t.colors.transparent,position:"absolute",left:0,bottom:0,minHeight:`max(${t.sizes.emptyDropdownHeight}, ${e})`,width:"100%",zIndex:t.zIndices.priority})),_t=g("div",{target:"e15560op1"})(({theme:t,height:e})=>({border:`${t.sizes.borderWidth} solid`,borderColor:t.colors.primary,borderRadius:t.radii.chatInput,backgroundColor:t.colors.secondaryBg,color:t.colors.primary,display:"flex",alignItems:"center",justifyContent:"center",height:e,width:"100%",fontWeight:t.fontWeights.bold})),Xt=g("div",{target:"e15560op2"})(({theme:t,disabled:e})=>({display:"flex",alignItems:"top",height:"100%",marginTop:`-${t.sizes.borderWidth}`,cursor:e?"not-allowed":"auto"})),Gt=g("div",{target:"e15560op3"})(({disabled:t})=>({pointerEvents:t?"none":"auto"})),jt=g("div",{target:"e15560op4"})(({theme:t})=>({marginTop:"0.625em",marginLeft:t.spacing.sm,height:t.spacing.xl,width:t.sizes.borderWidth,backgroundColor:t.colors.fadedText20})),Yt=g("div",{target:"e15560op5"})(({theme:t})=>({left:0,right:0,lineHeight:t.lineHeights.tight,paddingLeft:t.spacing.sm,paddingRight:t.spacing.sm,overflowX:"auto"})),qt=g("div",{target:"e15560op6"})({display:"flex"}),Jt=g("div",{target:"e15560op7"})({flex:"0 0 auto"}),Qt=g("div",{target:"e15560op8"})(({theme:t})=>({display:"flex",alignItems:"center",padding:t.spacing.sm,gap:t.spacing.twoXS})),Zt=g("div",{target:"e15560op9"})(({theme:t})=>({color:t.colors.fadedText60})),te=g("div",{target:"e15560op10"})(({theme:t,fileStatus:e})=>({overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:e.type==="uploaded"?t.colors.bodyText:t.colors.fadedText60})),ee=g("div",{target:"e15560op11"})(({theme:t})=>({marginRight:t.spacing.md,color:t.colors.fadedText60})),oe=g("small",{target:"e15560op12"})(({theme:t})=>({display:"flex",alignItems:"center",maxHeight:t.sizes.smallElementHeight,color:t.colors.fadedText60,"& :hover":{color:t.colors.bodyText}}));function ne({children:t,content:e}){const s=W();return n(yt,{content:e,placement:et.TOP,overrides:{Body:{style:{top:`-${s.sizes.minElementHeight}`}}},children:t})}const ae=({fileInfo:t})=>{const e=W(),{type:s}=t.status;switch(s){case"uploading":return n(It,{usingCustomTheme:!1,"data-testid":"stChatInputFileIconSpinner",size:"lg",margin:"0",padding:"0"});case"error":return n(ne,{content:t.status.errorMessage,children:n(T,{color:e.colors.red,content:Mt,size:"lg"})});case"uploaded":return n(T,{content:Tt,size:"lg"});default:return Ct(s),null}},re=({fileInfo:t,onDelete:e})=>F(Qt,{className:"stChatInputFile","data-testid":"stChatInputFile",children:[n(Zt,{children:n(ae,{fileInfo:t})}),n(te,{className:"stChatInputFileName","data-testid":"stChatInputFileName",title:t.name,fileStatus:t.status,children:t.name}),n(ee,{children:Ut(t.size,N.Byte)}),n(oe,{"data-testid":"stChatInputDeleteBtn",children:n(ot,{onClick:()=>e(t.id),kind:nt.MINIMAL,children:n(T,{content:zt,size:"lg"})})})]}),ie=i.memo(re),se=({items:t,onDelete:e})=>n(Yt,{"data-testid":"stChatUploadedFiles",children:n(qt,{children:t.map(s=>n(Jt,{children:n(ie,{fileInfo:s,onDelete:e})},s.id))})}),le=i.memo(se),de=({getNextLocalFileId:t,addFiles:e,updateFile:s,uploadClient:p,element:f,onUploadProgress:u,onUploadComplete:I})=>(y,d)=>{const m=Q.CancelToken.source(),c=new rt(d.name,d.size,t(),{type:"uploading",cancelToken:m,progress:1});e([c]),p.uploadFile({formId:"",...f},y.uploadUrl,d,h=>u(h,c.id),m.token).then(()=>I(c.id,y)).catch(h=>{Q.isCancel(h)||s(c.id,c.setStatus({type:"error",errorMessage:h?h.toString():"Unknown error"}))})},ce=({acceptMultipleFiles:t,maxFileSize:e,uploadClient:s,uploadFile:p,addFiles:f,getNextLocalFileId:u,deleteExistingFiles:I,onUploadComplete:y})=>(d,m)=>{if(!t&&d.length===0&&m.length>1){const c=m.findIndex(h=>{var x;return((x=h.errors)==null?void 0:x[0].code)===Ht.TooManyFiles});c>=0&&(d.push(m[c].file),m.splice(c,1))}if(!t&&d.length>0&&I(),s.fetchFileURLs(d).then(c=>{bt(c,d).forEach(([h,x])=>{p(h,x)})}).catch(c=>{f(d.map(h=>new rt(h.name,h.size,u(),{type:"error",errorMessage:c})))}),m.length>0){const c=m.map(h=>Bt(h,u(),e));f(c)}y()},pe=({getRootProps:t,getInputProps:e,acceptFile:s,disabled:p,theme:f})=>F(Xt,{disabled:p,children:[F(Gt,{"data-testid":"stChatInputFileUploadButton",disabled:p,...t(),children:[n("input",{...e()}),n(vt,{content:`Upload or drag and drop ${s===v.Multiple?"files":"a file"}`,placement:et.TOP,onMouseEnterDelay:500,children:n(ot,{kind:nt.MINIMAL,disabled:p,children:n(T,{content:it,size:"lg",color:p?f.colors.fadedText40:f.colors.fadedText60})})})]}),n(jt,{})]}),ue=i.memo(pe),ge=({getRootProps:t,getInputProps:e,acceptFile:s,inputHeight:p})=>F(at,{children:[n(Ot,{height:p,...t(),children:n("input",{...e()})}),n(_t,{height:p,children:`Drag and drop ${s===v.Multiple?"files":"a file"} here`})]}),he=i.memo(ge),fe=6.5,k=1,M=(t,e,s)=>s.map(p=>p.id===t?e:p),V=(t,e)=>e.find(s=>s.id===t);function me({disabled:t,element:e,widgetMgr:s,fragmentId:p,uploadClient:f}){const u=W(),{placeholder:I,maxChars:y}=e,d=i.useRef(null),m=i.useRef(0),c=i.useRef({minHeight:0,maxHeight:0}),[h,x]=xt(),{innerWidth:A,innerHeight:P}=St(),[E,B]=i.useState(e.default),[U,D]=i.useState(0),[H,lt]=i.useState(!1),[S,w]=i.useState([]),[z,L]=i.useState(!1),R=i.useMemo(()=>S.some(o=>o.status.type==="uploading")?!1:E!==""||S.length>0,[S,E]),b=wt(e.acceptFile),K=Dt(e.maxUploadSizeMb,N.Megabyte,N.Byte),O=i.useCallback(o=>w(a=>[...a,...o]),[]),_=i.useCallback(o=>{w(a=>{const l=V(o,a);return $(l)?a:(l.status.type==="uploading"&&l.status.cancelToken.cancel(),l.status.type==="uploaded"&&l.status.fileUrls.deleteUrl&&f.deleteFile(l.status.fileUrls.deleteUrl),a.filter(r=>r.id!==o))})},[f]),dt=()=>{const o=S.filter(a=>a.status.type==="uploaded").map(a=>{const{name:l,size:r,status:C}=a,{fileId:ht,fileUrls:ft}=C;return new Ft({fileId:ht,fileUrls:ft,name:l,size:r})});return new Et({uploadedFileInfo:o})},X=()=>m.current++,ct=ce({acceptMultipleFiles:b===v.Multiple,maxFileSize:K,uploadClient:f,uploadFile:de({getNextLocalFileId:X,addFiles:O,updateFile:(o,a)=>{w(l=>M(o,a,l))},uploadClient:f,element:e,onUploadProgress:(o,a)=>{w(l=>{const r=V(a,l);if($(r)||r.status.type!=="uploading")return l;const C=Math.round(o.loaded*100/o.total);return r.status.progress===C?l:M(a,r.setStatus({type:"uploading",cancelToken:r.status.cancelToken,progress:C}),l)})},onUploadComplete:(o,a)=>{w(l=>{const r=V(o,l);return $(r)||r.status.type!=="uploading"?l:M(r.id,r.setStatus({type:"uploaded",fileId:a.fileId,fileUrls:a}),l)})}}),addFiles:O,getNextLocalFileId:X,deleteExistingFiles:()=>S.forEach(o=>_(o.id)),onUploadComplete:()=>{d.current&&d.current.focus()}}),{getRootProps:G,getInputProps:j}=Lt({onDrop:ct,multiple:b===v.Multiple,accept:Rt(e.fileType),maxSize:K}),Y=()=>{let o=0;const{current:a}=d;return a&&(a.style.height="auto",o=a.scrollHeight,a.style.height=""),o},q=()=>{if(d.current&&d.current.focus(),!R||t)return;const o={data:E,fileUploaderState:dt()};s.setChatInputValue(e,o,{fromUi:!0},p),w([]),B(""),D(0)},pt=o=>{const{metaKey:a,ctrlKey:l,shiftKey:r}=o;kt(o)&&!r&&!l&&!a&&(o.preventDefault(),q())},ut=o=>{const{value:a}=o.target;y!==0&&a.length>y||(B(a),D(Y()))};i.useEffect(()=>{if(e.setValue){e.setValue=!1;const o=e.value||"";B(o)}},[e]),i.useLayoutEffect(()=>{if(d.current){const{offsetHeight:o}=d.current;c.current.minHeight=o,c.current.maxHeight=o*fe}},[d]),i.useEffect(()=>{const o=r=>{var C;r.preventDefault(),r.stopPropagation(),!z&&((C=r.dataTransfer)!=null&&C.types.includes("Files"))&&L(!0)},a=r=>{r.preventDefault(),r.stopPropagation(),z&&(r.clientX<=0&&r.clientY<=0||r.clientX>=A&&r.clientY>=P)&&L(!1)},l=r=>{r.preventDefault(),r.stopPropagation(),z&&L(!1)};return window.addEventListener("dragover",o),window.addEventListener("drop",l),window.addEventListener("dragleave",a),()=>{window.removeEventListener("dragover",o),window.removeEventListener("drop",l),window.removeEventListener("dragleave",a)}},[z,A,P]),i.useLayoutEffect(()=>{const{minHeight:o}=c.current;lt(U>0&&d.current?Math.abs(U-o)>k:!1)},[U]),i.useLayoutEffect(()=>{D(Y())},[I]);const{maxHeight:J}=c.current,gt=b!==v.None&&z;return F(at,{children:[b===v.None?null:n(le,{items:[...S],onDelete:_}),n(Nt,{className:"stChatInput","data-testid":"stChatInput",ref:x,children:gt?n(he,{getRootProps:G,getInputProps:j,acceptFile:b,inputHeight:H?`${U+k}px`:u.sizes.minElementHeight}):F(Wt,{extended:H,children:[b===v.None?null:n(ue,{getRootProps:G,getInputProps:j,acceptFile:b,disabled:t,theme:u}),n(Vt,{inputRef:d,value:E,placeholder:I,onChange:ut,onKeyDown:pt,"aria-label":I,disabled:t,rows:1,overrides:{Root:{style:{minHeight:u.sizes.minElementHeight,outline:"none",borderLeftWidth:"0",borderRightWidth:"0",borderTopWidth:"0",borderBottomWidth:"0",borderTopLeftRadius:"0",borderTopRightRadius:"0",borderBottomRightRadius:"0",borderBottomLeftRadius:"0"}},Input:{props:{"data-testid":"stChatInputTextArea"},style:{lineHeight:u.lineHeights.inputWidget,"::placeholder":{color:u.colors.fadedText60},height:H?`${U+k}px`:"auto",maxHeight:J?`${J}px`:"none",paddingLeft:u.spacing.none,paddingBottom:u.spacing.sm,paddingTop:u.spacing.sm,paddingRight:`calc(${u.iconSizes.xl} + 2 * ${u.spacing.sm} + ${u.spacing.sm})`}}}}),h>u.breakpoints.hideWidgetDetails&&n(Kt,{children:n($t,{dirty:R,value:E,maxLength:y,type:"chat",inForm:!1})}),n(Pt,{children:n(At,{onClick:q,disabled:!R||t,extended:H,"data-testid":"stChatInputSubmitButton",children:n(T,{content:st,size:"xl",color:"inherit"})})})]})})]})}const Fe=i.memo(me);export{Fe as default};
