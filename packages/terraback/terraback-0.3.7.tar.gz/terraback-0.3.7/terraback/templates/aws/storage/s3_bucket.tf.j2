{% for bucket in resources -%}
resource "aws_s3_bucket" "bucket_{{ bucket.Name | replace('-', '_') | replace('.', '_') | replace('/', '_') }}" {
  bucket = "{{ bucket.Name }}"
}

{% if bucket.get('Versioning') and bucket.Versioning.get('Status') == 'Enabled' -%}
resource "aws_s3_bucket_versioning" "versioning_{{ bucket.Name | replace('-', '_') | replace('.', '_') | replace('/', '_') }}" {
  bucket = aws_s3_bucket.bucket_{{ bucket.Name | replace('-', '_') | replace('.', '_') | replace('/', '_') }}.id
  
  versioning_configuration {
    status = "{{ bucket.Versioning.Status }}"
  }
}
{% endif -%}

{% if bucket.get('PublicAccessBlock') -%}
resource "aws_s3_bucket_public_access_block" "pab_{{ bucket.Name | replace('-', '_') | replace('.', '_') | replace('/', '_') }}" {
  bucket = aws_s3_bucket.bucket_{{ bucket.Name | replace('-', '_') | replace('.', '_') | replace('/', '_') }}.id

  block_public_acls       = {{ bucket.PublicAccessBlock.get('BlockPublicAcls', false) | lower }}
  block_public_policy     = {{ bucket.PublicAccessBlock.get('BlockPublicPolicy', false) | lower }}
  ignore_public_acls      = {{ bucket.PublicAccessBlock.get('IgnorePublicAcls', false) | lower }}
  restrict_public_buckets = {{ bucket.PublicAccessBlock.get('RestrictPublicBuckets', false) | lower }}
}
{% endif -%}

{% if not loop.last %}

{% endif %}
{%- endfor %}