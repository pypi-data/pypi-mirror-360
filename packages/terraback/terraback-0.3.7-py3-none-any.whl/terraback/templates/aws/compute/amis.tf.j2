{% for ami in resources -%}
resource "aws_ami" "ami_{{ ami.ImageId | replace('ami-', '') | replace('-', '_') }}" {
  name                = "{{ ami.Name }}"
  description         = "{{ ami.Description | default('') }}"
  architecture        = "{{ ami.Architecture }}"
  root_device_name    = "{{ ami.RootDeviceName }}"
  virtualization_type = "{{ ami.VirtualizationType }}"

  {%  if ami.get('Tags') %}
  tags = {
    {%- for tag in ami.get('Tags', []) %}
    "{{ tag.Key }}" = "{{ tag.Value }}"{{ "," if not loop.last }}
    {%- endfor %}
  }
  {%  endif -%}
}

{% if not loop.last %}

{% endif -%}
{%- endfor %}